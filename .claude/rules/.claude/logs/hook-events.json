{"timestamp":"2026-01-01T03:55:32.715Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Bash","tool_input":{"command":"cd /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules && mv plugin-claude-md-structure.md plugin-claude-md.md && mv plugin-readme-structure.md plugin-readme.md && mv rules-markdown-structure.md rule-file.md","description":"Rename rules files"},"tool_response":{"stdout":"","stderr":"","interrupted":false,"isImage":false},"tool_use_id":"toolu_01NNxHLQ5q5dPfPTEx99Wb61"}}
{"timestamp":"2026-01-01T03:55:32.720Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:55:32.721Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Bash","tool_input":{"command":"cd /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules && mv plugin-claude-md-structure.md plugin-claude-md.md && mv plugin-readme-structure.md plugin-readme.md && mv rules-markdown-structure.md rule-file.md","description":"Rename rules files"},"tool_response":{"stdout":"","stderr":"","interrupted":false,"isImage":false},"tool_use_id":"toolu_01NNxHLQ5q5dPfPTEx99Wb61"}}
{"timestamp":"2026-01-01T03:55:32.724Z","event":"await-pr-checks","type":"input","data":{"tool_name":"Bash","tool_use_id":"toolu_01NNxHLQ5q5dPfPTEx99Wb61"}}
{"timestamp":"2026-01-01T03:55:32.725Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:55:47.266Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Read","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","offset":325,"limit":20},"tool_response":{"type":"text","file":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","content":"- Use case explanations\n- Troubleshooting guides\n\n**Shared content:**\n- Core hook names and purposes (can sync via HTML comments if needed)\n\n## References\n\n- [README Structure Rule](./plugin-readme-structure.md)\n- [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)\n- [CLAUDE.md Template](../../templates/CLAUDE.template.md)\n","numLines":12,"startLine":325,"totalLines":336}},"tool_use_id":"toolu_01579sVDEw38oso4pP5yzNUq"}}
{"timestamp":"2026-01-01T03:55:47.267Z","event":"add-folder-context","type":"input","data":{"tool_name":"Read","tool_use_id":"toolu_01579sVDEw38oso4pP5yzNUq"}}
{"timestamp":"2026-01-01T03:55:47.267Z","event":"add-folder-context","type":"output","data":{"success":true,"found":0}}
{"timestamp":"2026-01-01T03:55:47.268Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:55:54.726Z","event":"PreToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PreToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","old_string":"- [README Structure Rule](./plugin-readme-structure.md)","new_string":"- [README Structure Rule](./plugin-readme.md)"},"tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:54.728Z","event":"validate-rules-file","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:54.728Z","event":"validate-rules-file","type":"output","data":{"filename":"plugin-claude-md.md","hasMarkdownFrontmatter":false,"isMdRule":true}}
{"timestamp":"2026-01-01T03:55:54.728Z","event":"validate-rules-file","type":"output","data":{"encouragement":"ðŸ’¡ Rule file \"plugin-claude-md.md\" appears to target markdown files but doesn't have `markdown:` frontmatter.\n\nYou can add markdown validation by including a `markdown:` section in the frontmatter:\n\n```yaml\n---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\"]  # Allow h1, h2, h3\n    required: [\"# *\"]               # Require title heading\n  frontmatter:\n    allowed: [\"*\"]                  # Allow any frontmatter fields\n    required: [\"title\"]             # Require title field\n---\n```\n\nThis enables automatic validation of markdown structure and frontmatter fields."}}
{"timestamp":"2026-01-01T03:55:54.729Z","event":"PreToolUse","type":"output","data":{"systemMessage":"ðŸ’¡ Rule file \"plugin-claude-md.md\" appears to target markdown files but doesn't have `markdown:` frontmatter.\n\nYou can add markdown validation by including a `markdown:` section in the frontmatter:\n\n```yaml\n---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\"]  # Allow h1, h2, h3\n    required: [\"# *\"]               # Require title heading\n  frontmatter:\n    allowed: [\"*\"]                  # Allow any frontmatter fields\n    required: [\"title\"]             # Require title field\n---\n```\n\nThis enables automatic validation of markdown structure and frontmatter fields.","hookSpecificOutput":{"hookEventName":"PreToolUse","permissionDecision":"allow"}}}
{"timestamp":"2026-01-01T03:55:54.789Z","event":"PreToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PreToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","old_string":"- [README Structure Rule](./plugin-readme-structure.md)","new_string":"- [README Structure Rule](./plugin-readme.md)"},"tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:54.789Z","event":"PreToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PreToolUse","permissionDecision":"allow"}}}
{"timestamp":"2026-01-01T03:55:56.555Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","old_string":"- [README Structure Rule](./plugin-readme-structure.md)","new_string":"- [README Structure Rule](./plugin-readme.md)"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","oldString":"- [README Structure Rule](./plugin-readme-structure.md)","newString":"- [README Structure Rule](./plugin-readme.md)","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\n      \"# *\",\n      \"## Quick Reference\",\n      \"## Hook Summary\",\n      \"## Key Features\",\n      \"## Installation\",\n      \"## Debug Logging\",\n      \"## See Also\"\n    ]\n  frontmatter:\n    required: [\"title\", \"description\", \"version\", \"folder\"]\npaths:\n  - \"plugins/*/CLAUDE.md\"\n---\n\n# Plugin CLAUDE.md Structure\n\nThis rule enforces lightweight structure for AI-optimized plugin CLAUDE.md documentation.\n\n## Required Skills: None\n\n## Overview\n\nPlugin CLAUDE.md files provide AI-optimized quick reference documentation. They are intentionally lightweight and focused on:\n- Quick context for Claude AI agent\n- Hook summaries in table format\n- State file schemas\n- Essential installation and debugging info\n- Links to comprehensive README.md\n\nCLAUDE.md files complement README.md files but serve a different purpose:\n- **README.md**: User-facing, comprehensive, visual\n- **CLAUDE.md**: AI-optimized, quick reference, technical\n\n## Required Frontmatter\n\nAll plugin CLAUDE.md files must include YAML frontmatter with:\n\n```yaml\n---\ntitle: Plugin Name\ndescription: One-line description\nversion: 0.1.x\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks, ...]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md, .gitignore]\n    required: [README.md]\n---\n```\n\n**Required fields:**\n- `title` - Human-readable plugin name\n- `description` - One-line purpose description\n- `version` - Semantic version (matches plugin.json)\n- `folder` - Folder structure validation (subfolders and files)\n\n**Folder validation schema:**\n- `subfolders.allowed` - Array of allowed subdirectory names\n- `subfolders.required` - Array of required subdirectory names\n- `files.allowed` - Array of allowed file names at plugin root\n- `files.required` - Array of required file names at plugin root\n\n## Required Sections\n\n### 1. Title (H1)\nPlugin name without emoji prefix (unlike README.md).\n\n**Example:**\n```markdown\n# GitHub Context Plugin\n```\n\n### 2. Quick Reference\nBrief 2-3 sentence technical overview of plugin purpose.\n\n**Must include:**\n- \"When to use\" list with 2-4 bullet points\n- Concise use cases\n\n**Example:**\n```markdown\n## Quick Reference\n\n**Purpose**: GitHub integration with branch context, commit enhancement, and issue synchronization.\n\n**When to use**:\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n```\n\n### 3. Hook Summary\nTable format listing all hooks with key metadata.\n\n**Required columns:**\n- Hook (file name without .ts extension)\n- Event (hook event type)\n- Blocking (Yes/No)\n- Purpose (brief one-line description)\n\n**Example:**\n```markdown\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| install-github | SessionStart | No | Installs GitHub CLI on remote environments |\n| add-branch-context | SessionStart | No | Displays linked issue and branch sync status |\n| sync-plan-to-issue | PostToolUse[Write\\|Edit] | No | Creates/updates GitHub issues from plan files |\n```\n\n### 4. Key Features\nBrief technical descriptions of major capabilities. Use H3 subsections for each feature.\n\nKeep descriptions concise (1-3 sentences per feature).\n\n**Example:**\n```markdown\n## Key Features\n\n### Branch Context Discovery\nShows full GitHub issue content linked to current branch via state file, GitHub search, or issue body markers.\n\n### Commit Enhancement\nEnriches git commits with task context and issue references for both main agent and subagents.\n```\n\n### 5. State Files (Optional but Recommended)\nDocument any state files the plugin creates or uses.\n\n**For each state file:**\n- H3 heading with file name\n- **Location**: Full path\n- **Purpose**: What it stores\n- JSON schema example\n\n**Example:**\n```markdown\n## State Files\n\n### plan-issues.json\n\n**Location**: `.claude/logs/plan-issues.json`\n**Purpose**: Tracks GitHub issue associations with plan files\n\n```json\n{\n  \"plan-file-path.md\": {\n    \"issueNumber\": 123,\n    \"issueUrl\": \"https://github.com/owner/repo/issues/123\",\n    \"createdAt\": \"2025-01-15T10:30:00Z\"\n  }\n}\n```\n```\n\n### 6. Installation\nInstallation command only (no elaboration - that's in README.md).\n\n**Example:**\n```markdown\n## Installation\n\n```bash\nclaude plugin install plugin-name@constellos\n```\n```\n\n### 7. Debug Logging\nEnvironment variable for debug mode (if applicable).\n\n**Example:**\n```markdown\n## Debug Logging\n\n```bash\nDEBUG=hook-name claude\n# Or for all hooks\nDEBUG=* claude\n```\n\nLogs written to `.claude/logs/hook-events.json`.\n```\n\n### 8. See Also\nLinks to related documentation (3-5 links maximum).\n\n**Must include:**\n- Link to plugin README.md\n- Link to root marketplace CLAUDE.md\n- Optional: Related plugins, official docs\n\n**Example:**\n```markdown\n## See Also\n\n- [Full Documentation](./README.md) - Comprehensive plugin guide\n- [Marketplace](../../CLAUDE.md) - All available plugins\n- [Official Claude Code Docs](https://github.com/anthropics/claude-code)\n```\n\n## Optional Sections\n\n### MCP Configuration (if applicable)\nIf plugin uses MCP servers, document configuration.\n\n### Requirements (if applicable)\nIf plugin has special requirements (external CLIs, services), document them.\n\n## Formatting Guidelines\n\n**Conciseness:**\n- Keep descriptions brief and technical\n- Use bullet points over paragraphs where possible\n- Focus on what Claude AI needs to understand the plugin\n\n**Code blocks:**\n- Always specify language (bash, json, yaml, typescript)\n- Use proper syntax highlighting\n\n**Tables:**\n- Use tables for structured data (hook summaries, state files)\n- Keep table cells concise\n\n**Linking:**\n- Use relative paths for internal links\n- Use full URLs for external documentation\n\n## Implementation\n\nThis rule is enforced by the `enforce-structured-markdown.ts` PreToolUse[Write|Edit] hook in the project-context plugin.\n\nThe hook validates:\n1. YAML frontmatter presence and required fields\n2. Required heading structure\n3. H1 title format (no emoji prefix)\n4. Section organization\n\n## Example Structure\n\n**Good CLAUDE.md:**\n```markdown\n---\ntitle: Example Plugin\ndescription: Brief description\nversion: 0.1.0\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md]\n    required: [README.md]\n---\n\n# Example Plugin\n\n## Quick Reference\n\n**Purpose**: What the plugin does in 2-3 sentences.\n\n**When to use**:\n- Use case 1\n- Use case 2\n\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| my-hook | SessionStart | No | Does something |\n\n## Key Features\n\n### Feature Name\nBrief description.\n\n## Installation\n\n```bash\nclaude plugin install example@constellos\n```\n\n## Debug Logging\n\n```bash\nDEBUG=example claude\n```\n\n## See Also\n\n- [Full Documentation](./README.md)\n- [Marketplace](../../CLAUDE.md)\n```\n\n**Bad CLAUDE.md:**\n```markdown\n# Example Plugin\n\nMissing frontmatter, missing required sections, overly verbose content.\n```\n\n## Relationship to README.md\n\nCLAUDE.md should NOT duplicate README.md content. Instead:\n\n**CLAUDE.md contains:**\n- Quick technical reference\n- Hook summary table\n- State file schemas\n- Brief feature descriptions\n\n**README.md contains:**\n- Comprehensive documentation\n- Visual badges and styled headers\n- Detailed hook descriptions with examples\n- Installation walkthroughs\n- Use case explanations\n- Troubleshooting guides\n\n**Shared content:**\n- Core hook names and purposes (can sync via HTML comments if needed)\n\n## References\n\n- [README Structure Rule](./plugin-readme-structure.md)\n- [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)\n- [CLAUDE.md Template](../../templates/CLAUDE.template.md)\n","structuredPatch":[{"oldStart":330,"oldLines":6,"newStart":330,"newLines":6,"lines":[" "," ## References"," ","-- [README Structure Rule](./plugin-readme-structure.md)","+- [README Structure Rule](./plugin-readme.md)"," - [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)"," - [CLAUDE.md Template](../../templates/CLAUDE.template.md)"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:56.567Z","event":"typecheck-file","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:56.952Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","old_string":"- [README Structure Rule](./plugin-readme-structure.md)","new_string":"- [README Structure Rule](./plugin-readme.md)"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","oldString":"- [README Structure Rule](./plugin-readme-structure.md)","newString":"- [README Structure Rule](./plugin-readme.md)","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\n      \"# *\",\n      \"## Quick Reference\",\n      \"## Hook Summary\",\n      \"## Key Features\",\n      \"## Installation\",\n      \"## Debug Logging\",\n      \"## See Also\"\n    ]\n  frontmatter:\n    required: [\"title\", \"description\", \"version\", \"folder\"]\npaths:\n  - \"plugins/*/CLAUDE.md\"\n---\n\n# Plugin CLAUDE.md Structure\n\nThis rule enforces lightweight structure for AI-optimized plugin CLAUDE.md documentation.\n\n## Required Skills: None\n\n## Overview\n\nPlugin CLAUDE.md files provide AI-optimized quick reference documentation. They are intentionally lightweight and focused on:\n- Quick context for Claude AI agent\n- Hook summaries in table format\n- State file schemas\n- Essential installation and debugging info\n- Links to comprehensive README.md\n\nCLAUDE.md files complement README.md files but serve a different purpose:\n- **README.md**: User-facing, comprehensive, visual\n- **CLAUDE.md**: AI-optimized, quick reference, technical\n\n## Required Frontmatter\n\nAll plugin CLAUDE.md files must include YAML frontmatter with:\n\n```yaml\n---\ntitle: Plugin Name\ndescription: One-line description\nversion: 0.1.x\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks, ...]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md, .gitignore]\n    required: [README.md]\n---\n```\n\n**Required fields:**\n- `title` - Human-readable plugin name\n- `description` - One-line purpose description\n- `version` - Semantic version (matches plugin.json)\n- `folder` - Folder structure validation (subfolders and files)\n\n**Folder validation schema:**\n- `subfolders.allowed` - Array of allowed subdirectory names\n- `subfolders.required` - Array of required subdirectory names\n- `files.allowed` - Array of allowed file names at plugin root\n- `files.required` - Array of required file names at plugin root\n\n## Required Sections\n\n### 1. Title (H1)\nPlugin name without emoji prefix (unlike README.md).\n\n**Example:**\n```markdown\n# GitHub Context Plugin\n```\n\n### 2. Quick Reference\nBrief 2-3 sentence technical overview of plugin purpose.\n\n**Must include:**\n- \"When to use\" list with 2-4 bullet points\n- Concise use cases\n\n**Example:**\n```markdown\n## Quick Reference\n\n**Purpose**: GitHub integration with branch context, commit enhancement, and issue synchronization.\n\n**When to use**:\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n```\n\n### 3. Hook Summary\nTable format listing all hooks with key metadata.\n\n**Required columns:**\n- Hook (file name without .ts extension)\n- Event (hook event type)\n- Blocking (Yes/No)\n- Purpose (brief one-line description)\n\n**Example:**\n```markdown\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| install-github | SessionStart | No | Installs GitHub CLI on remote environments |\n| add-branch-context | SessionStart | No | Displays linked issue and branch sync status |\n| sync-plan-to-issue | PostToolUse[Write\\|Edit] | No | Creates/updates GitHub issues from plan files |\n```\n\n### 4. Key Features\nBrief technical descriptions of major capabilities. Use H3 subsections for each feature.\n\nKeep descriptions concise (1-3 sentences per feature).\n\n**Example:**\n```markdown\n## Key Features\n\n### Branch Context Discovery\nShows full GitHub issue content linked to current branch via state file, GitHub search, or issue body markers.\n\n### Commit Enhancement\nEnriches git commits with task context and issue references for both main agent and subagents.\n```\n\n### 5. State Files (Optional but Recommended)\nDocument any state files the plugin creates or uses.\n\n**For each state file:**\n- H3 heading with file name\n- **Location**: Full path\n- **Purpose**: What it stores\n- JSON schema example\n\n**Example:**\n```markdown\n## State Files\n\n### plan-issues.json\n\n**Location**: `.claude/logs/plan-issues.json`\n**Purpose**: Tracks GitHub issue associations with plan files\n\n```json\n{\n  \"plan-file-path.md\": {\n    \"issueNumber\": 123,\n    \"issueUrl\": \"https://github.com/owner/repo/issues/123\",\n    \"createdAt\": \"2025-01-15T10:30:00Z\"\n  }\n}\n```\n```\n\n### 6. Installation\nInstallation command only (no elaboration - that's in README.md).\n\n**Example:**\n```markdown\n## Installation\n\n```bash\nclaude plugin install plugin-name@constellos\n```\n```\n\n### 7. Debug Logging\nEnvironment variable for debug mode (if applicable).\n\n**Example:**\n```markdown\n## Debug Logging\n\n```bash\nDEBUG=hook-name claude\n# Or for all hooks\nDEBUG=* claude\n```\n\nLogs written to `.claude/logs/hook-events.json`.\n```\n\n### 8. See Also\nLinks to related documentation (3-5 links maximum).\n\n**Must include:**\n- Link to plugin README.md\n- Link to root marketplace CLAUDE.md\n- Optional: Related plugins, official docs\n\n**Example:**\n```markdown\n## See Also\n\n- [Full Documentation](./README.md) - Comprehensive plugin guide\n- [Marketplace](../../CLAUDE.md) - All available plugins\n- [Official Claude Code Docs](https://github.com/anthropics/claude-code)\n```\n\n## Optional Sections\n\n### MCP Configuration (if applicable)\nIf plugin uses MCP servers, document configuration.\n\n### Requirements (if applicable)\nIf plugin has special requirements (external CLIs, services), document them.\n\n## Formatting Guidelines\n\n**Conciseness:**\n- Keep descriptions brief and technical\n- Use bullet points over paragraphs where possible\n- Focus on what Claude AI needs to understand the plugin\n\n**Code blocks:**\n- Always specify language (bash, json, yaml, typescript)\n- Use proper syntax highlighting\n\n**Tables:**\n- Use tables for structured data (hook summaries, state files)\n- Keep table cells concise\n\n**Linking:**\n- Use relative paths for internal links\n- Use full URLs for external documentation\n\n## Implementation\n\nThis rule is enforced by the `enforce-structured-markdown.ts` PreToolUse[Write|Edit] hook in the project-context plugin.\n\nThe hook validates:\n1. YAML frontmatter presence and required fields\n2. Required heading structure\n3. H1 title format (no emoji prefix)\n4. Section organization\n\n## Example Structure\n\n**Good CLAUDE.md:**\n```markdown\n---\ntitle: Example Plugin\ndescription: Brief description\nversion: 0.1.0\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md]\n    required: [README.md]\n---\n\n# Example Plugin\n\n## Quick Reference\n\n**Purpose**: What the plugin does in 2-3 sentences.\n\n**When to use**:\n- Use case 1\n- Use case 2\n\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| my-hook | SessionStart | No | Does something |\n\n## Key Features\n\n### Feature Name\nBrief description.\n\n## Installation\n\n```bash\nclaude plugin install example@constellos\n```\n\n## Debug Logging\n\n```bash\nDEBUG=example claude\n```\n\n## See Also\n\n- [Full Documentation](./README.md)\n- [Marketplace](../../CLAUDE.md)\n```\n\n**Bad CLAUDE.md:**\n```markdown\n# Example Plugin\n\nMissing frontmatter, missing required sections, overly verbose content.\n```\n\n## Relationship to README.md\n\nCLAUDE.md should NOT duplicate README.md content. Instead:\n\n**CLAUDE.md contains:**\n- Quick technical reference\n- Hook summary table\n- State file schemas\n- Brief feature descriptions\n\n**README.md contains:**\n- Comprehensive documentation\n- Visual badges and styled headers\n- Detailed hook descriptions with examples\n- Installation walkthroughs\n- Use case explanations\n- Troubleshooting guides\n\n**Shared content:**\n- Core hook names and purposes (can sync via HTML comments if needed)\n\n## References\n\n- [README Structure Rule](./plugin-readme-structure.md)\n- [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)\n- [CLAUDE.md Template](../../templates/CLAUDE.template.md)\n","structuredPatch":[{"oldStart":330,"oldLines":6,"newStart":330,"newLines":6,"lines":[" "," ## References"," ","-- [README Structure Rule](./plugin-readme-structure.md)","+- [README Structure Rule](./plugin-readme.md)"," - [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)"," - [CLAUDE.md Template](../../templates/CLAUDE.template.md)"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:56.956Z","event":"lint-file","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:57.155Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","old_string":"- [README Structure Rule](./plugin-readme-structure.md)","new_string":"- [README Structure Rule](./plugin-readme.md)"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","oldString":"- [README Structure Rule](./plugin-readme-structure.md)","newString":"- [README Structure Rule](./plugin-readme.md)","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\n      \"# *\",\n      \"## Quick Reference\",\n      \"## Hook Summary\",\n      \"## Key Features\",\n      \"## Installation\",\n      \"## Debug Logging\",\n      \"## See Also\"\n    ]\n  frontmatter:\n    required: [\"title\", \"description\", \"version\", \"folder\"]\npaths:\n  - \"plugins/*/CLAUDE.md\"\n---\n\n# Plugin CLAUDE.md Structure\n\nThis rule enforces lightweight structure for AI-optimized plugin CLAUDE.md documentation.\n\n## Required Skills: None\n\n## Overview\n\nPlugin CLAUDE.md files provide AI-optimized quick reference documentation. They are intentionally lightweight and focused on:\n- Quick context for Claude AI agent\n- Hook summaries in table format\n- State file schemas\n- Essential installation and debugging info\n- Links to comprehensive README.md\n\nCLAUDE.md files complement README.md files but serve a different purpose:\n- **README.md**: User-facing, comprehensive, visual\n- **CLAUDE.md**: AI-optimized, quick reference, technical\n\n## Required Frontmatter\n\nAll plugin CLAUDE.md files must include YAML frontmatter with:\n\n```yaml\n---\ntitle: Plugin Name\ndescription: One-line description\nversion: 0.1.x\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks, ...]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md, .gitignore]\n    required: [README.md]\n---\n```\n\n**Required fields:**\n- `title` - Human-readable plugin name\n- `description` - One-line purpose description\n- `version` - Semantic version (matches plugin.json)\n- `folder` - Folder structure validation (subfolders and files)\n\n**Folder validation schema:**\n- `subfolders.allowed` - Array of allowed subdirectory names\n- `subfolders.required` - Array of required subdirectory names\n- `files.allowed` - Array of allowed file names at plugin root\n- `files.required` - Array of required file names at plugin root\n\n## Required Sections\n\n### 1. Title (H1)\nPlugin name without emoji prefix (unlike README.md).\n\n**Example:**\n```markdown\n# GitHub Context Plugin\n```\n\n### 2. Quick Reference\nBrief 2-3 sentence technical overview of plugin purpose.\n\n**Must include:**\n- \"When to use\" list with 2-4 bullet points\n- Concise use cases\n\n**Example:**\n```markdown\n## Quick Reference\n\n**Purpose**: GitHub integration with branch context, commit enhancement, and issue synchronization.\n\n**When to use**:\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n```\n\n### 3. Hook Summary\nTable format listing all hooks with key metadata.\n\n**Required columns:**\n- Hook (file name without .ts extension)\n- Event (hook event type)\n- Blocking (Yes/No)\n- Purpose (brief one-line description)\n\n**Example:**\n```markdown\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| install-github | SessionStart | No | Installs GitHub CLI on remote environments |\n| add-branch-context | SessionStart | No | Displays linked issue and branch sync status |\n| sync-plan-to-issue | PostToolUse[Write\\|Edit] | No | Creates/updates GitHub issues from plan files |\n```\n\n### 4. Key Features\nBrief technical descriptions of major capabilities. Use H3 subsections for each feature.\n\nKeep descriptions concise (1-3 sentences per feature).\n\n**Example:**\n```markdown\n## Key Features\n\n### Branch Context Discovery\nShows full GitHub issue content linked to current branch via state file, GitHub search, or issue body markers.\n\n### Commit Enhancement\nEnriches git commits with task context and issue references for both main agent and subagents.\n```\n\n### 5. State Files (Optional but Recommended)\nDocument any state files the plugin creates or uses.\n\n**For each state file:**\n- H3 heading with file name\n- **Location**: Full path\n- **Purpose**: What it stores\n- JSON schema example\n\n**Example:**\n```markdown\n## State Files\n\n### plan-issues.json\n\n**Location**: `.claude/logs/plan-issues.json`\n**Purpose**: Tracks GitHub issue associations with plan files\n\n```json\n{\n  \"plan-file-path.md\": {\n    \"issueNumber\": 123,\n    \"issueUrl\": \"https://github.com/owner/repo/issues/123\",\n    \"createdAt\": \"2025-01-15T10:30:00Z\"\n  }\n}\n```\n```\n\n### 6. Installation\nInstallation command only (no elaboration - that's in README.md).\n\n**Example:**\n```markdown\n## Installation\n\n```bash\nclaude plugin install plugin-name@constellos\n```\n```\n\n### 7. Debug Logging\nEnvironment variable for debug mode (if applicable).\n\n**Example:**\n```markdown\n## Debug Logging\n\n```bash\nDEBUG=hook-name claude\n# Or for all hooks\nDEBUG=* claude\n```\n\nLogs written to `.claude/logs/hook-events.json`.\n```\n\n### 8. See Also\nLinks to related documentation (3-5 links maximum).\n\n**Must include:**\n- Link to plugin README.md\n- Link to root marketplace CLAUDE.md\n- Optional: Related plugins, official docs\n\n**Example:**\n```markdown\n## See Also\n\n- [Full Documentation](./README.md) - Comprehensive plugin guide\n- [Marketplace](../../CLAUDE.md) - All available plugins\n- [Official Claude Code Docs](https://github.com/anthropics/claude-code)\n```\n\n## Optional Sections\n\n### MCP Configuration (if applicable)\nIf plugin uses MCP servers, document configuration.\n\n### Requirements (if applicable)\nIf plugin has special requirements (external CLIs, services), document them.\n\n## Formatting Guidelines\n\n**Conciseness:**\n- Keep descriptions brief and technical\n- Use bullet points over paragraphs where possible\n- Focus on what Claude AI needs to understand the plugin\n\n**Code blocks:**\n- Always specify language (bash, json, yaml, typescript)\n- Use proper syntax highlighting\n\n**Tables:**\n- Use tables for structured data (hook summaries, state files)\n- Keep table cells concise\n\n**Linking:**\n- Use relative paths for internal links\n- Use full URLs for external documentation\n\n## Implementation\n\nThis rule is enforced by the `enforce-structured-markdown.ts` PreToolUse[Write|Edit] hook in the project-context plugin.\n\nThe hook validates:\n1. YAML frontmatter presence and required fields\n2. Required heading structure\n3. H1 title format (no emoji prefix)\n4. Section organization\n\n## Example Structure\n\n**Good CLAUDE.md:**\n```markdown\n---\ntitle: Example Plugin\ndescription: Brief description\nversion: 0.1.0\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md]\n    required: [README.md]\n---\n\n# Example Plugin\n\n## Quick Reference\n\n**Purpose**: What the plugin does in 2-3 sentences.\n\n**When to use**:\n- Use case 1\n- Use case 2\n\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| my-hook | SessionStart | No | Does something |\n\n## Key Features\n\n### Feature Name\nBrief description.\n\n## Installation\n\n```bash\nclaude plugin install example@constellos\n```\n\n## Debug Logging\n\n```bash\nDEBUG=example claude\n```\n\n## See Also\n\n- [Full Documentation](./README.md)\n- [Marketplace](../../CLAUDE.md)\n```\n\n**Bad CLAUDE.md:**\n```markdown\n# Example Plugin\n\nMissing frontmatter, missing required sections, overly verbose content.\n```\n\n## Relationship to README.md\n\nCLAUDE.md should NOT duplicate README.md content. Instead:\n\n**CLAUDE.md contains:**\n- Quick technical reference\n- Hook summary table\n- State file schemas\n- Brief feature descriptions\n\n**README.md contains:**\n- Comprehensive documentation\n- Visual badges and styled headers\n- Detailed hook descriptions with examples\n- Installation walkthroughs\n- Use case explanations\n- Troubleshooting guides\n\n**Shared content:**\n- Core hook names and purposes (can sync via HTML comments if needed)\n\n## References\n\n- [README Structure Rule](./plugin-readme-structure.md)\n- [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)\n- [CLAUDE.md Template](../../templates/CLAUDE.template.md)\n","structuredPatch":[{"oldStart":330,"oldLines":6,"newStart":330,"newLines":6,"lines":[" "," ## References"," ","-- [README Structure Rule](./plugin-readme-structure.md)","+- [README Structure Rule](./plugin-readme.md)"," - [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)"," - [CLAUDE.md Template](../../templates/CLAUDE.template.md)"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:57.164Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","old_string":"- [README Structure Rule](./plugin-readme-structure.md)","new_string":"- [README Structure Rule](./plugin-readme.md)"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","oldString":"- [README Structure Rule](./plugin-readme-structure.md)","newString":"- [README Structure Rule](./plugin-readme.md)","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\n      \"# *\",\n      \"## Quick Reference\",\n      \"## Hook Summary\",\n      \"## Key Features\",\n      \"## Installation\",\n      \"## Debug Logging\",\n      \"## See Also\"\n    ]\n  frontmatter:\n    required: [\"title\", \"description\", \"version\", \"folder\"]\npaths:\n  - \"plugins/*/CLAUDE.md\"\n---\n\n# Plugin CLAUDE.md Structure\n\nThis rule enforces lightweight structure for AI-optimized plugin CLAUDE.md documentation.\n\n## Required Skills: None\n\n## Overview\n\nPlugin CLAUDE.md files provide AI-optimized quick reference documentation. They are intentionally lightweight and focused on:\n- Quick context for Claude AI agent\n- Hook summaries in table format\n- State file schemas\n- Essential installation and debugging info\n- Links to comprehensive README.md\n\nCLAUDE.md files complement README.md files but serve a different purpose:\n- **README.md**: User-facing, comprehensive, visual\n- **CLAUDE.md**: AI-optimized, quick reference, technical\n\n## Required Frontmatter\n\nAll plugin CLAUDE.md files must include YAML frontmatter with:\n\n```yaml\n---\ntitle: Plugin Name\ndescription: One-line description\nversion: 0.1.x\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks, ...]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md, .gitignore]\n    required: [README.md]\n---\n```\n\n**Required fields:**\n- `title` - Human-readable plugin name\n- `description` - One-line purpose description\n- `version` - Semantic version (matches plugin.json)\n- `folder` - Folder structure validation (subfolders and files)\n\n**Folder validation schema:**\n- `subfolders.allowed` - Array of allowed subdirectory names\n- `subfolders.required` - Array of required subdirectory names\n- `files.allowed` - Array of allowed file names at plugin root\n- `files.required` - Array of required file names at plugin root\n\n## Required Sections\n\n### 1. Title (H1)\nPlugin name without emoji prefix (unlike README.md).\n\n**Example:**\n```markdown\n# GitHub Context Plugin\n```\n\n### 2. Quick Reference\nBrief 2-3 sentence technical overview of plugin purpose.\n\n**Must include:**\n- \"When to use\" list with 2-4 bullet points\n- Concise use cases\n\n**Example:**\n```markdown\n## Quick Reference\n\n**Purpose**: GitHub integration with branch context, commit enhancement, and issue synchronization.\n\n**When to use**:\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n```\n\n### 3. Hook Summary\nTable format listing all hooks with key metadata.\n\n**Required columns:**\n- Hook (file name without .ts extension)\n- Event (hook event type)\n- Blocking (Yes/No)\n- Purpose (brief one-line description)\n\n**Example:**\n```markdown\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| install-github | SessionStart | No | Installs GitHub CLI on remote environments |\n| add-branch-context | SessionStart | No | Displays linked issue and branch sync status |\n| sync-plan-to-issue | PostToolUse[Write\\|Edit] | No | Creates/updates GitHub issues from plan files |\n```\n\n### 4. Key Features\nBrief technical descriptions of major capabilities. Use H3 subsections for each feature.\n\nKeep descriptions concise (1-3 sentences per feature).\n\n**Example:**\n```markdown\n## Key Features\n\n### Branch Context Discovery\nShows full GitHub issue content linked to current branch via state file, GitHub search, or issue body markers.\n\n### Commit Enhancement\nEnriches git commits with task context and issue references for both main agent and subagents.\n```\n\n### 5. State Files (Optional but Recommended)\nDocument any state files the plugin creates or uses.\n\n**For each state file:**\n- H3 heading with file name\n- **Location**: Full path\n- **Purpose**: What it stores\n- JSON schema example\n\n**Example:**\n```markdown\n## State Files\n\n### plan-issues.json\n\n**Location**: `.claude/logs/plan-issues.json`\n**Purpose**: Tracks GitHub issue associations with plan files\n\n```json\n{\n  \"plan-file-path.md\": {\n    \"issueNumber\": 123,\n    \"issueUrl\": \"https://github.com/owner/repo/issues/123\",\n    \"createdAt\": \"2025-01-15T10:30:00Z\"\n  }\n}\n```\n```\n\n### 6. Installation\nInstallation command only (no elaboration - that's in README.md).\n\n**Example:**\n```markdown\n## Installation\n\n```bash\nclaude plugin install plugin-name@constellos\n```\n```\n\n### 7. Debug Logging\nEnvironment variable for debug mode (if applicable).\n\n**Example:**\n```markdown\n## Debug Logging\n\n```bash\nDEBUG=hook-name claude\n# Or for all hooks\nDEBUG=* claude\n```\n\nLogs written to `.claude/logs/hook-events.json`.\n```\n\n### 8. See Also\nLinks to related documentation (3-5 links maximum).\n\n**Must include:**\n- Link to plugin README.md\n- Link to root marketplace CLAUDE.md\n- Optional: Related plugins, official docs\n\n**Example:**\n```markdown\n## See Also\n\n- [Full Documentation](./README.md) - Comprehensive plugin guide\n- [Marketplace](../../CLAUDE.md) - All available plugins\n- [Official Claude Code Docs](https://github.com/anthropics/claude-code)\n```\n\n## Optional Sections\n\n### MCP Configuration (if applicable)\nIf plugin uses MCP servers, document configuration.\n\n### Requirements (if applicable)\nIf plugin has special requirements (external CLIs, services), document them.\n\n## Formatting Guidelines\n\n**Conciseness:**\n- Keep descriptions brief and technical\n- Use bullet points over paragraphs where possible\n- Focus on what Claude AI needs to understand the plugin\n\n**Code blocks:**\n- Always specify language (bash, json, yaml, typescript)\n- Use proper syntax highlighting\n\n**Tables:**\n- Use tables for structured data (hook summaries, state files)\n- Keep table cells concise\n\n**Linking:**\n- Use relative paths for internal links\n- Use full URLs for external documentation\n\n## Implementation\n\nThis rule is enforced by the `enforce-structured-markdown.ts` PreToolUse[Write|Edit] hook in the project-context plugin.\n\nThe hook validates:\n1. YAML frontmatter presence and required fields\n2. Required heading structure\n3. H1 title format (no emoji prefix)\n4. Section organization\n\n## Example Structure\n\n**Good CLAUDE.md:**\n```markdown\n---\ntitle: Example Plugin\ndescription: Brief description\nversion: 0.1.0\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md]\n    required: [README.md]\n---\n\n# Example Plugin\n\n## Quick Reference\n\n**Purpose**: What the plugin does in 2-3 sentences.\n\n**When to use**:\n- Use case 1\n- Use case 2\n\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| my-hook | SessionStart | No | Does something |\n\n## Key Features\n\n### Feature Name\nBrief description.\n\n## Installation\n\n```bash\nclaude plugin install example@constellos\n```\n\n## Debug Logging\n\n```bash\nDEBUG=example claude\n```\n\n## See Also\n\n- [Full Documentation](./README.md)\n- [Marketplace](../../CLAUDE.md)\n```\n\n**Bad CLAUDE.md:**\n```markdown\n# Example Plugin\n\nMissing frontmatter, missing required sections, overly verbose content.\n```\n\n## Relationship to README.md\n\nCLAUDE.md should NOT duplicate README.md content. Instead:\n\n**CLAUDE.md contains:**\n- Quick technical reference\n- Hook summary table\n- State file schemas\n- Brief feature descriptions\n\n**README.md contains:**\n- Comprehensive documentation\n- Visual badges and styled headers\n- Detailed hook descriptions with examples\n- Installation walkthroughs\n- Use case explanations\n- Troubleshooting guides\n\n**Shared content:**\n- Core hook names and purposes (can sync via HTML comments if needed)\n\n## References\n\n- [README Structure Rule](./plugin-readme-structure.md)\n- [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)\n- [CLAUDE.md Template](../../templates/CLAUDE.template.md)\n","structuredPatch":[{"oldStart":330,"oldLines":6,"newStart":330,"newLines":6,"lines":[" "," ## References"," ","-- [README Structure Rule](./plugin-readme-structure.md)","+- [README Structure Rule](./plugin-readme.md)"," - [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)"," - [CLAUDE.md Template](../../templates/CLAUDE.template.md)"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:57.167Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:55:57.166Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:55:57.253Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","old_string":"- [README Structure Rule](./plugin-readme-structure.md)","new_string":"- [README Structure Rule](./plugin-readme.md)"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","oldString":"- [README Structure Rule](./plugin-readme-structure.md)","newString":"- [README Structure Rule](./plugin-readme.md)","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\n      \"# *\",\n      \"## Quick Reference\",\n      \"## Hook Summary\",\n      \"## Key Features\",\n      \"## Installation\",\n      \"## Debug Logging\",\n      \"## See Also\"\n    ]\n  frontmatter:\n    required: [\"title\", \"description\", \"version\", \"folder\"]\npaths:\n  - \"plugins/*/CLAUDE.md\"\n---\n\n# Plugin CLAUDE.md Structure\n\nThis rule enforces lightweight structure for AI-optimized plugin CLAUDE.md documentation.\n\n## Required Skills: None\n\n## Overview\n\nPlugin CLAUDE.md files provide AI-optimized quick reference documentation. They are intentionally lightweight and focused on:\n- Quick context for Claude AI agent\n- Hook summaries in table format\n- State file schemas\n- Essential installation and debugging info\n- Links to comprehensive README.md\n\nCLAUDE.md files complement README.md files but serve a different purpose:\n- **README.md**: User-facing, comprehensive, visual\n- **CLAUDE.md**: AI-optimized, quick reference, technical\n\n## Required Frontmatter\n\nAll plugin CLAUDE.md files must include YAML frontmatter with:\n\n```yaml\n---\ntitle: Plugin Name\ndescription: One-line description\nversion: 0.1.x\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks, ...]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md, .gitignore]\n    required: [README.md]\n---\n```\n\n**Required fields:**\n- `title` - Human-readable plugin name\n- `description` - One-line purpose description\n- `version` - Semantic version (matches plugin.json)\n- `folder` - Folder structure validation (subfolders and files)\n\n**Folder validation schema:**\n- `subfolders.allowed` - Array of allowed subdirectory names\n- `subfolders.required` - Array of required subdirectory names\n- `files.allowed` - Array of allowed file names at plugin root\n- `files.required` - Array of required file names at plugin root\n\n## Required Sections\n\n### 1. Title (H1)\nPlugin name without emoji prefix (unlike README.md).\n\n**Example:**\n```markdown\n# GitHub Context Plugin\n```\n\n### 2. Quick Reference\nBrief 2-3 sentence technical overview of plugin purpose.\n\n**Must include:**\n- \"When to use\" list with 2-4 bullet points\n- Concise use cases\n\n**Example:**\n```markdown\n## Quick Reference\n\n**Purpose**: GitHub integration with branch context, commit enhancement, and issue synchronization.\n\n**When to use**:\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n```\n\n### 3. Hook Summary\nTable format listing all hooks with key metadata.\n\n**Required columns:**\n- Hook (file name without .ts extension)\n- Event (hook event type)\n- Blocking (Yes/No)\n- Purpose (brief one-line description)\n\n**Example:**\n```markdown\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| install-github | SessionStart | No | Installs GitHub CLI on remote environments |\n| add-branch-context | SessionStart | No | Displays linked issue and branch sync status |\n| sync-plan-to-issue | PostToolUse[Write\\|Edit] | No | Creates/updates GitHub issues from plan files |\n```\n\n### 4. Key Features\nBrief technical descriptions of major capabilities. Use H3 subsections for each feature.\n\nKeep descriptions concise (1-3 sentences per feature).\n\n**Example:**\n```markdown\n## Key Features\n\n### Branch Context Discovery\nShows full GitHub issue content linked to current branch via state file, GitHub search, or issue body markers.\n\n### Commit Enhancement\nEnriches git commits with task context and issue references for both main agent and subagents.\n```\n\n### 5. State Files (Optional but Recommended)\nDocument any state files the plugin creates or uses.\n\n**For each state file:**\n- H3 heading with file name\n- **Location**: Full path\n- **Purpose**: What it stores\n- JSON schema example\n\n**Example:**\n```markdown\n## State Files\n\n### plan-issues.json\n\n**Location**: `.claude/logs/plan-issues.json`\n**Purpose**: Tracks GitHub issue associations with plan files\n\n```json\n{\n  \"plan-file-path.md\": {\n    \"issueNumber\": 123,\n    \"issueUrl\": \"https://github.com/owner/repo/issues/123\",\n    \"createdAt\": \"2025-01-15T10:30:00Z\"\n  }\n}\n```\n```\n\n### 6. Installation\nInstallation command only (no elaboration - that's in README.md).\n\n**Example:**\n```markdown\n## Installation\n\n```bash\nclaude plugin install plugin-name@constellos\n```\n```\n\n### 7. Debug Logging\nEnvironment variable for debug mode (if applicable).\n\n**Example:**\n```markdown\n## Debug Logging\n\n```bash\nDEBUG=hook-name claude\n# Or for all hooks\nDEBUG=* claude\n```\n\nLogs written to `.claude/logs/hook-events.json`.\n```\n\n### 8. See Also\nLinks to related documentation (3-5 links maximum).\n\n**Must include:**\n- Link to plugin README.md\n- Link to root marketplace CLAUDE.md\n- Optional: Related plugins, official docs\n\n**Example:**\n```markdown\n## See Also\n\n- [Full Documentation](./README.md) - Comprehensive plugin guide\n- [Marketplace](../../CLAUDE.md) - All available plugins\n- [Official Claude Code Docs](https://github.com/anthropics/claude-code)\n```\n\n## Optional Sections\n\n### MCP Configuration (if applicable)\nIf plugin uses MCP servers, document configuration.\n\n### Requirements (if applicable)\nIf plugin has special requirements (external CLIs, services), document them.\n\n## Formatting Guidelines\n\n**Conciseness:**\n- Keep descriptions brief and technical\n- Use bullet points over paragraphs where possible\n- Focus on what Claude AI needs to understand the plugin\n\n**Code blocks:**\n- Always specify language (bash, json, yaml, typescript)\n- Use proper syntax highlighting\n\n**Tables:**\n- Use tables for structured data (hook summaries, state files)\n- Keep table cells concise\n\n**Linking:**\n- Use relative paths for internal links\n- Use full URLs for external documentation\n\n## Implementation\n\nThis rule is enforced by the `enforce-structured-markdown.ts` PreToolUse[Write|Edit] hook in the project-context plugin.\n\nThe hook validates:\n1. YAML frontmatter presence and required fields\n2. Required heading structure\n3. H1 title format (no emoji prefix)\n4. Section organization\n\n## Example Structure\n\n**Good CLAUDE.md:**\n```markdown\n---\ntitle: Example Plugin\ndescription: Brief description\nversion: 0.1.0\nfolder:\n  subfolders:\n    allowed: [.claude-plugin, hooks]\n    required: [.claude-plugin, hooks]\n  files:\n    allowed: [CLAUDE.md, README.md]\n    required: [README.md]\n---\n\n# Example Plugin\n\n## Quick Reference\n\n**Purpose**: What the plugin does in 2-3 sentences.\n\n**When to use**:\n- Use case 1\n- Use case 2\n\n## Hook Summary\n\n| Hook | Event | Blocking | Purpose |\n|------|-------|----------|---------|\n| my-hook | SessionStart | No | Does something |\n\n## Key Features\n\n### Feature Name\nBrief description.\n\n## Installation\n\n```bash\nclaude plugin install example@constellos\n```\n\n## Debug Logging\n\n```bash\nDEBUG=example claude\n```\n\n## See Also\n\n- [Full Documentation](./README.md)\n- [Marketplace](../../CLAUDE.md)\n```\n\n**Bad CLAUDE.md:**\n```markdown\n# Example Plugin\n\nMissing frontmatter, missing required sections, overly verbose content.\n```\n\n## Relationship to README.md\n\nCLAUDE.md should NOT duplicate README.md content. Instead:\n\n**CLAUDE.md contains:**\n- Quick technical reference\n- Hook summary table\n- State file schemas\n- Brief feature descriptions\n\n**README.md contains:**\n- Comprehensive documentation\n- Visual badges and styled headers\n- Detailed hook descriptions with examples\n- Installation walkthroughs\n- Use case explanations\n- Troubleshooting guides\n\n**Shared content:**\n- Core hook names and purposes (can sync via HTML comments if needed)\n\n## References\n\n- [README Structure Rule](./plugin-readme-structure.md)\n- [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)\n- [CLAUDE.md Template](../../templates/CLAUDE.template.md)\n","structuredPatch":[{"oldStart":330,"oldLines":6,"newStart":330,"newLines":6,"lines":[" "," ## References"," ","-- [README Structure Rule](./plugin-readme-structure.md)","+- [README Structure Rule](./plugin-readme.md)"," - [Official Claude Code Plugins](https://github.com/anthropics/claude-code/tree/main/plugins)"," - [CLAUDE.md Template](../../templates/CLAUDE.template.md)"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:57.257Z","event":"create-plan-symlink","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_01BtnxsdvHZVbAoFMRXeVeKZ"}}
{"timestamp":"2026-01-01T03:55:57.257Z","event":"create-plan-symlink","type":"output","data":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md","absolutePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/plugin-claude-md.md"}}
{"timestamp":"2026-01-01T03:55:57.257Z","event":"create-plan-symlink","type":"output","data":{"action":"skip","reason":"Not a plan file"}}
{"timestamp":"2026-01-01T03:55:57.259Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse"}}}
{"timestamp":"2026-01-01T03:55:57.348Z","event":"lint-file","type":"output","data":{"success":false,"lint_errors":"$ eslint plugins/ shared/\n/usr/bin/bash: line 1: eslint: command not found\nerror: script \"lint\" exited with code 127\n"}}
{"timestamp":"2026-01-01T03:55:57.348Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse","additionalContext":"ESLint found errors:\n\n$ eslint plugins/ shared/\n/usr/bin/bash: line 1: eslint: command not found\nerror: script \"lint\" exited with code 127\n\n\nPlease fix these linting issues."}}}
{"timestamp":"2026-01-01T03:55:57.801Z","event":"typecheck-file","type":"output","data":{"success":false,"type_errors":"error TS2688: Cannot find type definition file for 'node'.\n  The file is in the program because:\n    Entry point of type library 'node' specified in compilerOptions\n"}}
{"timestamp":"2026-01-01T03:55:57.802Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse","additionalContext":"TypeScript type checking found errors:\n\nerror TS2688: Cannot find type definition file for 'node'.\n  The file is in the program because:\n    Entry point of type library 'node' specified in compilerOptions\n\n\nPlease fix these type errors."}}}
{"timestamp":"2026-01-01T03:55:58.635Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Read","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md"},"tool_response":{"type":"text","file":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","content":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\"## Required Skills:*\"]\n  frontmatter:\n    allowed: [\"*\"]\n    required: [\"markdown\"]\n---\n\n# Rules Markdown Structure\n\nThis meta-rule defines the required structure for all rule files in `.claude/rules/`.\n\n## Required Skills: None\n\nAll rule files MUST include a \"Required Skills:\" heading that specifies which skills must be invoked (either preloaded via agent metadata or called via the Skill tool) before Write or Edit operations on files matching the rule's path pattern.\n\n### Format\n\nThe \"Required Skills:\" heading must follow this format:\n\n```markdown\n## Required Skills: skill1, skill2, skill3\n```\n\nOr, if no skills are required:\n\n```markdown\n## Required Skills: None\n```\n\n### Examples\n\n**Single skill:**\n```markdown\n## Required Skills: claude-plugins\n```\n\n**Multiple skills:**\n```markdown\n## Required Skills: claude-plugins, turborepo-vercel\n```\n\n**No skills required:**\n```markdown\n## Required Skills: None\n```\n\n## Implementation\n\nThe `validate-rules-file.ts` PreToolUse hook (from project-context plugin) validates:\n1. All rules files have a \"Required Skills:\" heading\n2. The heading format is correct (prefix with colon, comma-separated list or \"None\")\n3. Rule files have the required frontmatter structure\n\n## Frontmatter Requirements\n\nAll rule files MUST include frontmatter with:\n- `markdown` field defining heading validation rules\n\nExample:\n```yaml\n---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\"]\n    required: [\"## Overview\", \"## Implementation\", \"## Required Skills:*\"]\n---\n```\n\n## Notes\n\n- This meta-rule validates the structure of other rule files\n- The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)\n- Skills listed must match skill names in `.claude/skills/`\n- The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files\n","numLines":78,"startLine":1,"totalLines":78}},"tool_use_id":"toolu_019BW3mJjw2w8hG5HZexgvbe"}}
{"timestamp":"2026-01-01T03:55:58.641Z","event":"add-folder-context","type":"input","data":{"tool_name":"Read","tool_use_id":"toolu_019BW3mJjw2w8hG5HZexgvbe"}}
{"timestamp":"2026-01-01T03:55:58.649Z","event":"add-folder-context","type":"output","data":{"success":true,"found":0}}
{"timestamp":"2026-01-01T03:55:58.649Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:56:11.157Z","event":"PreToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PreToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","old_string":"- Skills listed must match skill names in `.claude/skills/`","new_string":"- Skills listed should reference valid skill names from installed plugins"},"tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:11.166Z","event":"validate-rules-file","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:11.168Z","event":"validate-rules-file","type":"output","data":{"filename":"rule-file.md","hasMarkdownFrontmatter":false,"isMdRule":false}}
{"timestamp":"2026-01-01T03:56:11.175Z","event":"validate-rules-file","type":"output","data":{"status":"valid"}}
{"timestamp":"2026-01-01T03:56:11.175Z","event":"PreToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PreToolUse","permissionDecision":"allow"}}}
{"timestamp":"2026-01-01T03:56:11.271Z","event":"PreToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PreToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","old_string":"- Skills listed must match skill names in `.claude/skills/`","new_string":"- Skills listed should reference valid skill names from installed plugins"},"tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:11.282Z","event":"PreToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PreToolUse","permissionDecision":"allow"}}}
{"timestamp":"2026-01-01T03:56:16.572Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","old_string":"- Skills listed must match skill names in `.claude/skills/`","new_string":"- Skills listed should reference valid skill names from installed plugins"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","oldString":"- Skills listed must match skill names in `.claude/skills/`","newString":"- Skills listed should reference valid skill names from installed plugins","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\"## Required Skills:*\"]\n  frontmatter:\n    allowed: [\"*\"]\n    required: [\"markdown\"]\n---\n\n# Rules Markdown Structure\n\nThis meta-rule defines the required structure for all rule files in `.claude/rules/`.\n\n## Required Skills: None\n\nAll rule files MUST include a \"Required Skills:\" heading that specifies which skills must be invoked (either preloaded via agent metadata or called via the Skill tool) before Write or Edit operations on files matching the rule's path pattern.\n\n### Format\n\nThe \"Required Skills:\" heading must follow this format:\n\n```markdown\n## Required Skills: skill1, skill2, skill3\n```\n\nOr, if no skills are required:\n\n```markdown\n## Required Skills: None\n```\n\n### Examples\n\n**Single skill:**\n```markdown\n## Required Skills: claude-plugins\n```\n\n**Multiple skills:**\n```markdown\n## Required Skills: claude-plugins, turborepo-vercel\n```\n\n**No skills required:**\n```markdown\n## Required Skills: None\n```\n\n## Implementation\n\nThe `validate-rules-file.ts` PreToolUse hook (from project-context plugin) validates:\n1. All rules files have a \"Required Skills:\" heading\n2. The heading format is correct (prefix with colon, comma-separated list or \"None\")\n3. Rule files have the required frontmatter structure\n\n## Frontmatter Requirements\n\nAll rule files MUST include frontmatter with:\n- `markdown` field defining heading validation rules\n\nExample:\n```yaml\n---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\"]\n    required: [\"## Overview\", \"## Implementation\", \"## Required Skills:*\"]\n---\n```\n\n## Notes\n\n- This meta-rule validates the structure of other rule files\n- The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)\n- Skills listed must match skill names in `.claude/skills/`\n- The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files\n","structuredPatch":[{"oldStart":73,"oldLines":5,"newStart":73,"newLines":5,"lines":[" "," - This meta-rule validates the structure of other rule files"," - The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)","-- Skills listed must match skill names in `.claude/skills/`","+- Skills listed should reference valid skill names from installed plugins"," - The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:16.596Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:56:16.616Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","old_string":"- Skills listed must match skill names in `.claude/skills/`","new_string":"- Skills listed should reference valid skill names from installed plugins"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","oldString":"- Skills listed must match skill names in `.claude/skills/`","newString":"- Skills listed should reference valid skill names from installed plugins","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\"## Required Skills:*\"]\n  frontmatter:\n    allowed: [\"*\"]\n    required: [\"markdown\"]\n---\n\n# Rules Markdown Structure\n\nThis meta-rule defines the required structure for all rule files in `.claude/rules/`.\n\n## Required Skills: None\n\nAll rule files MUST include a \"Required Skills:\" heading that specifies which skills must be invoked (either preloaded via agent metadata or called via the Skill tool) before Write or Edit operations on files matching the rule's path pattern.\n\n### Format\n\nThe \"Required Skills:\" heading must follow this format:\n\n```markdown\n## Required Skills: skill1, skill2, skill3\n```\n\nOr, if no skills are required:\n\n```markdown\n## Required Skills: None\n```\n\n### Examples\n\n**Single skill:**\n```markdown\n## Required Skills: claude-plugins\n```\n\n**Multiple skills:**\n```markdown\n## Required Skills: claude-plugins, turborepo-vercel\n```\n\n**No skills required:**\n```markdown\n## Required Skills: None\n```\n\n## Implementation\n\nThe `validate-rules-file.ts` PreToolUse hook (from project-context plugin) validates:\n1. All rules files have a \"Required Skills:\" heading\n2. The heading format is correct (prefix with colon, comma-separated list or \"None\")\n3. Rule files have the required frontmatter structure\n\n## Frontmatter Requirements\n\nAll rule files MUST include frontmatter with:\n- `markdown` field defining heading validation rules\n\nExample:\n```yaml\n---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\"]\n    required: [\"## Overview\", \"## Implementation\", \"## Required Skills:*\"]\n---\n```\n\n## Notes\n\n- This meta-rule validates the structure of other rule files\n- The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)\n- Skills listed must match skill names in `.claude/skills/`\n- The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files\n","structuredPatch":[{"oldStart":73,"oldLines":5,"newStart":73,"newLines":5,"lines":[" "," - This meta-rule validates the structure of other rule files"," - The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)","-- Skills listed must match skill names in `.claude/skills/`","+- Skills listed should reference valid skill names from installed plugins"," - The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:16.636Z","event":"typecheck-file","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:16.762Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","old_string":"- Skills listed must match skill names in `.claude/skills/`","new_string":"- Skills listed should reference valid skill names from installed plugins"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","oldString":"- Skills listed must match skill names in `.claude/skills/`","newString":"- Skills listed should reference valid skill names from installed plugins","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\"## Required Skills:*\"]\n  frontmatter:\n    allowed: [\"*\"]\n    required: [\"markdown\"]\n---\n\n# Rules Markdown Structure\n\nThis meta-rule defines the required structure for all rule files in `.claude/rules/`.\n\n## Required Skills: None\n\nAll rule files MUST include a \"Required Skills:\" heading that specifies which skills must be invoked (either preloaded via agent metadata or called via the Skill tool) before Write or Edit operations on files matching the rule's path pattern.\n\n### Format\n\nThe \"Required Skills:\" heading must follow this format:\n\n```markdown\n## Required Skills: skill1, skill2, skill3\n```\n\nOr, if no skills are required:\n\n```markdown\n## Required Skills: None\n```\n\n### Examples\n\n**Single skill:**\n```markdown\n## Required Skills: claude-plugins\n```\n\n**Multiple skills:**\n```markdown\n## Required Skills: claude-plugins, turborepo-vercel\n```\n\n**No skills required:**\n```markdown\n## Required Skills: None\n```\n\n## Implementation\n\nThe `validate-rules-file.ts` PreToolUse hook (from project-context plugin) validates:\n1. All rules files have a \"Required Skills:\" heading\n2. The heading format is correct (prefix with colon, comma-separated list or \"None\")\n3. Rule files have the required frontmatter structure\n\n## Frontmatter Requirements\n\nAll rule files MUST include frontmatter with:\n- `markdown` field defining heading validation rules\n\nExample:\n```yaml\n---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\"]\n    required: [\"## Overview\", \"## Implementation\", \"## Required Skills:*\"]\n---\n```\n\n## Notes\n\n- This meta-rule validates the structure of other rule files\n- The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)\n- Skills listed must match skill names in `.claude/skills/`\n- The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files\n","structuredPatch":[{"oldStart":73,"oldLines":5,"newStart":73,"newLines":5,"lines":[" "," - This meta-rule validates the structure of other rule files"," - The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)","-- Skills listed must match skill names in `.claude/skills/`","+- Skills listed should reference valid skill names from installed plugins"," - The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:16.770Z","event":"lint-file","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:16.914Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","old_string":"- Skills listed must match skill names in `.claude/skills/`","new_string":"- Skills listed should reference valid skill names from installed plugins"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","oldString":"- Skills listed must match skill names in `.claude/skills/`","newString":"- Skills listed should reference valid skill names from installed plugins","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\"## Required Skills:*\"]\n  frontmatter:\n    allowed: [\"*\"]\n    required: [\"markdown\"]\n---\n\n# Rules Markdown Structure\n\nThis meta-rule defines the required structure for all rule files in `.claude/rules/`.\n\n## Required Skills: None\n\nAll rule files MUST include a \"Required Skills:\" heading that specifies which skills must be invoked (either preloaded via agent metadata or called via the Skill tool) before Write or Edit operations on files matching the rule's path pattern.\n\n### Format\n\nThe \"Required Skills:\" heading must follow this format:\n\n```markdown\n## Required Skills: skill1, skill2, skill3\n```\n\nOr, if no skills are required:\n\n```markdown\n## Required Skills: None\n```\n\n### Examples\n\n**Single skill:**\n```markdown\n## Required Skills: claude-plugins\n```\n\n**Multiple skills:**\n```markdown\n## Required Skills: claude-plugins, turborepo-vercel\n```\n\n**No skills required:**\n```markdown\n## Required Skills: None\n```\n\n## Implementation\n\nThe `validate-rules-file.ts` PreToolUse hook (from project-context plugin) validates:\n1. All rules files have a \"Required Skills:\" heading\n2. The heading format is correct (prefix with colon, comma-separated list or \"None\")\n3. Rule files have the required frontmatter structure\n\n## Frontmatter Requirements\n\nAll rule files MUST include frontmatter with:\n- `markdown` field defining heading validation rules\n\nExample:\n```yaml\n---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\"]\n    required: [\"## Overview\", \"## Implementation\", \"## Required Skills:*\"]\n---\n```\n\n## Notes\n\n- This meta-rule validates the structure of other rule files\n- The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)\n- Skills listed must match skill names in `.claude/skills/`\n- The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files\n","structuredPatch":[{"oldStart":73,"oldLines":5,"newStart":73,"newLines":5,"lines":[" "," - This meta-rule validates the structure of other rule files"," - The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)","-- Skills listed must match skill names in `.claude/skills/`","+- Skills listed should reference valid skill names from installed plugins"," - The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:16.998Z","event":"create-plan-symlink","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:17.000Z","event":"create-plan-symlink","type":"output","data":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","absolutePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md"}}
{"timestamp":"2026-01-01T03:56:17.005Z","event":"create-plan-symlink","type":"output","data":{"action":"skip","reason":"Not a plan file"}}
{"timestamp":"2026-01-01T03:56:17.007Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse"}}}
{"timestamp":"2026-01-01T03:56:17.220Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","old_string":"- Skills listed must match skill names in `.claude/skills/`","new_string":"- Skills listed should reference valid skill names from installed plugins"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/rule-file.md","oldString":"- Skills listed must match skill names in `.claude/skills/`","newString":"- Skills listed should reference valid skill names from installed plugins","originalFile":"---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\", \"####*\"]\n    required: [\"## Required Skills:*\"]\n  frontmatter:\n    allowed: [\"*\"]\n    required: [\"markdown\"]\n---\n\n# Rules Markdown Structure\n\nThis meta-rule defines the required structure for all rule files in `.claude/rules/`.\n\n## Required Skills: None\n\nAll rule files MUST include a \"Required Skills:\" heading that specifies which skills must be invoked (either preloaded via agent metadata or called via the Skill tool) before Write or Edit operations on files matching the rule's path pattern.\n\n### Format\n\nThe \"Required Skills:\" heading must follow this format:\n\n```markdown\n## Required Skills: skill1, skill2, skill3\n```\n\nOr, if no skills are required:\n\n```markdown\n## Required Skills: None\n```\n\n### Examples\n\n**Single skill:**\n```markdown\n## Required Skills: claude-plugins\n```\n\n**Multiple skills:**\n```markdown\n## Required Skills: claude-plugins, turborepo-vercel\n```\n\n**No skills required:**\n```markdown\n## Required Skills: None\n```\n\n## Implementation\n\nThe `validate-rules-file.ts` PreToolUse hook (from project-context plugin) validates:\n1. All rules files have a \"Required Skills:\" heading\n2. The heading format is correct (prefix with colon, comma-separated list or \"None\")\n3. Rule files have the required frontmatter structure\n\n## Frontmatter Requirements\n\nAll rule files MUST include frontmatter with:\n- `markdown` field defining heading validation rules\n\nExample:\n```yaml\n---\nmarkdown:\n  headings:\n    allowed: [\"#*\", \"##*\", \"###*\"]\n    required: [\"## Overview\", \"## Implementation\", \"## Required Skills:*\"]\n---\n```\n\n## Notes\n\n- This meta-rule validates the structure of other rule files\n- The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)\n- Skills listed must match skill names in `.claude/skills/`\n- The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files\n","structuredPatch":[{"oldStart":73,"oldLines":5,"newStart":73,"newLines":5,"lines":[" "," - This meta-rule validates the structure of other rule files"," - The \"Required Skills:\" heading can have any suffix after the colon (validated by pattern `## Required Skills:*`)","-- Skills listed must match skill names in `.claude/skills/`","+- Skills listed should reference valid skill names from installed plugins"," - The project-context plugin enforces this structure on all Write/Edit operations to `.claude/rules/*.md` files"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_01MpDForbNyhFCvFnx1hAqS6"}}
{"timestamp":"2026-01-01T03:56:17.240Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:56:17.784Z","event":"lint-file","type":"output","data":{"success":false,"lint_errors":"$ eslint plugins/ shared/\n/usr/bin/bash: line 1: eslint: command not found\nerror: script \"lint\" exited with code 127\n"}}
{"timestamp":"2026-01-01T03:56:17.791Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse","additionalContext":"ESLint found errors:\n\n$ eslint plugins/ shared/\n/usr/bin/bash: line 1: eslint: command not found\nerror: script \"lint\" exited with code 127\n\n\nPlease fix these linting issues."}}}
{"timestamp":"2026-01-01T03:56:19.436Z","event":"typecheck-file","type":"output","data":{"success":false,"type_errors":"error TS2688: Cannot find type definition file for 'node'.\n  The file is in the program because:\n    Entry point of type library 'node' specified in compilerOptions\n"}}
{"timestamp":"2026-01-01T03:56:19.437Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse","additionalContext":"TypeScript type checking found errors:\n\nerror TS2688: Cannot find type definition file for 'node'.\n  The file is in the program because:\n    Entry point of type library 'node' specified in compilerOptions\n\n\nPlease fix these type errors."}}}
{"timestamp":"2026-01-01T03:56:27.125Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Read","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","offset":1030,"limit":20},"tool_response":{"type":"text","file":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","content":"- **Keep docs fresh** - Update links when major version changes occur\n\n## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment\n","numLines":13,"startLine":1030,"totalLines":1042}},"tool_use_id":"toolu_01M432FNSnf592vKaPByg557"}}
{"timestamp":"2026-01-01T03:56:27.127Z","event":"add-folder-context","type":"input","data":{"tool_name":"Read","tool_use_id":"toolu_01M432FNSnf592vKaPByg557"}}
{"timestamp":"2026-01-01T03:56:27.130Z","event":"add-folder-context","type":"output","data":{"success":true,"found":1,"files":["/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/shared/CLAUDE.md"]}}
{"timestamp":"2026-01-01T03:56:27.131Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse","additionalContext":"Related context:\n[/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/shared/CLAUDE.md](file:///home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/shared/CLAUDE.md)"}}}
{"timestamp":"2026-01-01T03:56:35.190Z","event":"PreToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PreToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","old_string":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","new_string":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration"},"tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:35.190Z","event":"validate-rules-file","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:35.191Z","event":"validate-rules-file","type":"output","data":{"message":"Not a rule file, skipping"}}
{"timestamp":"2026-01-01T03:56:35.191Z","event":"PreToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PreToolUse","permissionDecision":"allow"}}}
{"timestamp":"2026-01-01T03:56:35.218Z","event":"PreToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PreToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","old_string":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","new_string":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration"},"tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:35.221Z","event":"PreToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PreToolUse","permissionDecision":"allow"}}}
{"timestamp":"2026-01-01T03:56:37.451Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","old_string":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","new_string":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","oldString":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","newString":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration","originalFile":"---\ntitle: Claude Code Plugins Marketplace\ndescription: A marketplace of Claude Code plugins with shared TypeScript utilities and typed hooks for development workflows\nfolder:\n  subfolders:\n    allowed: [.claude, .claude-plugin, .github, docs, plugins, shared]\n    required: [.claude-plugin, plugins, shared]\n  files:\n    allowed: [CLAUDE.md, LICENSE, package.json, package-lock.json, tsconfig.json, vitest.config.ts, eslint.config.mjs, .gitignore, .attw.json, README.md]\n    required: [CLAUDE.md, package.json]\n---\n\n# Claude Code Plugins\n\n## What This Is\n\nA marketplace of Claude Code plugins with shared TypeScript utilities. This is NOT an npm package - it's a collection of plugins that extend Claude Code with typed hooks for development workflows.\n\n## Architecture\n\n```\n.\nâ”œâ”€â”€ .claude-plugin/\nâ”‚   â””â”€â”€ marketplace.json        # Marketplace definition\nâ”‚\nâ”œâ”€â”€ shared/                     # Shared utilities imported by all plugins\nâ”‚   â”œâ”€â”€ types/\nâ”‚   â”‚   â””â”€â”€ types.ts           # Hook type definitions\nâ”‚   â”œâ”€â”€ hooks/\nâ”‚   â”‚   â”œâ”€â”€ utils/             # Hook utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ io.ts          # stdin/stdout + runHook wrapper\nâ”‚   â”‚   â”‚   â”œâ”€â”€ debug.ts       # Debug logging\nâ”‚   â”‚   â”‚   â”œâ”€â”€ transcripts.ts # Transcript parsing\nâ”‚   â”‚   â”‚   â”œâ”€â”€ subagent-state.ts # Subagent context management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ task-state.ts  # Task state management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ package-manager.ts # Package manager detection\nâ”‚   â”‚   â”‚   â”œâ”€â”€ toml.ts        # TOML parser\nâ”‚   â”‚   â”‚   â”œâ”€â”€ was-tool-event-main-agent.ts # Agent detection\nâ”‚   â”‚   â”‚   â””â”€â”€ index.ts       # Exports all utilities\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-start.ts  # SubagentStart hook\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-stop.ts   # SubagentStop hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-call.ts       # PreToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-result.ts     # PostToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ enforce-structured-markdown.ts  # PreToolUse hook for markdown validation\nâ”‚   â”‚   â”œâ”€â”€ enforce-output-style-tools.ts   # PreToolUse hook for tool enforcement\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-write.ts  # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-mkdir.ts  # PreToolUse[Bash] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-rules-file.ts          # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â””â”€â”€ run-rule-checks.ts              # PostToolUse hook for rule checks\nâ”‚   â””â”€â”€ rules/                  # Claude rules documentation (*.md files)\nâ”‚       â””â”€â”€ CLAUDE.md          # Rules folder documentation\nâ”‚\nâ””â”€â”€ plugins/                    # Individual marketplace plugins\n    â”œâ”€â”€ github-context/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-github.ts           # SessionStart: install GitHub CLI\n    â”‚       â”œâ”€â”€ add-github-context.ts       # SessionStart: branch context & issues\n    â”‚       â”œâ”€â”€ sync-plan-to-issue.ts       # PostToolUse[Write|Edit]: plan sync\n    â”‚       â”œâ”€â”€ enhance-commit-context.ts   # PostToolUse[Bash]: commit enhancement\n    â”‚       â”œâ”€â”€ commit-task.ts              # SubagentStop: auto-commit agent work\n    â”‚       â””â”€â”€ commit-session-check-pr-status.ts  # Stop: session commit & PR checks\n    â”‚\n    â”œâ”€â”€ nextjs-supabase-ai-sdk-dev/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-vercel.ts           # SessionStart: install Vercel CLI\n    â”‚       â”œâ”€â”€ install-supabase.ts         # SessionStart: install Supabase CLI\n    â”‚       â”œâ”€â”€ check-file-eslint.ts        # PostToolUse[Write|Edit]: ESLint on file\n    â”‚       â”œâ”€â”€ check-file-types.ts         # PostToolUse[Write|Edit]: TypeScript on file\n    â”‚       â”œâ”€â”€ check-file-tsdoc.ts         # PostToolUse[Write|Edit]: TSDoc validation\n    â”‚       â”œâ”€â”€ check-file-vitest-results.ts # PostToolUse[Write|Edit]: Vitest on test files\n    â”‚       â”œâ”€â”€ encourage-ui-review.ts      # PostToolUse[Task]: encourage ui-reviewer\n    â”‚       â”œâ”€â”€ check-global-eslint.ts      # Stop: ESLint on all (blocking)\n    â”‚       â”œâ”€â”€ check-global-types.ts       # Stop: TypeScript on all (blocking)\n    â”‚       â””â”€â”€ check-global-vitest-results.ts # Stop: Vitest on all (blocking)\n    â”‚\n    â””â”€â”€ project-context/\n        â”œâ”€â”€ .claude-plugin/plugin.json\n        â””â”€â”€ hooks/\n            â”œâ”€â”€ hooks.json\n            â”œâ”€â”€ encourage-context-review.ts  # UserPromptSubmit: context updates\n            â”œâ”€â”€ add-folder-context.ts        # PostToolUse[Read]: CLAUDE.md discovery\n            â”œâ”€â”€ create-plan-symlink.ts       # PostToolUse[Write|Edit]: PLAN.md symlink\n            â”œâ”€â”€ try-markdown-page.ts         # PreToolUse[WebFetch]: prefer .md URLs\n            â””â”€â”€ shared/                      # Uses shared validation hooks\n                â”œâ”€â”€ log-task-call.ts         # PreToolUse[Task]: save task context\n                â”œâ”€â”€ log-task-result.ts       # PostToolUse[Task]: log task results\n                â”œâ”€â”€ validate-folder-structure-write.ts   # PreToolUse[Write|Edit]\n                â”œâ”€â”€ validate-folder-structure-mkdir.ts   # PreToolUse[Bash]\n                â”œâ”€â”€ validate-rules-file.ts               # PreToolUse[Write|Edit]\n                â””â”€â”€ enforce-plan-scoping.ts              # PostToolUse[Write|Edit|Read]\n```\n\n## Self-Executable Hooks with tsx\n\nAll hooks are self-executable TypeScript files that can be run directly with `npx tsx`. Each hook:\n1. Imports the `runHook` wrapper from `shared/hooks/utils/io.ts`\n2. Defines a `handler` function with typed input/output\n3. Calls `runHook(handler)` at the end of the file\n\n### Hook Pattern\n\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Hook implementation\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export handler for testing\nexport { handler };\n\n// Make this file self-executable with tsx\nrunHook(handler);\n```\n\n### hooks.json Configuration\n\n**IMPORTANT**: The official Claude Code repository and its plugins should serve as the canonical example:\n- Repository: https://github.com/anthropics/claude-code\n- Marketplace: https://raw.githubusercontent.com/anthropics/claude-code/main/.claude-plugin/marketplace.json\n- Example plugins: https://github.com/anthropics/claude-code/tree/main/plugins\n\nHooks must be wrapped in a `\"hooks\"` object:\n\n```json\n{\n  \"description\": \"My plugin description\",\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nVariables provided by Claude Code:\n- `${CLAUDE_PROJECT_DIR}` - Root of the Claude Code project\n- `${CLAUDE_PLUGIN_ROOT}` - Root of the specific plugin being executed\n\n## Shared Folder (`shared/`)\n\n### Types (`shared/types/types.ts`)\n\nFull TypeScript typing for all Claude Code hook events:\n\n```typescript\nimport type {\n  SessionStartInput,\n  SessionStartHookOutput,\n  PostToolUseInput,\n  PostToolUseHookOutput,\n  // ... all hook types\n} from '../../../shared/types/types.js';\n```\n\n### Hook Utilities (`shared/hooks/utils/`)\n\n- **io.ts** - stdin/stdout JSON handling and `runHook` wrapper\n- **debug.ts** - Debug logging with JSONL output to `.claude/logs/hook-events.json`\n- **transcripts.ts** - Parse Claude transcript JSONL files\n- **subagent-state.ts** - Save/load/analyze subagent context and edits\n- **task-state.ts** - Task state management for PreToolUse[Task] â†’ SubagentStop flow\n- **package-manager.ts** - Detect npm/yarn/pnpm/bun from lockfiles\n- **toml.ts** - Simple TOML parser for config files\n- **was-tool-event-main-agent.ts** - Detect if tool event is from main agent or subagent\n- **index.ts** - Re-exports all utilities\n\n### Shared Hooks (`shared/hooks/`)\n\n**Logging and State Management:**\n- **log-subagent-start.ts** - SubagentStart hook that saves agent context\n- **log-subagent-stop.ts** - SubagentStop hook that logs agent file operations\n- **log-task-call.ts** - PreToolUse[Task] hook that saves task call metadata\n- **log-task-result.ts** - PostToolUse[Task] hook that logs task results\n\n**Validation and Enforcement:**\n- **enforce-structured-markdown.ts** - PreToolUse[Write|Edit] hook for comprehensive markdown validation (agents, skills, rules, CLAUDE.md)\n- **enforce-output-style-tools.ts** - PreToolUse hook for output style tool enforcement\n- **validate-folder-structure-write.ts** - PreToolUse[Write|Edit] hook for .claude directory structure validation\n- **validate-folder-structure-mkdir.ts** - PreToolUse[Bash] hook for mkdir command validation\n- **validate-rules-file.ts** - PreToolUse[Write|Edit] hook for rule file structure validation\n\n**Custom Checks:**\n- **run-rule-checks.ts** - PostToolUse[Write|Edit] hook for running custom checks from rule frontmatter\n\n## Available Plugins\n\n### github-context\n\nGitHub integration with branch context, commit enhancement, plan synchronization, and CI orchestration.\n\n**Purpose:**\nProvides comprehensive GitHub integration including CLI installation, branch/issue context discovery, automatic commit enhancement with task metadata, plan-to-issue synchronization, and PR status monitoring.\n\n**Hooks:**\n- **SessionStart** (`install-github.ts`) - Installs GitHub CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`add-github-context.ts`) - Displays linked GitHub issue for current branch, branch sync status, and outstanding issues (non-blocking)\n- **PostToolUse[Write|Edit]** (`sync-plan-to-issue.ts`) - Automatically creates or updates GitHub issues from plan files (non-blocking)\n- **PostToolUse[Bash]** (`enhance-commit-context.ts`) - Enhances git commits with task context and issue references for both main agent and subagents (non-blocking)\n- **SubagentStop** (`commit-task.ts`) - Auto-commits subagent work with task context and git trailers (non-blocking)\n- **Stop** (`commit-session-check-pr-status.ts`) - Auto-commits session changes, checks PR status, and reports CI/preview URLs with progressive blocking\n\n**Key Features:**\n- **Branch Context Discovery:** Shows full GitHub issue content (title, body, comments) linked to current branch\n- **Sync Status:** Displays branch status relative to remote tracking branch and origin/main\n- **Outstanding Issues:** Lists open issues not linked to any branch, available for work\n- **Auto-commit:** Automatically commits subagent work with rich task context\n- **Plan Synchronization:** Creates/updates GitHub issues from plan files automatically\n- **Commit Enhancement:** Enriches commits with task and issue metadata\n- **PR Status Monitoring:** Checks PR status at session end with CI and preview URL reporting\n\n**Use Cases:**\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n- Multi-agent workflows with automatic commit documentation\n\n### nextjs-supabase-ai-sdk-dev\n\nDevelopment quality enforcement for Next.js, Supabase, and AI SDK projects with comprehensive linting, type checking, testing, and CLI installation.\n\n**Purpose:**\nEnsures code quality through automated checks at both file and project levels. Installs Vercel and Supabase CLIs on remote environments, runs per-file quality checks on edits, and performs comprehensive project-wide validation at session end.\n\n**Hooks:**\n- **SessionStart** (`install-vercel.ts`) - Installs Vercel CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`install-supabase.ts`) - Installs Supabase CLI on remote environments, warns if missing locally (non-blocking)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls and saves context for SubagentStop hooks (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after agent completion (non-blocking)\n- **PostToolUse[Task]** (`encourage-ui-review.ts`) - Encourages ui-reviewer agent after ui-developer completes (non-blocking)\n- **PostToolUse[Write|Edit]** (`check-file-eslint.ts`) - Runs ESLint on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-types.ts`) - Runs TypeScript type checking on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-tsdoc.ts`) - Validates TSDoc documentation on TypeScript files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit test files]** (`check-file-vitest-results.ts`) - Runs Vitest on test files after edits (non-blocking, informational)\n- **Stop** (`check-global-eslint.ts`) - Runs ESLint on entire project at session end (blocking)\n- **Stop** (`check-global-types.ts`) - Runs TypeScript type checking on entire project at session end (blocking)\n- **Stop** (`check-global-vitest-results.ts`) - Runs full Vitest test suite at session end (blocking)\n\n**Key Features:**\n- **CLI Installation:** Automatic installation of Vercel and Supabase CLIs on remote environments\n- **Per-File Checks:** Immediate feedback on ESLint, TypeScript, and TSDoc issues after each file edit\n- **Test Execution:** Automatic test running when test files are modified\n- **Project-Wide Validation:** Comprehensive checks at session end ensure no issues slip through\n- **Blocking Stop Hooks:** Prevents ending session with linting errors, type errors, or failing tests\n- **Task Tracking:** Logs all Task tool calls for context in SubagentStop hooks\n- **UI Review Encouragement:** Prompts for visual review after UI development work\n\n**Use Cases:**\n- Next.js application development\n- TypeScript projects requiring strict type safety\n- Projects with comprehensive test suites\n- Teams enforcing code quality standards\n- CI/CD workflows requiring pre-push validation\n\n### project-context\n\nEnhanced context discovery, folder structure validation, and project guidance for Claude Code workflows.\n\n**Purpose:**\nAutomatically discovers and links CLAUDE.md documentation, validates project structure for .claude directories, enforces plan scoping, and encourages context updates based on user prompts. Provides intelligent URL redirection to prefer markdown documentation.\n\n**Hooks:**\n- **UserPromptSubmit** (`encourage-context-review.ts`) - Encourages updating plans, agents, skills, and CLAUDE.md files based on user prompts (non-blocking, informational)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls before execution and saves context (non-blocking)\n- **PreToolUse[Write|Edit]** (shared `validate-folder-structure-write.ts`) - Validates folder structure when creating .claude files (blocking on structure violations)\n- **PreToolUse[Write|Edit]** (shared `validate-rules-file.ts`) - Validates rule file structure and Required Skills frontmatter (blocking on validation errors)\n- **PreToolUse[Bash]** (shared `validate-folder-structure-mkdir.ts`) - Validates mkdir commands for .claude directories (blocking on invalid paths)\n- **PreToolUse[WebFetch]** (`try-markdown-page.ts`) - Redirects WebFetch to markdown versions of documentation when available (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after completion (non-blocking)\n- **PostToolUse[Write|Edit]** (`create-plan-symlink.ts`) - Creates PLAN.md symlink when plan files are written (non-blocking)\n- **PostToolUse[Write|Edit]** (shared `enforce-plan-scoping.ts`) - Enforces plan-based path scoping for write/edit operations (can block on scope violations)\n- **PostToolUse[Read]** (`add-folder-context.ts`) - Discovers and adds CLAUDE.md context when reading files (non-blocking)\n- **PostToolUse[Read]** (shared `enforce-plan-scoping.ts`) - Warns when reads are outside plan scope (non-blocking, guidance only)\n\n**Key Features:**\n- **Automatic Context Discovery:** Finds and links CLAUDE.md files when reading project files\n- **Folder Structure Validation:** Ensures .claude directories follow proper organization standards\n- **Plan Scoping:** Enforces staying within plan boundaries for file operations\n- **Rules Validation:** Ensures rule files have proper structure and Required Skills metadata\n- **Context Encouragement:** Prompts to update documentation based on user activity\n- **Markdown Preference:** Automatically redirects to .md versions of documentation URLs\n- **Plan Symlinks:** Maintains PLAN.md link to active plan file\n- **Task Tracking:** Comprehensive logging of agent invocations and results\n\n**Use Cases:**\n- Large codebases requiring organized documentation\n- Projects with .claude directory structures (agents, skills, rules, hooks)\n- Plan-driven development workflows\n- Documentation-heavy projects\n- Teams enforcing project structure standards\n- Research-oriented development (prefers markdown docs)\n\n## Vercel Preview Configuration\n\nThis project is configured to deploy all Turborepo apps on every commit and PR:\n\n- **Web App** (`apps/web`) - Main application\n- **Admin App** (`apps/admin`) - Administration dashboard\n- **Docs App** (`apps/docs`) - Documentation site\n\n**Preview URL Detection:**\n- Vercel bot posts preview URLs as PR comments\n- UI review workflow polls for these URLs (10 minute timeout)\n- Each app gets its own preview URL: `https://[app-name]-[hash].vercel.app`\n\n**E2E Testing:**\n- Playwright tests run against preview URLs in CI\n- Tests are isolated to `@app` and `@web` tags only\n- Screenshots captured during test execution at key moments\n- Claude API reviews screenshots per app and per test\n\n## Worktree Operation Restrictions\n\n**IMPORTANT**: When working in git worktrees, follow these best practices:\n\n### Recommended Settings (Local Development)\n\nAdd to your local `.claude/settings.json` (NOT committed to repo):\n\n```json\n{\n  \"workingDirectoryRestrictions\": {\n    \"enabled\": true,\n    \"allowedPaths\": [\n      \"/home/user/projects/my-repo/.worktrees/claude-*\"\n    ]\n  }\n}\n```\n\n### Why Worktree Safety Matters\n\n- **Isolation**: Each worktree is an independent branch checkout\n- **Context**: Main repo and worktree can have different files\n- **Safety**: Operations outside worktree can affect main repo or other worktrees\n- **Best Practice**: Review all file operations to ensure they target the worktree\n\n### Worktree Context\n\nThe `github-context-sync` plugin automatically:\n- Shows linked GitHub issue for current branch (full content with comments)\n- Displays branch sync status (remote tracking branch and origin/main)\n- Lists outstanding unlinked issues available for work\n- Encourages UI review after ui-developer agent completes\n\n### Manual Verification\n\nAlways verify you're in the correct worktree:\n\n```bash\npwd                    # Check current directory\ngit rev-parse --show-toplevel  # Show worktree root\ngit branch --show-current      # Show current branch\n```\n\n### Automatic Plugin Cache Management\n\nThe `claude-worktree.sh` script automatically manages plugin cache to ensure every worktree uses current plugin code:\n\n1. **Detects enabled plugins** from `.claude/settings.json`\n2. **Cleans up invalid installations** - Removes cached plugins whose source no longer exists\n3. **Refreshes plugin cache** - Uninstalls and reinstalls all plugins from worktree source\n4. **Ensures fresh hooks** - Every worktree session uses current plugin code\n\n**Why this matters:**\n- Plugins are cached globally at `~/.claude/plugins/cache/`\n- Cache is not automatically invalidated when source changes\n- Old cached hooks can cause unexpected behavior (missing new hooks, running removed hooks)\n- Automatic refresh ensures worktree uses fresh plugin code\n\n**Dependencies:**\n- Requires `jq` for parsing JSON: `brew install jq` (macOS) or `apt install jq` (Linux)\n- Without `jq`, manual plugin reinstallation required\n\n**Manual cache refresh:**\n```bash\n# List plugins\nclaude plugin list\n\n# Uninstall and reinstall\nclaude plugin uninstall --scope project plugin-name@constellos\nclaude plugin install --scope project plugin-name@constellos\n```\n\n## UI Development Workflow\n\nThis project includes a comprehensive UI development system with progressive skills and automated review:\n\n### UI Development Skills (Progressive)\n\n1. **ui-wireframing** - Mobile-first ASCII wireframes in `WIREFRAME.md` files\n2. **ui-design** - Contract-first static UI with compound components\n3. **ui-interaction** - Client-side events, local state, validation\n4. **ui-integration** - Server actions, Supabase queries, backend integration\n5. **ai-sdk-ui** - AI-powered features with Vercel AI SDK\n\n### UI Developer Agent\n\nThe `ui-developer` agent (in `nextjs-supabase-ai-sdk-dev` plugin) provides:\n- All 5 UI skills preloaded\n- MCP integration (ai-elements, shadcn, next-devtools)\n- Systematic workflow: wireframe â†’ design â†’ interaction â†’ integration â†’ AI\n- Mobile-first, contract-first, Server Component defaults\n\n**Local Development:**\n- Uses next-devtools MCP for live preview and debugging\n- No Playwright installation needed locally\n- Real-time UI feedback during development\n\n### UI Review System\n\n**Manual Review:**\n- Invoke `ui-reviewer` agent with screenshot paths\n- Provides systematic quality review\n- Identifies critical, major, and minor issues\n\n**Automated CI Review:**\n- GitHub Actions workflow (`ui-review.yml`) runs on commits/PRs\n- Playwright e2e tests for `@app` and `@web` tags\n- Screenshots captured during test execution\n- Claude API reviews each test's screenshots with vision\n- Per-test reviews aggregated into final report\n- Blocks merge if critical issues found\n\n**Review Criteria:**\n- Visual consistency across breakpoints\n- Responsive behavior (mobile, tablet, desktop)\n- Accessibility (color contrast, semantic HTML)\n- Component composition patterns\n- User experience quality\n\n### Technology Stack\n\n- **UI Components**: Shadcn (default), AI Elements, Radix, HTML\n- **Styling**: Tailwind CSS with mobile-first approach\n- **State Management**: Server Components (default), client components when needed\n- **Validation**: Zod schemas (client + server)\n- **Backend**: Supabase with defense-in-depth (RLS + explicit auth checks)\n- **AI Integration**: Vercel AI SDK with streaming UI\n\n## Creating New Plugins\n\n1. Create plugin directory:\n   ```bash\n   mkdir -p plugins/my-plugin/.claude-plugin\n   mkdir -p plugins/my-plugin/hooks\n   ```\n\n2. Create `plugin.json`:\n   ```json\n   {\n     \"name\": \"my-plugin\",\n     \"version\": \"0.1.0\",\n     \"description\": \"My custom plugin\",\n     \"author\": { \"name\": \"your-name\" }\n   }\n   ```\n\n3. Create `hooks/hooks.json`:\n   ```json\n   {\n     \"description\": \"My plugin hooks\",\n     \"hooks\": {\n       \"SessionStart\": [\n         {\n           \"hooks\": [\n             {\n               \"type\": \"command\",\n               \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n             }\n           ]\n         }\n       ]\n     }\n   }\n   ```\n\n4. Create hook file `hooks/my-hook.ts` with proper TSDoc:\n   ```typescript\n   /**\n    * Brief description of what this hook does\n    *\n    * Detailed explanation of the hook's purpose, when it triggers,\n    * and what it accomplishes.\n    *\n    * @module my-hook\n    */\n\n   import type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\n   import { runHook } from '../../../shared/hooks/utils/io.js';\n\n   /**\n    * SessionStart hook handler\n    *\n    * Executes at session start to perform [specific action].\n    *\n    * @param input - SessionStart hook input from Claude Code\n    * @returns Hook output with additional context\n    *\n    * @example\n    * ```typescript\n    * // This hook is automatically called by Claude Code\n    * // when a new session starts\n    * ```\n    */\n   async function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n     return {\n       hookSpecificOutput: {\n         hookEventName: 'SessionStart',\n         additionalContext: 'My hook executed!',\n       },\n     };\n   }\n\n   export { handler };\n   runHook(handler);\n   ```\n\n5. Add to marketplace.json:\n   ```json\n   {\n     \"plugins\": [\n       {\n         \"name\": \"my-plugin\",\n         \"source\": \"./plugins/my-plugin\"\n       }\n     ]\n   }\n   ```\n\n6. Create `README.md` documenting your plugin:\n   ```markdown\n   # My Plugin\n\n   Brief description of what the plugin does.\n\n   ## Overview\n\n   Detailed explanation of the plugin's purpose and capabilities.\n\n   ## Hooks\n\n   ### SessionStart - Hook Name\n\n   **File:** `hooks/my-hook.ts`\n   **Event:** SessionStart\n   **What it does:** Detailed description of hook behavior\n   **Non-blocking:** Yes/No\n\n   ## Installation\n\n   \\```bash\n   claude plugin install my-plugin@constellos\n   \\```\n\n   ## Configuration\n\n   Description of any configuration options.\n\n   ## Debug Logging\n\n   \\```bash\n   DEBUG=my-hook claude\n   \\```\n   ```\n\n## Local Development\n\n### Using Plugins in This Repo\n\nConfiguration in `.claude/settings.json`:\n\n```json\n{\n  \"enabledPlugins\": {\n    \"github-vercel-supabase-ci@constellos\": true,\n    \"github-review-sync@constellos\": true,\n    \"nextjs-supabase-ai-sdk-dev@constellos\": true,\n    \"code-context@constellos\": true,\n    \"markdown-structure-rules@constellos\": true\n  }\n}\n```\n\nNote: The marketplace is automatically registered when you run `claude plugin marketplace add ./` from the project root.\n\n### Installing Plugins\n\nFirst, add the marketplace:\n```bash\nclaude plugin marketplace add ./\n```\n\nThen install the plugins:\n```bash\nclaude plugin install github-vercel-supabase-ci@constellos\nclaude plugin install github-review-sync@constellos\nclaude plugin install nextjs-supabase-ai-sdk-dev@constellos\nclaude plugin install code-context@constellos\nclaude plugin install markdown-structure-rules@constellos\n```\n\n### Testing Changes\n\n1. Edit plugin files in `plugins/` or shared utilities in `shared/`\n2. Exit Claude Code session\n3. Start new session\n4. Changes are automatically loaded\n\n## Testing\n\nRun tests and checks:\n\n```bash\nnpm run typecheck     # TypeScript type checking\nnpm run lint          # ESLint\nnpm run test          # Vitest\nnpm run test:watch    # Vitest watch mode\n```\n\nEnable debug logging for hooks:\n```bash\nDEBUG=* claude              # All debug output\nDEBUG=plugin-name claude    # Specific plugin\n```\n\n## Claude Code Documentation Notes\n\nThe official Claude Code documentation may be out of date or incomplete. When implementing hooks:\n\n- **Test actual behavior** rather than relying solely on docs\n- **Check GitHub issues** for known bugs (e.g., issue #10412 about Stop hooks via plugins)\n- **The `reason` field in Stop hooks is shown to Claude** (tells it what to fix)\n- **The `systemMessage` field is shown to the user** (status info, not visible to Claude)\n- **Use explicit `decision: \"approve\"`** when allowing stop (not just empty `{}`)\n- **Use explicit `decision: \"block\"` with actionable `reason`** when blocking\n\n### Stop Hook Output Best Practices\n\n```typescript\n// When blocking - provide actionable instructions to Claude\nreturn {\n  decision: 'block',\n  reason: 'ESLint errors detected. You MUST fix these before stopping:\\n\\n[errors here]\\n\\nFix each error, then run linter to verify.',\n  systemMessage: 'Claude is blocked from stopping due to ESLint errors.',\n};\n\n// When approving - be explicit\nreturn { decision: 'approve' };\n```\n\n## Troubleshooting\n\n### Hooks Not Firing\n\nIf hooks aren't executing:\n\n1. **Check plugin cache**: Plugins are cached in `~/.claude/plugins/cache/`. Verify the cached `hooks.json` has the correct format with the `\"hooks\"` wrapper.\n\n2. **Verify hooks.json format**: Use the claude-code-guide agent to confirm the correct format:\n   ```bash\n   # In Claude Code session\n   /help hooks.json format\n   ```\n\n   Or research with the claude-code-guide agent:\n   - What is the correct format for hooks.json?\n   - Should hooks be wrapped in a \"hooks\" object?\n\n3. **Reinstall plugins**: If you changed the hooks.json format, reinstall to refresh cache:\n   ```bash\n   claude plugin uninstall --scope project my-plugin@constellos\n   claude plugin install --scope project my-plugin@constellos\n   ```\n\n4. **Restart Claude Code**: Hooks only load when Claude Code starts. After any plugin changes:\n   - Exit current session\n   - Start new session\n   - Verify hooks fire by checking `.claude/logs/hook-events.json`\n\n5. **Validate plugins**: Check for configuration issues:\n   ```bash\n   claude plugin validate plugins/my-plugin\n   claude plugin marketplace list\n   ```\n\n6. **Check marketplace configuration**: In `.claude/settings.json`:\n   ```json\n   {\n     \"extraKnownMarketplaces\": {\n       \"constellos\": {\n         \"source\": {\n           \"source\": \"directory\",\n           \"path\": \"./.claude-plugin\"\n         }\n       }\n     },\n     \"enabledPlugins\": {\n       \"my-plugin@constellos\": true\n     }\n   }\n   ```\n\n7. **Use claude-code-guide for research**: When troubleshooting, always use the claude-code-guide agent for accurate documentation:\n   - Hook event types and lifecycle\n   - Plugin installation and configuration\n   - Debugging techniques\n\n### Plugin Cache Out of Sync\n\n**Symptom:** Hooks behaving differently than expected (old hooks firing, new hooks missing, removed hooks still running)\n\n**Cause:** Plugin cache at `~/.claude/plugins/cache/` contains old versions from before recent changes\n\n**Solution:**\n\n1. **Automatic (recommended):** Use `claude-worktree.sh` which auto-refreshes plugins on every new worktree\n   ```bash\n   bash claude-worktree.sh\n   ```\n\n2. **Manual:** Reinstall plugins to refresh cache:\n   ```bash\n   # Uninstall all constellos plugins\n   claude plugin uninstall --scope project github-context@constellos\n   claude plugin uninstall --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin uninstall --scope project project-context@constellos\n\n   # Reinstall from current source\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n3. **Nuclear option:** Delete entire cache and reinstall:\n   ```bash\n   rm -rf ~/.claude/plugins/cache/constellos\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n**Verification:**\n```bash\n# Check if await-pr-checks hook exists (added in PR #71)\nls ~/.claude/plugins/cache/constellos/github-context/hooks/await-pr-checks.ts\n\n# Verify NO Stop hooks in nextjs-supabase-ai-sdk-dev (removed in PR #71)\ncat ~/.claude/plugins/cache/constellos/nextjs-supabase-ai-sdk-dev/hooks/hooks.json | grep -i \"stop\"\n\n# Compare cached vs source to see differences\ndiff ~/.claude/plugins/cache/constellos/github-context/hooks/hooks.json \\\n     ./plugins/github-context/hooks/hooks.json\n```\n\n### When to Restart Sessions vs Reinstall Plugins\n\nUnderstanding when changes require a session restart vs plugin reinstall helps maintain an efficient development workflow.\n\n**Requires NEW session** (exit and restart Claude Code):\n- Changes to `.claude/settings.json`:\n  - Modifying `enabledPlugins`\n  - Adding/removing `extraKnownMarketplaces`\n  - Changing marketplace paths or configuration\n- Adding new plugins to marketplace\n- Removing plugins from marketplace\n- Changes to `.claude-plugin/marketplace.json`\n\n**Requires plugin REINSTALL** (no session restart needed):\n- Changes to `hooks/hooks.json` (hook configuration)\n- Changes to `.claude-plugin/plugin.json` (plugin metadata)\n- Changes to hook implementation files (`.ts` files)\n- Changes to shared utilities in `shared/` folder\n- Bug fixes or improvements to existing hooks\n\n**Reinstall command:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**Or use the quick reinstall pattern:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos 2>/dev/null || true && \\\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**No restart or reinstall needed:**\n- Documentation changes (README.md, CLAUDE.md)\n- Comment updates in code\n- Test file changes\n- Non-hook TypeScript files\n\n**Why this matters:**\n- Plugin files are copied to `~/.claude/plugins/cache/` during installation\n- Claude Code loads plugin configuration only at session start\n- Reinstalling updates the cache without requiring a full session restart\n- This allows rapid iteration during plugin development\n\n**Development workflow:**\n1. Make changes to hook implementation\n2. Reinstall the plugin to update cache\n3. Test the changes in current session\n4. Repeat until working correctly\n\n**Only restart session when:**\n- You've made changes to `.claude/settings.json`\n- You've added/removed plugins from the marketplace\n- Reinstalling doesn't seem to apply your changes\n\n## Key Architecture Decisions\n\n### Self-Executable Hooks\n\nEach hook is a standalone TypeScript file that:\n- Uses the `runHook` wrapper for stdin/stdout handling\n- Can be executed directly with `npx tsx`\n- Exports a named `handler` function for testing\n- No separate runner script needed\n\n### Shared Utilities Pattern\n\nAll plugins import from `shared/` rather than duplicating code:\n- Consistent typing across all hooks\n- Shared I/O, debug, and transcript utilities\n- Easy updates to all plugins\n\n### Type Safety\n\nFull TypeScript typing for all hook events in `shared/types/types.ts`:\n- Input types for each hook event\n- Output types with proper constraints\n- Handler function type helpers\n\n### Automatic Hook Logging and Error Handling\n\n**All hooks automatically log to `.claude/logs/hook-events.json`** via the `runHook` wrapper in `shared/hooks/utils/io.ts`. Hook developers don't need to write ANY logging code.\n\n**How it works:**\n1. `runHook(handler)` wraps your hook handler function\n2. Reads input from stdin and creates a debug logger\n3. **Automatically logs input** before executing handler (if debug enabled)\n4. Executes your handler function\n5. **Automatically logs output** after handler completes (if debug enabled)\n6. **Automatically logs errors** if handler throws (if debug enabled)\n7. **ALWAYS returns blocking error response** if handler throws (regardless of debug mode)\n8. Writes output to stdout for Claude Code\n\n**What gets logged:**\n- **Input logs**: Complete hook input including tool names, parameters, session context\n- **Output logs**: Hook return values, additional context, permission decisions\n- **Error logs**: Exception details, stack traces, error messages\n\n**Error Handling Behavior:**\n- **ALL hook errors block execution** - No silent failures\n- **Module resolution errors** (missing imports) block immediately\n- **Runtime errors** (uncaught exceptions) block immediately\n- **Type errors** and other exceptions block immediately\n- Debug flag controls **logging verbosity only**, NOT blocking behavior\n\n**When logging is enabled:**\n- Debug mode is controlled by `input.debug === true` passed from Claude Code\n- Logging is always active when Claude Code runs hooks\n- No environment variables or configuration needed\n\n**Log file format:**\n- Location: `.claude/logs/hook-events.json`\n- Format: JSONL (one JSON object per line)\n- Structure: `{ timestamp, event, type, data }`\n\n**Pattern all hooks follow:**\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Business logic only - NO manual logging needed!\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export for testing\nexport { handler };\n\n// This provides automatic logging AND error handling!\nrunHook(handler);\n```\n\n**Key principle:** Hook handlers should contain ONLY business logic. The `runHook` wrapper handles all logging, error handling, and stdin/stdout communication automatically. All errors are converted to blocking responses to ensure broken hooks cannot fail silently.\n\n### TSDoc Documentation Standards\n\nAll TypeScript files in this project follow TSDoc 2025 best practices:\n\n**Required elements:**\n- **@module** tag at the top of each file describing its purpose\n- **Multi-line format** for all public exports\n- **@param** tags for all parameters with descriptions\n- **@returns** tags describing return values\n- **@throws** tags documenting error conditions\n- **@example** blocks showing realistic usage\n\n**Pattern:**\n```typescript\n/**\n * Brief description of what the function does\n *\n * More detailed explanation of behavior, use cases, and important notes.\n *\n * @param paramName - Description of parameter purpose\n * @returns Description of return value and what it represents\n * @throws Error description - when and why it throws\n *\n * @example\n * ```typescript\n * import { functionName } from './module.js';\n * const result = await functionName('example-input');\n * ```\n */\n```\n\n**References:**\n- TSDoc standard: https://tsdoc.org/\n- TypeScript documentation: https://www.typescriptlang.org/docs/\n\nAll hooks and utilities in this project have comprehensive TSDoc documentation for:\n- Clear understanding of purpose and behavior\n- Type-safe usage with IDE support\n- Maintainability and onboarding\n- Automated documentation generation\n\n## Documentation Best Practices\n\nWhen developing agents, skills, commands, and rules for this project, follow these documentation standards:\n\n### Link to Official Documentation\n\n**Always link to official documentation and best practices** when creating or modifying:\n- Agents\n- Skills\n- Commands\n- Rules\n\n### Prefer Markdown Versions of Documentation\n\nWhen linking to documentation, **prefer `.md` file URLs** over HTML pages whenever available:\n\n**Examples of markdown-friendly documentation:**\n\n- **Claude Code**: https://github.com/anthropics/claude-code/tree/main/docs\n- **Next.js**: https://github.com/vercel/next.js/tree/canary/docs\n- **Vercel**: https://vercel.com/docs (provides markdown-friendly content)\n- **Supabase**: https://github.com/supabase/supabase/tree/master/apps/docs\n\n**Why markdown versions?**\n- More AI-friendly to read and parse\n- Better for offline access\n- Easier to diff and track changes\n- Direct access to source content\n\n### Research Before Implementation\n\nBefore implementing or modifying agents, skills, commands, or rules:\n\n1. **Search for official documentation** - Find the authoritative source\n2. **Search for best practices** - Look for recommended patterns and approaches\n3. **Link explicitly in markdown files** - Include references to official docs in:\n   - Agent `## Agent-scoped project context` sections\n   - Skill `## Skill-scoped context` sections\n   - Rule files under appropriate headings\n   - Command documentation\n\n**Example (Agent):**\n\n```markdown\n## Agent-scoped project context\n\n- Uses Next.js App Router (https://raw.githubusercontent.com/vercel/next.js/canary/docs/app/building-your-application/routing.md)\n- Follows Vercel deployment best practices (https://vercel.com/docs/deployments)\n- TypeScript strict mode enabled (https://www.typescriptlang.org/tsconfig#strict)\n```\n\n**Example (Skill):**\n\n```markdown\n## Skill-scoped context\n\n- Supabase database migrations (https://raw.githubusercontent.com/supabase/supabase/master/apps/docs/content/guides/database/migrations.mdx)\n- Migration best practices: always test locally before production\n- Use meaningful migration names with timestamps\n```\n\n**Example (Rule):**\n\n```markdown\n## Rules\n\n1. Follow TypeScript strict mode guidelines (https://www.typescriptlang.org/tsconfig#strict)\n2. Use Next.js App Router patterns (https://github.com/vercel/next.js/tree/canary/docs/app)\n3. Follow React Server Components best practices (https://github.com/reactwg/server-components/discussions)\n```\n\n### Informing vs. Linking\n\n- **Link to official docs** - These are the authoritative references for tools and frameworks\n- **Use best practices to inform** - Best practices guide how you structure agents, skills, commands, and rules\n- **Keep docs fresh** - Update links when major version changes occur\n\n## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment\n","structuredPatch":[{"oldStart":1031,"oldLines":11,"newStart":1031,"newLines":8,"lines":[" "," ## Documentation"," ","-Comprehensive Claude Code documentation in `.claude/skills/`:","-","-- `claude-plugins/SKILL.md` - Plugin development guide","-- `claude-hooks/SKILL.md` - Hook types and patterns","-- `claude-skills/SKILL.md` - Agent Skills","-- `claude-commands/SKILL.md` - Slash commands","-- `claude-agents/SKILL.md` - Subagent configuration","-- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","+For Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:","+- Plugin structure and development","+- Hook types and patterns","+- Agent, skill, and command creation","+- MCP integration"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:37.452Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:56:37.650Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","old_string":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","new_string":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","oldString":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","newString":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration","originalFile":"---\ntitle: Claude Code Plugins Marketplace\ndescription: A marketplace of Claude Code plugins with shared TypeScript utilities and typed hooks for development workflows\nfolder:\n  subfolders:\n    allowed: [.claude, .claude-plugin, .github, docs, plugins, shared]\n    required: [.claude-plugin, plugins, shared]\n  files:\n    allowed: [CLAUDE.md, LICENSE, package.json, package-lock.json, tsconfig.json, vitest.config.ts, eslint.config.mjs, .gitignore, .attw.json, README.md]\n    required: [CLAUDE.md, package.json]\n---\n\n# Claude Code Plugins\n\n## What This Is\n\nA marketplace of Claude Code plugins with shared TypeScript utilities. This is NOT an npm package - it's a collection of plugins that extend Claude Code with typed hooks for development workflows.\n\n## Architecture\n\n```\n.\nâ”œâ”€â”€ .claude-plugin/\nâ”‚   â””â”€â”€ marketplace.json        # Marketplace definition\nâ”‚\nâ”œâ”€â”€ shared/                     # Shared utilities imported by all plugins\nâ”‚   â”œâ”€â”€ types/\nâ”‚   â”‚   â””â”€â”€ types.ts           # Hook type definitions\nâ”‚   â”œâ”€â”€ hooks/\nâ”‚   â”‚   â”œâ”€â”€ utils/             # Hook utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ io.ts          # stdin/stdout + runHook wrapper\nâ”‚   â”‚   â”‚   â”œâ”€â”€ debug.ts       # Debug logging\nâ”‚   â”‚   â”‚   â”œâ”€â”€ transcripts.ts # Transcript parsing\nâ”‚   â”‚   â”‚   â”œâ”€â”€ subagent-state.ts # Subagent context management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ task-state.ts  # Task state management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ package-manager.ts # Package manager detection\nâ”‚   â”‚   â”‚   â”œâ”€â”€ toml.ts        # TOML parser\nâ”‚   â”‚   â”‚   â”œâ”€â”€ was-tool-event-main-agent.ts # Agent detection\nâ”‚   â”‚   â”‚   â””â”€â”€ index.ts       # Exports all utilities\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-start.ts  # SubagentStart hook\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-stop.ts   # SubagentStop hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-call.ts       # PreToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-result.ts     # PostToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ enforce-structured-markdown.ts  # PreToolUse hook for markdown validation\nâ”‚   â”‚   â”œâ”€â”€ enforce-output-style-tools.ts   # PreToolUse hook for tool enforcement\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-write.ts  # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-mkdir.ts  # PreToolUse[Bash] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-rules-file.ts          # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â””â”€â”€ run-rule-checks.ts              # PostToolUse hook for rule checks\nâ”‚   â””â”€â”€ rules/                  # Claude rules documentation (*.md files)\nâ”‚       â””â”€â”€ CLAUDE.md          # Rules folder documentation\nâ”‚\nâ””â”€â”€ plugins/                    # Individual marketplace plugins\n    â”œâ”€â”€ github-context/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-github.ts           # SessionStart: install GitHub CLI\n    â”‚       â”œâ”€â”€ add-github-context.ts       # SessionStart: branch context & issues\n    â”‚       â”œâ”€â”€ sync-plan-to-issue.ts       # PostToolUse[Write|Edit]: plan sync\n    â”‚       â”œâ”€â”€ enhance-commit-context.ts   # PostToolUse[Bash]: commit enhancement\n    â”‚       â”œâ”€â”€ commit-task.ts              # SubagentStop: auto-commit agent work\n    â”‚       â””â”€â”€ commit-session-check-pr-status.ts  # Stop: session commit & PR checks\n    â”‚\n    â”œâ”€â”€ nextjs-supabase-ai-sdk-dev/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-vercel.ts           # SessionStart: install Vercel CLI\n    â”‚       â”œâ”€â”€ install-supabase.ts         # SessionStart: install Supabase CLI\n    â”‚       â”œâ”€â”€ check-file-eslint.ts        # PostToolUse[Write|Edit]: ESLint on file\n    â”‚       â”œâ”€â”€ check-file-types.ts         # PostToolUse[Write|Edit]: TypeScript on file\n    â”‚       â”œâ”€â”€ check-file-tsdoc.ts         # PostToolUse[Write|Edit]: TSDoc validation\n    â”‚       â”œâ”€â”€ check-file-vitest-results.ts # PostToolUse[Write|Edit]: Vitest on test files\n    â”‚       â”œâ”€â”€ encourage-ui-review.ts      # PostToolUse[Task]: encourage ui-reviewer\n    â”‚       â”œâ”€â”€ check-global-eslint.ts      # Stop: ESLint on all (blocking)\n    â”‚       â”œâ”€â”€ check-global-types.ts       # Stop: TypeScript on all (blocking)\n    â”‚       â””â”€â”€ check-global-vitest-results.ts # Stop: Vitest on all (blocking)\n    â”‚\n    â””â”€â”€ project-context/\n        â”œâ”€â”€ .claude-plugin/plugin.json\n        â””â”€â”€ hooks/\n            â”œâ”€â”€ hooks.json\n            â”œâ”€â”€ encourage-context-review.ts  # UserPromptSubmit: context updates\n            â”œâ”€â”€ add-folder-context.ts        # PostToolUse[Read]: CLAUDE.md discovery\n            â”œâ”€â”€ create-plan-symlink.ts       # PostToolUse[Write|Edit]: PLAN.md symlink\n            â”œâ”€â”€ try-markdown-page.ts         # PreToolUse[WebFetch]: prefer .md URLs\n            â””â”€â”€ shared/                      # Uses shared validation hooks\n                â”œâ”€â”€ log-task-call.ts         # PreToolUse[Task]: save task context\n                â”œâ”€â”€ log-task-result.ts       # PostToolUse[Task]: log task results\n                â”œâ”€â”€ validate-folder-structure-write.ts   # PreToolUse[Write|Edit]\n                â”œâ”€â”€ validate-folder-structure-mkdir.ts   # PreToolUse[Bash]\n                â”œâ”€â”€ validate-rules-file.ts               # PreToolUse[Write|Edit]\n                â””â”€â”€ enforce-plan-scoping.ts              # PostToolUse[Write|Edit|Read]\n```\n\n## Self-Executable Hooks with tsx\n\nAll hooks are self-executable TypeScript files that can be run directly with `npx tsx`. Each hook:\n1. Imports the `runHook` wrapper from `shared/hooks/utils/io.ts`\n2. Defines a `handler` function with typed input/output\n3. Calls `runHook(handler)` at the end of the file\n\n### Hook Pattern\n\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Hook implementation\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export handler for testing\nexport { handler };\n\n// Make this file self-executable with tsx\nrunHook(handler);\n```\n\n### hooks.json Configuration\n\n**IMPORTANT**: The official Claude Code repository and its plugins should serve as the canonical example:\n- Repository: https://github.com/anthropics/claude-code\n- Marketplace: https://raw.githubusercontent.com/anthropics/claude-code/main/.claude-plugin/marketplace.json\n- Example plugins: https://github.com/anthropics/claude-code/tree/main/plugins\n\nHooks must be wrapped in a `\"hooks\"` object:\n\n```json\n{\n  \"description\": \"My plugin description\",\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nVariables provided by Claude Code:\n- `${CLAUDE_PROJECT_DIR}` - Root of the Claude Code project\n- `${CLAUDE_PLUGIN_ROOT}` - Root of the specific plugin being executed\n\n## Shared Folder (`shared/`)\n\n### Types (`shared/types/types.ts`)\n\nFull TypeScript typing for all Claude Code hook events:\n\n```typescript\nimport type {\n  SessionStartInput,\n  SessionStartHookOutput,\n  PostToolUseInput,\n  PostToolUseHookOutput,\n  // ... all hook types\n} from '../../../shared/types/types.js';\n```\n\n### Hook Utilities (`shared/hooks/utils/`)\n\n- **io.ts** - stdin/stdout JSON handling and `runHook` wrapper\n- **debug.ts** - Debug logging with JSONL output to `.claude/logs/hook-events.json`\n- **transcripts.ts** - Parse Claude transcript JSONL files\n- **subagent-state.ts** - Save/load/analyze subagent context and edits\n- **task-state.ts** - Task state management for PreToolUse[Task] â†’ SubagentStop flow\n- **package-manager.ts** - Detect npm/yarn/pnpm/bun from lockfiles\n- **toml.ts** - Simple TOML parser for config files\n- **was-tool-event-main-agent.ts** - Detect if tool event is from main agent or subagent\n- **index.ts** - Re-exports all utilities\n\n### Shared Hooks (`shared/hooks/`)\n\n**Logging and State Management:**\n- **log-subagent-start.ts** - SubagentStart hook that saves agent context\n- **log-subagent-stop.ts** - SubagentStop hook that logs agent file operations\n- **log-task-call.ts** - PreToolUse[Task] hook that saves task call metadata\n- **log-task-result.ts** - PostToolUse[Task] hook that logs task results\n\n**Validation and Enforcement:**\n- **enforce-structured-markdown.ts** - PreToolUse[Write|Edit] hook for comprehensive markdown validation (agents, skills, rules, CLAUDE.md)\n- **enforce-output-style-tools.ts** - PreToolUse hook for output style tool enforcement\n- **validate-folder-structure-write.ts** - PreToolUse[Write|Edit] hook for .claude directory structure validation\n- **validate-folder-structure-mkdir.ts** - PreToolUse[Bash] hook for mkdir command validation\n- **validate-rules-file.ts** - PreToolUse[Write|Edit] hook for rule file structure validation\n\n**Custom Checks:**\n- **run-rule-checks.ts** - PostToolUse[Write|Edit] hook for running custom checks from rule frontmatter\n\n## Available Plugins\n\n### github-context\n\nGitHub integration with branch context, commit enhancement, plan synchronization, and CI orchestration.\n\n**Purpose:**\nProvides comprehensive GitHub integration including CLI installation, branch/issue context discovery, automatic commit enhancement with task metadata, plan-to-issue synchronization, and PR status monitoring.\n\n**Hooks:**\n- **SessionStart** (`install-github.ts`) - Installs GitHub CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`add-github-context.ts`) - Displays linked GitHub issue for current branch, branch sync status, and outstanding issues (non-blocking)\n- **PostToolUse[Write|Edit]** (`sync-plan-to-issue.ts`) - Automatically creates or updates GitHub issues from plan files (non-blocking)\n- **PostToolUse[Bash]** (`enhance-commit-context.ts`) - Enhances git commits with task context and issue references for both main agent and subagents (non-blocking)\n- **SubagentStop** (`commit-task.ts`) - Auto-commits subagent work with task context and git trailers (non-blocking)\n- **Stop** (`commit-session-check-pr-status.ts`) - Auto-commits session changes, checks PR status, and reports CI/preview URLs with progressive blocking\n\n**Key Features:**\n- **Branch Context Discovery:** Shows full GitHub issue content (title, body, comments) linked to current branch\n- **Sync Status:** Displays branch status relative to remote tracking branch and origin/main\n- **Outstanding Issues:** Lists open issues not linked to any branch, available for work\n- **Auto-commit:** Automatically commits subagent work with rich task context\n- **Plan Synchronization:** Creates/updates GitHub issues from plan files automatically\n- **Commit Enhancement:** Enriches commits with task and issue metadata\n- **PR Status Monitoring:** Checks PR status at session end with CI and preview URL reporting\n\n**Use Cases:**\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n- Multi-agent workflows with automatic commit documentation\n\n### nextjs-supabase-ai-sdk-dev\n\nDevelopment quality enforcement for Next.js, Supabase, and AI SDK projects with comprehensive linting, type checking, testing, and CLI installation.\n\n**Purpose:**\nEnsures code quality through automated checks at both file and project levels. Installs Vercel and Supabase CLIs on remote environments, runs per-file quality checks on edits, and performs comprehensive project-wide validation at session end.\n\n**Hooks:**\n- **SessionStart** (`install-vercel.ts`) - Installs Vercel CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`install-supabase.ts`) - Installs Supabase CLI on remote environments, warns if missing locally (non-blocking)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls and saves context for SubagentStop hooks (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after agent completion (non-blocking)\n- **PostToolUse[Task]** (`encourage-ui-review.ts`) - Encourages ui-reviewer agent after ui-developer completes (non-blocking)\n- **PostToolUse[Write|Edit]** (`check-file-eslint.ts`) - Runs ESLint on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-types.ts`) - Runs TypeScript type checking on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-tsdoc.ts`) - Validates TSDoc documentation on TypeScript files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit test files]** (`check-file-vitest-results.ts`) - Runs Vitest on test files after edits (non-blocking, informational)\n- **Stop** (`check-global-eslint.ts`) - Runs ESLint on entire project at session end (blocking)\n- **Stop** (`check-global-types.ts`) - Runs TypeScript type checking on entire project at session end (blocking)\n- **Stop** (`check-global-vitest-results.ts`) - Runs full Vitest test suite at session end (blocking)\n\n**Key Features:**\n- **CLI Installation:** Automatic installation of Vercel and Supabase CLIs on remote environments\n- **Per-File Checks:** Immediate feedback on ESLint, TypeScript, and TSDoc issues after each file edit\n- **Test Execution:** Automatic test running when test files are modified\n- **Project-Wide Validation:** Comprehensive checks at session end ensure no issues slip through\n- **Blocking Stop Hooks:** Prevents ending session with linting errors, type errors, or failing tests\n- **Task Tracking:** Logs all Task tool calls for context in SubagentStop hooks\n- **UI Review Encouragement:** Prompts for visual review after UI development work\n\n**Use Cases:**\n- Next.js application development\n- TypeScript projects requiring strict type safety\n- Projects with comprehensive test suites\n- Teams enforcing code quality standards\n- CI/CD workflows requiring pre-push validation\n\n### project-context\n\nEnhanced context discovery, folder structure validation, and project guidance for Claude Code workflows.\n\n**Purpose:**\nAutomatically discovers and links CLAUDE.md documentation, validates project structure for .claude directories, enforces plan scoping, and encourages context updates based on user prompts. Provides intelligent URL redirection to prefer markdown documentation.\n\n**Hooks:**\n- **UserPromptSubmit** (`encourage-context-review.ts`) - Encourages updating plans, agents, skills, and CLAUDE.md files based on user prompts (non-blocking, informational)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls before execution and saves context (non-blocking)\n- **PreToolUse[Write|Edit]** (shared `validate-folder-structure-write.ts`) - Validates folder structure when creating .claude files (blocking on structure violations)\n- **PreToolUse[Write|Edit]** (shared `validate-rules-file.ts`) - Validates rule file structure and Required Skills frontmatter (blocking on validation errors)\n- **PreToolUse[Bash]** (shared `validate-folder-structure-mkdir.ts`) - Validates mkdir commands for .claude directories (blocking on invalid paths)\n- **PreToolUse[WebFetch]** (`try-markdown-page.ts`) - Redirects WebFetch to markdown versions of documentation when available (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after completion (non-blocking)\n- **PostToolUse[Write|Edit]** (`create-plan-symlink.ts`) - Creates PLAN.md symlink when plan files are written (non-blocking)\n- **PostToolUse[Write|Edit]** (shared `enforce-plan-scoping.ts`) - Enforces plan-based path scoping for write/edit operations (can block on scope violations)\n- **PostToolUse[Read]** (`add-folder-context.ts`) - Discovers and adds CLAUDE.md context when reading files (non-blocking)\n- **PostToolUse[Read]** (shared `enforce-plan-scoping.ts`) - Warns when reads are outside plan scope (non-blocking, guidance only)\n\n**Key Features:**\n- **Automatic Context Discovery:** Finds and links CLAUDE.md files when reading project files\n- **Folder Structure Validation:** Ensures .claude directories follow proper organization standards\n- **Plan Scoping:** Enforces staying within plan boundaries for file operations\n- **Rules Validation:** Ensures rule files have proper structure and Required Skills metadata\n- **Context Encouragement:** Prompts to update documentation based on user activity\n- **Markdown Preference:** Automatically redirects to .md versions of documentation URLs\n- **Plan Symlinks:** Maintains PLAN.md link to active plan file\n- **Task Tracking:** Comprehensive logging of agent invocations and results\n\n**Use Cases:**\n- Large codebases requiring organized documentation\n- Projects with .claude directory structures (agents, skills, rules, hooks)\n- Plan-driven development workflows\n- Documentation-heavy projects\n- Teams enforcing project structure standards\n- Research-oriented development (prefers markdown docs)\n\n## Vercel Preview Configuration\n\nThis project is configured to deploy all Turborepo apps on every commit and PR:\n\n- **Web App** (`apps/web`) - Main application\n- **Admin App** (`apps/admin`) - Administration dashboard\n- **Docs App** (`apps/docs`) - Documentation site\n\n**Preview URL Detection:**\n- Vercel bot posts preview URLs as PR comments\n- UI review workflow polls for these URLs (10 minute timeout)\n- Each app gets its own preview URL: `https://[app-name]-[hash].vercel.app`\n\n**E2E Testing:**\n- Playwright tests run against preview URLs in CI\n- Tests are isolated to `@app` and `@web` tags only\n- Screenshots captured during test execution at key moments\n- Claude API reviews screenshots per app and per test\n\n## Worktree Operation Restrictions\n\n**IMPORTANT**: When working in git worktrees, follow these best practices:\n\n### Recommended Settings (Local Development)\n\nAdd to your local `.claude/settings.json` (NOT committed to repo):\n\n```json\n{\n  \"workingDirectoryRestrictions\": {\n    \"enabled\": true,\n    \"allowedPaths\": [\n      \"/home/user/projects/my-repo/.worktrees/claude-*\"\n    ]\n  }\n}\n```\n\n### Why Worktree Safety Matters\n\n- **Isolation**: Each worktree is an independent branch checkout\n- **Context**: Main repo and worktree can have different files\n- **Safety**: Operations outside worktree can affect main repo or other worktrees\n- **Best Practice**: Review all file operations to ensure they target the worktree\n\n### Worktree Context\n\nThe `github-context-sync` plugin automatically:\n- Shows linked GitHub issue for current branch (full content with comments)\n- Displays branch sync status (remote tracking branch and origin/main)\n- Lists outstanding unlinked issues available for work\n- Encourages UI review after ui-developer agent completes\n\n### Manual Verification\n\nAlways verify you're in the correct worktree:\n\n```bash\npwd                    # Check current directory\ngit rev-parse --show-toplevel  # Show worktree root\ngit branch --show-current      # Show current branch\n```\n\n### Automatic Plugin Cache Management\n\nThe `claude-worktree.sh` script automatically manages plugin cache to ensure every worktree uses current plugin code:\n\n1. **Detects enabled plugins** from `.claude/settings.json`\n2. **Cleans up invalid installations** - Removes cached plugins whose source no longer exists\n3. **Refreshes plugin cache** - Uninstalls and reinstalls all plugins from worktree source\n4. **Ensures fresh hooks** - Every worktree session uses current plugin code\n\n**Why this matters:**\n- Plugins are cached globally at `~/.claude/plugins/cache/`\n- Cache is not automatically invalidated when source changes\n- Old cached hooks can cause unexpected behavior (missing new hooks, running removed hooks)\n- Automatic refresh ensures worktree uses fresh plugin code\n\n**Dependencies:**\n- Requires `jq` for parsing JSON: `brew install jq` (macOS) or `apt install jq` (Linux)\n- Without `jq`, manual plugin reinstallation required\n\n**Manual cache refresh:**\n```bash\n# List plugins\nclaude plugin list\n\n# Uninstall and reinstall\nclaude plugin uninstall --scope project plugin-name@constellos\nclaude plugin install --scope project plugin-name@constellos\n```\n\n## UI Development Workflow\n\nThis project includes a comprehensive UI development system with progressive skills and automated review:\n\n### UI Development Skills (Progressive)\n\n1. **ui-wireframing** - Mobile-first ASCII wireframes in `WIREFRAME.md` files\n2. **ui-design** - Contract-first static UI with compound components\n3. **ui-interaction** - Client-side events, local state, validation\n4. **ui-integration** - Server actions, Supabase queries, backend integration\n5. **ai-sdk-ui** - AI-powered features with Vercel AI SDK\n\n### UI Developer Agent\n\nThe `ui-developer` agent (in `nextjs-supabase-ai-sdk-dev` plugin) provides:\n- All 5 UI skills preloaded\n- MCP integration (ai-elements, shadcn, next-devtools)\n- Systematic workflow: wireframe â†’ design â†’ interaction â†’ integration â†’ AI\n- Mobile-first, contract-first, Server Component defaults\n\n**Local Development:**\n- Uses next-devtools MCP for live preview and debugging\n- No Playwright installation needed locally\n- Real-time UI feedback during development\n\n### UI Review System\n\n**Manual Review:**\n- Invoke `ui-reviewer` agent with screenshot paths\n- Provides systematic quality review\n- Identifies critical, major, and minor issues\n\n**Automated CI Review:**\n- GitHub Actions workflow (`ui-review.yml`) runs on commits/PRs\n- Playwright e2e tests for `@app` and `@web` tags\n- Screenshots captured during test execution\n- Claude API reviews each test's screenshots with vision\n- Per-test reviews aggregated into final report\n- Blocks merge if critical issues found\n\n**Review Criteria:**\n- Visual consistency across breakpoints\n- Responsive behavior (mobile, tablet, desktop)\n- Accessibility (color contrast, semantic HTML)\n- Component composition patterns\n- User experience quality\n\n### Technology Stack\n\n- **UI Components**: Shadcn (default), AI Elements, Radix, HTML\n- **Styling**: Tailwind CSS with mobile-first approach\n- **State Management**: Server Components (default), client components when needed\n- **Validation**: Zod schemas (client + server)\n- **Backend**: Supabase with defense-in-depth (RLS + explicit auth checks)\n- **AI Integration**: Vercel AI SDK with streaming UI\n\n## Creating New Plugins\n\n1. Create plugin directory:\n   ```bash\n   mkdir -p plugins/my-plugin/.claude-plugin\n   mkdir -p plugins/my-plugin/hooks\n   ```\n\n2. Create `plugin.json`:\n   ```json\n   {\n     \"name\": \"my-plugin\",\n     \"version\": \"0.1.0\",\n     \"description\": \"My custom plugin\",\n     \"author\": { \"name\": \"your-name\" }\n   }\n   ```\n\n3. Create `hooks/hooks.json`:\n   ```json\n   {\n     \"description\": \"My plugin hooks\",\n     \"hooks\": {\n       \"SessionStart\": [\n         {\n           \"hooks\": [\n             {\n               \"type\": \"command\",\n               \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n             }\n           ]\n         }\n       ]\n     }\n   }\n   ```\n\n4. Create hook file `hooks/my-hook.ts` with proper TSDoc:\n   ```typescript\n   /**\n    * Brief description of what this hook does\n    *\n    * Detailed explanation of the hook's purpose, when it triggers,\n    * and what it accomplishes.\n    *\n    * @module my-hook\n    */\n\n   import type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\n   import { runHook } from '../../../shared/hooks/utils/io.js';\n\n   /**\n    * SessionStart hook handler\n    *\n    * Executes at session start to perform [specific action].\n    *\n    * @param input - SessionStart hook input from Claude Code\n    * @returns Hook output with additional context\n    *\n    * @example\n    * ```typescript\n    * // This hook is automatically called by Claude Code\n    * // when a new session starts\n    * ```\n    */\n   async function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n     return {\n       hookSpecificOutput: {\n         hookEventName: 'SessionStart',\n         additionalContext: 'My hook executed!',\n       },\n     };\n   }\n\n   export { handler };\n   runHook(handler);\n   ```\n\n5. Add to marketplace.json:\n   ```json\n   {\n     \"plugins\": [\n       {\n         \"name\": \"my-plugin\",\n         \"source\": \"./plugins/my-plugin\"\n       }\n     ]\n   }\n   ```\n\n6. Create `README.md` documenting your plugin:\n   ```markdown\n   # My Plugin\n\n   Brief description of what the plugin does.\n\n   ## Overview\n\n   Detailed explanation of the plugin's purpose and capabilities.\n\n   ## Hooks\n\n   ### SessionStart - Hook Name\n\n   **File:** `hooks/my-hook.ts`\n   **Event:** SessionStart\n   **What it does:** Detailed description of hook behavior\n   **Non-blocking:** Yes/No\n\n   ## Installation\n\n   \\```bash\n   claude plugin install my-plugin@constellos\n   \\```\n\n   ## Configuration\n\n   Description of any configuration options.\n\n   ## Debug Logging\n\n   \\```bash\n   DEBUG=my-hook claude\n   \\```\n   ```\n\n## Local Development\n\n### Using Plugins in This Repo\n\nConfiguration in `.claude/settings.json`:\n\n```json\n{\n  \"enabledPlugins\": {\n    \"github-vercel-supabase-ci@constellos\": true,\n    \"github-review-sync@constellos\": true,\n    \"nextjs-supabase-ai-sdk-dev@constellos\": true,\n    \"code-context@constellos\": true,\n    \"markdown-structure-rules@constellos\": true\n  }\n}\n```\n\nNote: The marketplace is automatically registered when you run `claude plugin marketplace add ./` from the project root.\n\n### Installing Plugins\n\nFirst, add the marketplace:\n```bash\nclaude plugin marketplace add ./\n```\n\nThen install the plugins:\n```bash\nclaude plugin install github-vercel-supabase-ci@constellos\nclaude plugin install github-review-sync@constellos\nclaude plugin install nextjs-supabase-ai-sdk-dev@constellos\nclaude plugin install code-context@constellos\nclaude plugin install markdown-structure-rules@constellos\n```\n\n### Testing Changes\n\n1. Edit plugin files in `plugins/` or shared utilities in `shared/`\n2. Exit Claude Code session\n3. Start new session\n4. Changes are automatically loaded\n\n## Testing\n\nRun tests and checks:\n\n```bash\nnpm run typecheck     # TypeScript type checking\nnpm run lint          # ESLint\nnpm run test          # Vitest\nnpm run test:watch    # Vitest watch mode\n```\n\nEnable debug logging for hooks:\n```bash\nDEBUG=* claude              # All debug output\nDEBUG=plugin-name claude    # Specific plugin\n```\n\n## Claude Code Documentation Notes\n\nThe official Claude Code documentation may be out of date or incomplete. When implementing hooks:\n\n- **Test actual behavior** rather than relying solely on docs\n- **Check GitHub issues** for known bugs (e.g., issue #10412 about Stop hooks via plugins)\n- **The `reason` field in Stop hooks is shown to Claude** (tells it what to fix)\n- **The `systemMessage` field is shown to the user** (status info, not visible to Claude)\n- **Use explicit `decision: \"approve\"`** when allowing stop (not just empty `{}`)\n- **Use explicit `decision: \"block\"` with actionable `reason`** when blocking\n\n### Stop Hook Output Best Practices\n\n```typescript\n// When blocking - provide actionable instructions to Claude\nreturn {\n  decision: 'block',\n  reason: 'ESLint errors detected. You MUST fix these before stopping:\\n\\n[errors here]\\n\\nFix each error, then run linter to verify.',\n  systemMessage: 'Claude is blocked from stopping due to ESLint errors.',\n};\n\n// When approving - be explicit\nreturn { decision: 'approve' };\n```\n\n## Troubleshooting\n\n### Hooks Not Firing\n\nIf hooks aren't executing:\n\n1. **Check plugin cache**: Plugins are cached in `~/.claude/plugins/cache/`. Verify the cached `hooks.json` has the correct format with the `\"hooks\"` wrapper.\n\n2. **Verify hooks.json format**: Use the claude-code-guide agent to confirm the correct format:\n   ```bash\n   # In Claude Code session\n   /help hooks.json format\n   ```\n\n   Or research with the claude-code-guide agent:\n   - What is the correct format for hooks.json?\n   - Should hooks be wrapped in a \"hooks\" object?\n\n3. **Reinstall plugins**: If you changed the hooks.json format, reinstall to refresh cache:\n   ```bash\n   claude plugin uninstall --scope project my-plugin@constellos\n   claude plugin install --scope project my-plugin@constellos\n   ```\n\n4. **Restart Claude Code**: Hooks only load when Claude Code starts. After any plugin changes:\n   - Exit current session\n   - Start new session\n   - Verify hooks fire by checking `.claude/logs/hook-events.json`\n\n5. **Validate plugins**: Check for configuration issues:\n   ```bash\n   claude plugin validate plugins/my-plugin\n   claude plugin marketplace list\n   ```\n\n6. **Check marketplace configuration**: In `.claude/settings.json`:\n   ```json\n   {\n     \"extraKnownMarketplaces\": {\n       \"constellos\": {\n         \"source\": {\n           \"source\": \"directory\",\n           \"path\": \"./.claude-plugin\"\n         }\n       }\n     },\n     \"enabledPlugins\": {\n       \"my-plugin@constellos\": true\n     }\n   }\n   ```\n\n7. **Use claude-code-guide for research**: When troubleshooting, always use the claude-code-guide agent for accurate documentation:\n   - Hook event types and lifecycle\n   - Plugin installation and configuration\n   - Debugging techniques\n\n### Plugin Cache Out of Sync\n\n**Symptom:** Hooks behaving differently than expected (old hooks firing, new hooks missing, removed hooks still running)\n\n**Cause:** Plugin cache at `~/.claude/plugins/cache/` contains old versions from before recent changes\n\n**Solution:**\n\n1. **Automatic (recommended):** Use `claude-worktree.sh` which auto-refreshes plugins on every new worktree\n   ```bash\n   bash claude-worktree.sh\n   ```\n\n2. **Manual:** Reinstall plugins to refresh cache:\n   ```bash\n   # Uninstall all constellos plugins\n   claude plugin uninstall --scope project github-context@constellos\n   claude plugin uninstall --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin uninstall --scope project project-context@constellos\n\n   # Reinstall from current source\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n3. **Nuclear option:** Delete entire cache and reinstall:\n   ```bash\n   rm -rf ~/.claude/plugins/cache/constellos\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n**Verification:**\n```bash\n# Check if await-pr-checks hook exists (added in PR #71)\nls ~/.claude/plugins/cache/constellos/github-context/hooks/await-pr-checks.ts\n\n# Verify NO Stop hooks in nextjs-supabase-ai-sdk-dev (removed in PR #71)\ncat ~/.claude/plugins/cache/constellos/nextjs-supabase-ai-sdk-dev/hooks/hooks.json | grep -i \"stop\"\n\n# Compare cached vs source to see differences\ndiff ~/.claude/plugins/cache/constellos/github-context/hooks/hooks.json \\\n     ./plugins/github-context/hooks/hooks.json\n```\n\n### When to Restart Sessions vs Reinstall Plugins\n\nUnderstanding when changes require a session restart vs plugin reinstall helps maintain an efficient development workflow.\n\n**Requires NEW session** (exit and restart Claude Code):\n- Changes to `.claude/settings.json`:\n  - Modifying `enabledPlugins`\n  - Adding/removing `extraKnownMarketplaces`\n  - Changing marketplace paths or configuration\n- Adding new plugins to marketplace\n- Removing plugins from marketplace\n- Changes to `.claude-plugin/marketplace.json`\n\n**Requires plugin REINSTALL** (no session restart needed):\n- Changes to `hooks/hooks.json` (hook configuration)\n- Changes to `.claude-plugin/plugin.json` (plugin metadata)\n- Changes to hook implementation files (`.ts` files)\n- Changes to shared utilities in `shared/` folder\n- Bug fixes or improvements to existing hooks\n\n**Reinstall command:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**Or use the quick reinstall pattern:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos 2>/dev/null || true && \\\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**No restart or reinstall needed:**\n- Documentation changes (README.md, CLAUDE.md)\n- Comment updates in code\n- Test file changes\n- Non-hook TypeScript files\n\n**Why this matters:**\n- Plugin files are copied to `~/.claude/plugins/cache/` during installation\n- Claude Code loads plugin configuration only at session start\n- Reinstalling updates the cache without requiring a full session restart\n- This allows rapid iteration during plugin development\n\n**Development workflow:**\n1. Make changes to hook implementation\n2. Reinstall the plugin to update cache\n3. Test the changes in current session\n4. Repeat until working correctly\n\n**Only restart session when:**\n- You've made changes to `.claude/settings.json`\n- You've added/removed plugins from the marketplace\n- Reinstalling doesn't seem to apply your changes\n\n## Key Architecture Decisions\n\n### Self-Executable Hooks\n\nEach hook is a standalone TypeScript file that:\n- Uses the `runHook` wrapper for stdin/stdout handling\n- Can be executed directly with `npx tsx`\n- Exports a named `handler` function for testing\n- No separate runner script needed\n\n### Shared Utilities Pattern\n\nAll plugins import from `shared/` rather than duplicating code:\n- Consistent typing across all hooks\n- Shared I/O, debug, and transcript utilities\n- Easy updates to all plugins\n\n### Type Safety\n\nFull TypeScript typing for all hook events in `shared/types/types.ts`:\n- Input types for each hook event\n- Output types with proper constraints\n- Handler function type helpers\n\n### Automatic Hook Logging and Error Handling\n\n**All hooks automatically log to `.claude/logs/hook-events.json`** via the `runHook` wrapper in `shared/hooks/utils/io.ts`. Hook developers don't need to write ANY logging code.\n\n**How it works:**\n1. `runHook(handler)` wraps your hook handler function\n2. Reads input from stdin and creates a debug logger\n3. **Automatically logs input** before executing handler (if debug enabled)\n4. Executes your handler function\n5. **Automatically logs output** after handler completes (if debug enabled)\n6. **Automatically logs errors** if handler throws (if debug enabled)\n7. **ALWAYS returns blocking error response** if handler throws (regardless of debug mode)\n8. Writes output to stdout for Claude Code\n\n**What gets logged:**\n- **Input logs**: Complete hook input including tool names, parameters, session context\n- **Output logs**: Hook return values, additional context, permission decisions\n- **Error logs**: Exception details, stack traces, error messages\n\n**Error Handling Behavior:**\n- **ALL hook errors block execution** - No silent failures\n- **Module resolution errors** (missing imports) block immediately\n- **Runtime errors** (uncaught exceptions) block immediately\n- **Type errors** and other exceptions block immediately\n- Debug flag controls **logging verbosity only**, NOT blocking behavior\n\n**When logging is enabled:**\n- Debug mode is controlled by `input.debug === true` passed from Claude Code\n- Logging is always active when Claude Code runs hooks\n- No environment variables or configuration needed\n\n**Log file format:**\n- Location: `.claude/logs/hook-events.json`\n- Format: JSONL (one JSON object per line)\n- Structure: `{ timestamp, event, type, data }`\n\n**Pattern all hooks follow:**\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Business logic only - NO manual logging needed!\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export for testing\nexport { handler };\n\n// This provides automatic logging AND error handling!\nrunHook(handler);\n```\n\n**Key principle:** Hook handlers should contain ONLY business logic. The `runHook` wrapper handles all logging, error handling, and stdin/stdout communication automatically. All errors are converted to blocking responses to ensure broken hooks cannot fail silently.\n\n### TSDoc Documentation Standards\n\nAll TypeScript files in this project follow TSDoc 2025 best practices:\n\n**Required elements:**\n- **@module** tag at the top of each file describing its purpose\n- **Multi-line format** for all public exports\n- **@param** tags for all parameters with descriptions\n- **@returns** tags describing return values\n- **@throws** tags documenting error conditions\n- **@example** blocks showing realistic usage\n\n**Pattern:**\n```typescript\n/**\n * Brief description of what the function does\n *\n * More detailed explanation of behavior, use cases, and important notes.\n *\n * @param paramName - Description of parameter purpose\n * @returns Description of return value and what it represents\n * @throws Error description - when and why it throws\n *\n * @example\n * ```typescript\n * import { functionName } from './module.js';\n * const result = await functionName('example-input');\n * ```\n */\n```\n\n**References:**\n- TSDoc standard: https://tsdoc.org/\n- TypeScript documentation: https://www.typescriptlang.org/docs/\n\nAll hooks and utilities in this project have comprehensive TSDoc documentation for:\n- Clear understanding of purpose and behavior\n- Type-safe usage with IDE support\n- Maintainability and onboarding\n- Automated documentation generation\n\n## Documentation Best Practices\n\nWhen developing agents, skills, commands, and rules for this project, follow these documentation standards:\n\n### Link to Official Documentation\n\n**Always link to official documentation and best practices** when creating or modifying:\n- Agents\n- Skills\n- Commands\n- Rules\n\n### Prefer Markdown Versions of Documentation\n\nWhen linking to documentation, **prefer `.md` file URLs** over HTML pages whenever available:\n\n**Examples of markdown-friendly documentation:**\n\n- **Claude Code**: https://github.com/anthropics/claude-code/tree/main/docs\n- **Next.js**: https://github.com/vercel/next.js/tree/canary/docs\n- **Vercel**: https://vercel.com/docs (provides markdown-friendly content)\n- **Supabase**: https://github.com/supabase/supabase/tree/master/apps/docs\n\n**Why markdown versions?**\n- More AI-friendly to read and parse\n- Better for offline access\n- Easier to diff and track changes\n- Direct access to source content\n\n### Research Before Implementation\n\nBefore implementing or modifying agents, skills, commands, or rules:\n\n1. **Search for official documentation** - Find the authoritative source\n2. **Search for best practices** - Look for recommended patterns and approaches\n3. **Link explicitly in markdown files** - Include references to official docs in:\n   - Agent `## Agent-scoped project context` sections\n   - Skill `## Skill-scoped context` sections\n   - Rule files under appropriate headings\n   - Command documentation\n\n**Example (Agent):**\n\n```markdown\n## Agent-scoped project context\n\n- Uses Next.js App Router (https://raw.githubusercontent.com/vercel/next.js/canary/docs/app/building-your-application/routing.md)\n- Follows Vercel deployment best practices (https://vercel.com/docs/deployments)\n- TypeScript strict mode enabled (https://www.typescriptlang.org/tsconfig#strict)\n```\n\n**Example (Skill):**\n\n```markdown\n## Skill-scoped context\n\n- Supabase database migrations (https://raw.githubusercontent.com/supabase/supabase/master/apps/docs/content/guides/database/migrations.mdx)\n- Migration best practices: always test locally before production\n- Use meaningful migration names with timestamps\n```\n\n**Example (Rule):**\n\n```markdown\n## Rules\n\n1. Follow TypeScript strict mode guidelines (https://www.typescriptlang.org/tsconfig#strict)\n2. Use Next.js App Router patterns (https://github.com/vercel/next.js/tree/canary/docs/app)\n3. Follow React Server Components best practices (https://github.com/reactwg/server-components/discussions)\n```\n\n### Informing vs. Linking\n\n- **Link to official docs** - These are the authoritative references for tools and frameworks\n- **Use best practices to inform** - Best practices guide how you structure agents, skills, commands, and rules\n- **Keep docs fresh** - Update links when major version changes occur\n\n## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment\n","structuredPatch":[{"oldStart":1031,"oldLines":11,"newStart":1031,"newLines":8,"lines":[" "," ## Documentation"," ","-Comprehensive Claude Code documentation in `.claude/skills/`:","-","-- `claude-plugins/SKILL.md` - Plugin development guide","-- `claude-hooks/SKILL.md` - Hook types and patterns","-- `claude-skills/SKILL.md` - Agent Skills","-- `claude-commands/SKILL.md` - Slash commands","-- `claude-agents/SKILL.md` - Subagent configuration","-- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","+For Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:","+- Plugin structure and development","+- Hook types and patterns","+- Agent, skill, and command creation","+- MCP integration"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:37.663Z","event":"lint-file","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:37.984Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","old_string":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","new_string":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","oldString":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","newString":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration","originalFile":"---\ntitle: Claude Code Plugins Marketplace\ndescription: A marketplace of Claude Code plugins with shared TypeScript utilities and typed hooks for development workflows\nfolder:\n  subfolders:\n    allowed: [.claude, .claude-plugin, .github, docs, plugins, shared]\n    required: [.claude-plugin, plugins, shared]\n  files:\n    allowed: [CLAUDE.md, LICENSE, package.json, package-lock.json, tsconfig.json, vitest.config.ts, eslint.config.mjs, .gitignore, .attw.json, README.md]\n    required: [CLAUDE.md, package.json]\n---\n\n# Claude Code Plugins\n\n## What This Is\n\nA marketplace of Claude Code plugins with shared TypeScript utilities. This is NOT an npm package - it's a collection of plugins that extend Claude Code with typed hooks for development workflows.\n\n## Architecture\n\n```\n.\nâ”œâ”€â”€ .claude-plugin/\nâ”‚   â””â”€â”€ marketplace.json        # Marketplace definition\nâ”‚\nâ”œâ”€â”€ shared/                     # Shared utilities imported by all plugins\nâ”‚   â”œâ”€â”€ types/\nâ”‚   â”‚   â””â”€â”€ types.ts           # Hook type definitions\nâ”‚   â”œâ”€â”€ hooks/\nâ”‚   â”‚   â”œâ”€â”€ utils/             # Hook utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ io.ts          # stdin/stdout + runHook wrapper\nâ”‚   â”‚   â”‚   â”œâ”€â”€ debug.ts       # Debug logging\nâ”‚   â”‚   â”‚   â”œâ”€â”€ transcripts.ts # Transcript parsing\nâ”‚   â”‚   â”‚   â”œâ”€â”€ subagent-state.ts # Subagent context management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ task-state.ts  # Task state management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ package-manager.ts # Package manager detection\nâ”‚   â”‚   â”‚   â”œâ”€â”€ toml.ts        # TOML parser\nâ”‚   â”‚   â”‚   â”œâ”€â”€ was-tool-event-main-agent.ts # Agent detection\nâ”‚   â”‚   â”‚   â””â”€â”€ index.ts       # Exports all utilities\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-start.ts  # SubagentStart hook\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-stop.ts   # SubagentStop hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-call.ts       # PreToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-result.ts     # PostToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ enforce-structured-markdown.ts  # PreToolUse hook for markdown validation\nâ”‚   â”‚   â”œâ”€â”€ enforce-output-style-tools.ts   # PreToolUse hook for tool enforcement\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-write.ts  # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-mkdir.ts  # PreToolUse[Bash] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-rules-file.ts          # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â””â”€â”€ run-rule-checks.ts              # PostToolUse hook for rule checks\nâ”‚   â””â”€â”€ rules/                  # Claude rules documentation (*.md files)\nâ”‚       â””â”€â”€ CLAUDE.md          # Rules folder documentation\nâ”‚\nâ””â”€â”€ plugins/                    # Individual marketplace plugins\n    â”œâ”€â”€ github-context/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-github.ts           # SessionStart: install GitHub CLI\n    â”‚       â”œâ”€â”€ add-github-context.ts       # SessionStart: branch context & issues\n    â”‚       â”œâ”€â”€ sync-plan-to-issue.ts       # PostToolUse[Write|Edit]: plan sync\n    â”‚       â”œâ”€â”€ enhance-commit-context.ts   # PostToolUse[Bash]: commit enhancement\n    â”‚       â”œâ”€â”€ commit-task.ts              # SubagentStop: auto-commit agent work\n    â”‚       â””â”€â”€ commit-session-check-pr-status.ts  # Stop: session commit & PR checks\n    â”‚\n    â”œâ”€â”€ nextjs-supabase-ai-sdk-dev/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-vercel.ts           # SessionStart: install Vercel CLI\n    â”‚       â”œâ”€â”€ install-supabase.ts         # SessionStart: install Supabase CLI\n    â”‚       â”œâ”€â”€ check-file-eslint.ts        # PostToolUse[Write|Edit]: ESLint on file\n    â”‚       â”œâ”€â”€ check-file-types.ts         # PostToolUse[Write|Edit]: TypeScript on file\n    â”‚       â”œâ”€â”€ check-file-tsdoc.ts         # PostToolUse[Write|Edit]: TSDoc validation\n    â”‚       â”œâ”€â”€ check-file-vitest-results.ts # PostToolUse[Write|Edit]: Vitest on test files\n    â”‚       â”œâ”€â”€ encourage-ui-review.ts      # PostToolUse[Task]: encourage ui-reviewer\n    â”‚       â”œâ”€â”€ check-global-eslint.ts      # Stop: ESLint on all (blocking)\n    â”‚       â”œâ”€â”€ check-global-types.ts       # Stop: TypeScript on all (blocking)\n    â”‚       â””â”€â”€ check-global-vitest-results.ts # Stop: Vitest on all (blocking)\n    â”‚\n    â””â”€â”€ project-context/\n        â”œâ”€â”€ .claude-plugin/plugin.json\n        â””â”€â”€ hooks/\n            â”œâ”€â”€ hooks.json\n            â”œâ”€â”€ encourage-context-review.ts  # UserPromptSubmit: context updates\n            â”œâ”€â”€ add-folder-context.ts        # PostToolUse[Read]: CLAUDE.md discovery\n            â”œâ”€â”€ create-plan-symlink.ts       # PostToolUse[Write|Edit]: PLAN.md symlink\n            â”œâ”€â”€ try-markdown-page.ts         # PreToolUse[WebFetch]: prefer .md URLs\n            â””â”€â”€ shared/                      # Uses shared validation hooks\n                â”œâ”€â”€ log-task-call.ts         # PreToolUse[Task]: save task context\n                â”œâ”€â”€ log-task-result.ts       # PostToolUse[Task]: log task results\n                â”œâ”€â”€ validate-folder-structure-write.ts   # PreToolUse[Write|Edit]\n                â”œâ”€â”€ validate-folder-structure-mkdir.ts   # PreToolUse[Bash]\n                â”œâ”€â”€ validate-rules-file.ts               # PreToolUse[Write|Edit]\n                â””â”€â”€ enforce-plan-scoping.ts              # PostToolUse[Write|Edit|Read]\n```\n\n## Self-Executable Hooks with tsx\n\nAll hooks are self-executable TypeScript files that can be run directly with `npx tsx`. Each hook:\n1. Imports the `runHook` wrapper from `shared/hooks/utils/io.ts`\n2. Defines a `handler` function with typed input/output\n3. Calls `runHook(handler)` at the end of the file\n\n### Hook Pattern\n\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Hook implementation\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export handler for testing\nexport { handler };\n\n// Make this file self-executable with tsx\nrunHook(handler);\n```\n\n### hooks.json Configuration\n\n**IMPORTANT**: The official Claude Code repository and its plugins should serve as the canonical example:\n- Repository: https://github.com/anthropics/claude-code\n- Marketplace: https://raw.githubusercontent.com/anthropics/claude-code/main/.claude-plugin/marketplace.json\n- Example plugins: https://github.com/anthropics/claude-code/tree/main/plugins\n\nHooks must be wrapped in a `\"hooks\"` object:\n\n```json\n{\n  \"description\": \"My plugin description\",\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nVariables provided by Claude Code:\n- `${CLAUDE_PROJECT_DIR}` - Root of the Claude Code project\n- `${CLAUDE_PLUGIN_ROOT}` - Root of the specific plugin being executed\n\n## Shared Folder (`shared/`)\n\n### Types (`shared/types/types.ts`)\n\nFull TypeScript typing for all Claude Code hook events:\n\n```typescript\nimport type {\n  SessionStartInput,\n  SessionStartHookOutput,\n  PostToolUseInput,\n  PostToolUseHookOutput,\n  // ... all hook types\n} from '../../../shared/types/types.js';\n```\n\n### Hook Utilities (`shared/hooks/utils/`)\n\n- **io.ts** - stdin/stdout JSON handling and `runHook` wrapper\n- **debug.ts** - Debug logging with JSONL output to `.claude/logs/hook-events.json`\n- **transcripts.ts** - Parse Claude transcript JSONL files\n- **subagent-state.ts** - Save/load/analyze subagent context and edits\n- **task-state.ts** - Task state management for PreToolUse[Task] â†’ SubagentStop flow\n- **package-manager.ts** - Detect npm/yarn/pnpm/bun from lockfiles\n- **toml.ts** - Simple TOML parser for config files\n- **was-tool-event-main-agent.ts** - Detect if tool event is from main agent or subagent\n- **index.ts** - Re-exports all utilities\n\n### Shared Hooks (`shared/hooks/`)\n\n**Logging and State Management:**\n- **log-subagent-start.ts** - SubagentStart hook that saves agent context\n- **log-subagent-stop.ts** - SubagentStop hook that logs agent file operations\n- **log-task-call.ts** - PreToolUse[Task] hook that saves task call metadata\n- **log-task-result.ts** - PostToolUse[Task] hook that logs task results\n\n**Validation and Enforcement:**\n- **enforce-structured-markdown.ts** - PreToolUse[Write|Edit] hook for comprehensive markdown validation (agents, skills, rules, CLAUDE.md)\n- **enforce-output-style-tools.ts** - PreToolUse hook for output style tool enforcement\n- **validate-folder-structure-write.ts** - PreToolUse[Write|Edit] hook for .claude directory structure validation\n- **validate-folder-structure-mkdir.ts** - PreToolUse[Bash] hook for mkdir command validation\n- **validate-rules-file.ts** - PreToolUse[Write|Edit] hook for rule file structure validation\n\n**Custom Checks:**\n- **run-rule-checks.ts** - PostToolUse[Write|Edit] hook for running custom checks from rule frontmatter\n\n## Available Plugins\n\n### github-context\n\nGitHub integration with branch context, commit enhancement, plan synchronization, and CI orchestration.\n\n**Purpose:**\nProvides comprehensive GitHub integration including CLI installation, branch/issue context discovery, automatic commit enhancement with task metadata, plan-to-issue synchronization, and PR status monitoring.\n\n**Hooks:**\n- **SessionStart** (`install-github.ts`) - Installs GitHub CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`add-github-context.ts`) - Displays linked GitHub issue for current branch, branch sync status, and outstanding issues (non-blocking)\n- **PostToolUse[Write|Edit]** (`sync-plan-to-issue.ts`) - Automatically creates or updates GitHub issues from plan files (non-blocking)\n- **PostToolUse[Bash]** (`enhance-commit-context.ts`) - Enhances git commits with task context and issue references for both main agent and subagents (non-blocking)\n- **SubagentStop** (`commit-task.ts`) - Auto-commits subagent work with task context and git trailers (non-blocking)\n- **Stop** (`commit-session-check-pr-status.ts`) - Auto-commits session changes, checks PR status, and reports CI/preview URLs with progressive blocking\n\n**Key Features:**\n- **Branch Context Discovery:** Shows full GitHub issue content (title, body, comments) linked to current branch\n- **Sync Status:** Displays branch status relative to remote tracking branch and origin/main\n- **Outstanding Issues:** Lists open issues not linked to any branch, available for work\n- **Auto-commit:** Automatically commits subagent work with rich task context\n- **Plan Synchronization:** Creates/updates GitHub issues from plan files automatically\n- **Commit Enhancement:** Enriches commits with task and issue metadata\n- **PR Status Monitoring:** Checks PR status at session end with CI and preview URL reporting\n\n**Use Cases:**\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n- Multi-agent workflows with automatic commit documentation\n\n### nextjs-supabase-ai-sdk-dev\n\nDevelopment quality enforcement for Next.js, Supabase, and AI SDK projects with comprehensive linting, type checking, testing, and CLI installation.\n\n**Purpose:**\nEnsures code quality through automated checks at both file and project levels. Installs Vercel and Supabase CLIs on remote environments, runs per-file quality checks on edits, and performs comprehensive project-wide validation at session end.\n\n**Hooks:**\n- **SessionStart** (`install-vercel.ts`) - Installs Vercel CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`install-supabase.ts`) - Installs Supabase CLI on remote environments, warns if missing locally (non-blocking)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls and saves context for SubagentStop hooks (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after agent completion (non-blocking)\n- **PostToolUse[Task]** (`encourage-ui-review.ts`) - Encourages ui-reviewer agent after ui-developer completes (non-blocking)\n- **PostToolUse[Write|Edit]** (`check-file-eslint.ts`) - Runs ESLint on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-types.ts`) - Runs TypeScript type checking on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-tsdoc.ts`) - Validates TSDoc documentation on TypeScript files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit test files]** (`check-file-vitest-results.ts`) - Runs Vitest on test files after edits (non-blocking, informational)\n- **Stop** (`check-global-eslint.ts`) - Runs ESLint on entire project at session end (blocking)\n- **Stop** (`check-global-types.ts`) - Runs TypeScript type checking on entire project at session end (blocking)\n- **Stop** (`check-global-vitest-results.ts`) - Runs full Vitest test suite at session end (blocking)\n\n**Key Features:**\n- **CLI Installation:** Automatic installation of Vercel and Supabase CLIs on remote environments\n- **Per-File Checks:** Immediate feedback on ESLint, TypeScript, and TSDoc issues after each file edit\n- **Test Execution:** Automatic test running when test files are modified\n- **Project-Wide Validation:** Comprehensive checks at session end ensure no issues slip through\n- **Blocking Stop Hooks:** Prevents ending session with linting errors, type errors, or failing tests\n- **Task Tracking:** Logs all Task tool calls for context in SubagentStop hooks\n- **UI Review Encouragement:** Prompts for visual review after UI development work\n\n**Use Cases:**\n- Next.js application development\n- TypeScript projects requiring strict type safety\n- Projects with comprehensive test suites\n- Teams enforcing code quality standards\n- CI/CD workflows requiring pre-push validation\n\n### project-context\n\nEnhanced context discovery, folder structure validation, and project guidance for Claude Code workflows.\n\n**Purpose:**\nAutomatically discovers and links CLAUDE.md documentation, validates project structure for .claude directories, enforces plan scoping, and encourages context updates based on user prompts. Provides intelligent URL redirection to prefer markdown documentation.\n\n**Hooks:**\n- **UserPromptSubmit** (`encourage-context-review.ts`) - Encourages updating plans, agents, skills, and CLAUDE.md files based on user prompts (non-blocking, informational)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls before execution and saves context (non-blocking)\n- **PreToolUse[Write|Edit]** (shared `validate-folder-structure-write.ts`) - Validates folder structure when creating .claude files (blocking on structure violations)\n- **PreToolUse[Write|Edit]** (shared `validate-rules-file.ts`) - Validates rule file structure and Required Skills frontmatter (blocking on validation errors)\n- **PreToolUse[Bash]** (shared `validate-folder-structure-mkdir.ts`) - Validates mkdir commands for .claude directories (blocking on invalid paths)\n- **PreToolUse[WebFetch]** (`try-markdown-page.ts`) - Redirects WebFetch to markdown versions of documentation when available (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after completion (non-blocking)\n- **PostToolUse[Write|Edit]** (`create-plan-symlink.ts`) - Creates PLAN.md symlink when plan files are written (non-blocking)\n- **PostToolUse[Write|Edit]** (shared `enforce-plan-scoping.ts`) - Enforces plan-based path scoping for write/edit operations (can block on scope violations)\n- **PostToolUse[Read]** (`add-folder-context.ts`) - Discovers and adds CLAUDE.md context when reading files (non-blocking)\n- **PostToolUse[Read]** (shared `enforce-plan-scoping.ts`) - Warns when reads are outside plan scope (non-blocking, guidance only)\n\n**Key Features:**\n- **Automatic Context Discovery:** Finds and links CLAUDE.md files when reading project files\n- **Folder Structure Validation:** Ensures .claude directories follow proper organization standards\n- **Plan Scoping:** Enforces staying within plan boundaries for file operations\n- **Rules Validation:** Ensures rule files have proper structure and Required Skills metadata\n- **Context Encouragement:** Prompts to update documentation based on user activity\n- **Markdown Preference:** Automatically redirects to .md versions of documentation URLs\n- **Plan Symlinks:** Maintains PLAN.md link to active plan file\n- **Task Tracking:** Comprehensive logging of agent invocations and results\n\n**Use Cases:**\n- Large codebases requiring organized documentation\n- Projects with .claude directory structures (agents, skills, rules, hooks)\n- Plan-driven development workflows\n- Documentation-heavy projects\n- Teams enforcing project structure standards\n- Research-oriented development (prefers markdown docs)\n\n## Vercel Preview Configuration\n\nThis project is configured to deploy all Turborepo apps on every commit and PR:\n\n- **Web App** (`apps/web`) - Main application\n- **Admin App** (`apps/admin`) - Administration dashboard\n- **Docs App** (`apps/docs`) - Documentation site\n\n**Preview URL Detection:**\n- Vercel bot posts preview URLs as PR comments\n- UI review workflow polls for these URLs (10 minute timeout)\n- Each app gets its own preview URL: `https://[app-name]-[hash].vercel.app`\n\n**E2E Testing:**\n- Playwright tests run against preview URLs in CI\n- Tests are isolated to `@app` and `@web` tags only\n- Screenshots captured during test execution at key moments\n- Claude API reviews screenshots per app and per test\n\n## Worktree Operation Restrictions\n\n**IMPORTANT**: When working in git worktrees, follow these best practices:\n\n### Recommended Settings (Local Development)\n\nAdd to your local `.claude/settings.json` (NOT committed to repo):\n\n```json\n{\n  \"workingDirectoryRestrictions\": {\n    \"enabled\": true,\n    \"allowedPaths\": [\n      \"/home/user/projects/my-repo/.worktrees/claude-*\"\n    ]\n  }\n}\n```\n\n### Why Worktree Safety Matters\n\n- **Isolation**: Each worktree is an independent branch checkout\n- **Context**: Main repo and worktree can have different files\n- **Safety**: Operations outside worktree can affect main repo or other worktrees\n- **Best Practice**: Review all file operations to ensure they target the worktree\n\n### Worktree Context\n\nThe `github-context-sync` plugin automatically:\n- Shows linked GitHub issue for current branch (full content with comments)\n- Displays branch sync status (remote tracking branch and origin/main)\n- Lists outstanding unlinked issues available for work\n- Encourages UI review after ui-developer agent completes\n\n### Manual Verification\n\nAlways verify you're in the correct worktree:\n\n```bash\npwd                    # Check current directory\ngit rev-parse --show-toplevel  # Show worktree root\ngit branch --show-current      # Show current branch\n```\n\n### Automatic Plugin Cache Management\n\nThe `claude-worktree.sh` script automatically manages plugin cache to ensure every worktree uses current plugin code:\n\n1. **Detects enabled plugins** from `.claude/settings.json`\n2. **Cleans up invalid installations** - Removes cached plugins whose source no longer exists\n3. **Refreshes plugin cache** - Uninstalls and reinstalls all plugins from worktree source\n4. **Ensures fresh hooks** - Every worktree session uses current plugin code\n\n**Why this matters:**\n- Plugins are cached globally at `~/.claude/plugins/cache/`\n- Cache is not automatically invalidated when source changes\n- Old cached hooks can cause unexpected behavior (missing new hooks, running removed hooks)\n- Automatic refresh ensures worktree uses fresh plugin code\n\n**Dependencies:**\n- Requires `jq` for parsing JSON: `brew install jq` (macOS) or `apt install jq` (Linux)\n- Without `jq`, manual plugin reinstallation required\n\n**Manual cache refresh:**\n```bash\n# List plugins\nclaude plugin list\n\n# Uninstall and reinstall\nclaude plugin uninstall --scope project plugin-name@constellos\nclaude plugin install --scope project plugin-name@constellos\n```\n\n## UI Development Workflow\n\nThis project includes a comprehensive UI development system with progressive skills and automated review:\n\n### UI Development Skills (Progressive)\n\n1. **ui-wireframing** - Mobile-first ASCII wireframes in `WIREFRAME.md` files\n2. **ui-design** - Contract-first static UI with compound components\n3. **ui-interaction** - Client-side events, local state, validation\n4. **ui-integration** - Server actions, Supabase queries, backend integration\n5. **ai-sdk-ui** - AI-powered features with Vercel AI SDK\n\n### UI Developer Agent\n\nThe `ui-developer` agent (in `nextjs-supabase-ai-sdk-dev` plugin) provides:\n- All 5 UI skills preloaded\n- MCP integration (ai-elements, shadcn, next-devtools)\n- Systematic workflow: wireframe â†’ design â†’ interaction â†’ integration â†’ AI\n- Mobile-first, contract-first, Server Component defaults\n\n**Local Development:**\n- Uses next-devtools MCP for live preview and debugging\n- No Playwright installation needed locally\n- Real-time UI feedback during development\n\n### UI Review System\n\n**Manual Review:**\n- Invoke `ui-reviewer` agent with screenshot paths\n- Provides systematic quality review\n- Identifies critical, major, and minor issues\n\n**Automated CI Review:**\n- GitHub Actions workflow (`ui-review.yml`) runs on commits/PRs\n- Playwright e2e tests for `@app` and `@web` tags\n- Screenshots captured during test execution\n- Claude API reviews each test's screenshots with vision\n- Per-test reviews aggregated into final report\n- Blocks merge if critical issues found\n\n**Review Criteria:**\n- Visual consistency across breakpoints\n- Responsive behavior (mobile, tablet, desktop)\n- Accessibility (color contrast, semantic HTML)\n- Component composition patterns\n- User experience quality\n\n### Technology Stack\n\n- **UI Components**: Shadcn (default), AI Elements, Radix, HTML\n- **Styling**: Tailwind CSS with mobile-first approach\n- **State Management**: Server Components (default), client components when needed\n- **Validation**: Zod schemas (client + server)\n- **Backend**: Supabase with defense-in-depth (RLS + explicit auth checks)\n- **AI Integration**: Vercel AI SDK with streaming UI\n\n## Creating New Plugins\n\n1. Create plugin directory:\n   ```bash\n   mkdir -p plugins/my-plugin/.claude-plugin\n   mkdir -p plugins/my-plugin/hooks\n   ```\n\n2. Create `plugin.json`:\n   ```json\n   {\n     \"name\": \"my-plugin\",\n     \"version\": \"0.1.0\",\n     \"description\": \"My custom plugin\",\n     \"author\": { \"name\": \"your-name\" }\n   }\n   ```\n\n3. Create `hooks/hooks.json`:\n   ```json\n   {\n     \"description\": \"My plugin hooks\",\n     \"hooks\": {\n       \"SessionStart\": [\n         {\n           \"hooks\": [\n             {\n               \"type\": \"command\",\n               \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n             }\n           ]\n         }\n       ]\n     }\n   }\n   ```\n\n4. Create hook file `hooks/my-hook.ts` with proper TSDoc:\n   ```typescript\n   /**\n    * Brief description of what this hook does\n    *\n    * Detailed explanation of the hook's purpose, when it triggers,\n    * and what it accomplishes.\n    *\n    * @module my-hook\n    */\n\n   import type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\n   import { runHook } from '../../../shared/hooks/utils/io.js';\n\n   /**\n    * SessionStart hook handler\n    *\n    * Executes at session start to perform [specific action].\n    *\n    * @param input - SessionStart hook input from Claude Code\n    * @returns Hook output with additional context\n    *\n    * @example\n    * ```typescript\n    * // This hook is automatically called by Claude Code\n    * // when a new session starts\n    * ```\n    */\n   async function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n     return {\n       hookSpecificOutput: {\n         hookEventName: 'SessionStart',\n         additionalContext: 'My hook executed!',\n       },\n     };\n   }\n\n   export { handler };\n   runHook(handler);\n   ```\n\n5. Add to marketplace.json:\n   ```json\n   {\n     \"plugins\": [\n       {\n         \"name\": \"my-plugin\",\n         \"source\": \"./plugins/my-plugin\"\n       }\n     ]\n   }\n   ```\n\n6. Create `README.md` documenting your plugin:\n   ```markdown\n   # My Plugin\n\n   Brief description of what the plugin does.\n\n   ## Overview\n\n   Detailed explanation of the plugin's purpose and capabilities.\n\n   ## Hooks\n\n   ### SessionStart - Hook Name\n\n   **File:** `hooks/my-hook.ts`\n   **Event:** SessionStart\n   **What it does:** Detailed description of hook behavior\n   **Non-blocking:** Yes/No\n\n   ## Installation\n\n   \\```bash\n   claude plugin install my-plugin@constellos\n   \\```\n\n   ## Configuration\n\n   Description of any configuration options.\n\n   ## Debug Logging\n\n   \\```bash\n   DEBUG=my-hook claude\n   \\```\n   ```\n\n## Local Development\n\n### Using Plugins in This Repo\n\nConfiguration in `.claude/settings.json`:\n\n```json\n{\n  \"enabledPlugins\": {\n    \"github-vercel-supabase-ci@constellos\": true,\n    \"github-review-sync@constellos\": true,\n    \"nextjs-supabase-ai-sdk-dev@constellos\": true,\n    \"code-context@constellos\": true,\n    \"markdown-structure-rules@constellos\": true\n  }\n}\n```\n\nNote: The marketplace is automatically registered when you run `claude plugin marketplace add ./` from the project root.\n\n### Installing Plugins\n\nFirst, add the marketplace:\n```bash\nclaude plugin marketplace add ./\n```\n\nThen install the plugins:\n```bash\nclaude plugin install github-vercel-supabase-ci@constellos\nclaude plugin install github-review-sync@constellos\nclaude plugin install nextjs-supabase-ai-sdk-dev@constellos\nclaude plugin install code-context@constellos\nclaude plugin install markdown-structure-rules@constellos\n```\n\n### Testing Changes\n\n1. Edit plugin files in `plugins/` or shared utilities in `shared/`\n2. Exit Claude Code session\n3. Start new session\n4. Changes are automatically loaded\n\n## Testing\n\nRun tests and checks:\n\n```bash\nnpm run typecheck     # TypeScript type checking\nnpm run lint          # ESLint\nnpm run test          # Vitest\nnpm run test:watch    # Vitest watch mode\n```\n\nEnable debug logging for hooks:\n```bash\nDEBUG=* claude              # All debug output\nDEBUG=plugin-name claude    # Specific plugin\n```\n\n## Claude Code Documentation Notes\n\nThe official Claude Code documentation may be out of date or incomplete. When implementing hooks:\n\n- **Test actual behavior** rather than relying solely on docs\n- **Check GitHub issues** for known bugs (e.g., issue #10412 about Stop hooks via plugins)\n- **The `reason` field in Stop hooks is shown to Claude** (tells it what to fix)\n- **The `systemMessage` field is shown to the user** (status info, not visible to Claude)\n- **Use explicit `decision: \"approve\"`** when allowing stop (not just empty `{}`)\n- **Use explicit `decision: \"block\"` with actionable `reason`** when blocking\n\n### Stop Hook Output Best Practices\n\n```typescript\n// When blocking - provide actionable instructions to Claude\nreturn {\n  decision: 'block',\n  reason: 'ESLint errors detected. You MUST fix these before stopping:\\n\\n[errors here]\\n\\nFix each error, then run linter to verify.',\n  systemMessage: 'Claude is blocked from stopping due to ESLint errors.',\n};\n\n// When approving - be explicit\nreturn { decision: 'approve' };\n```\n\n## Troubleshooting\n\n### Hooks Not Firing\n\nIf hooks aren't executing:\n\n1. **Check plugin cache**: Plugins are cached in `~/.claude/plugins/cache/`. Verify the cached `hooks.json` has the correct format with the `\"hooks\"` wrapper.\n\n2. **Verify hooks.json format**: Use the claude-code-guide agent to confirm the correct format:\n   ```bash\n   # In Claude Code session\n   /help hooks.json format\n   ```\n\n   Or research with the claude-code-guide agent:\n   - What is the correct format for hooks.json?\n   - Should hooks be wrapped in a \"hooks\" object?\n\n3. **Reinstall plugins**: If you changed the hooks.json format, reinstall to refresh cache:\n   ```bash\n   claude plugin uninstall --scope project my-plugin@constellos\n   claude plugin install --scope project my-plugin@constellos\n   ```\n\n4. **Restart Claude Code**: Hooks only load when Claude Code starts. After any plugin changes:\n   - Exit current session\n   - Start new session\n   - Verify hooks fire by checking `.claude/logs/hook-events.json`\n\n5. **Validate plugins**: Check for configuration issues:\n   ```bash\n   claude plugin validate plugins/my-plugin\n   claude plugin marketplace list\n   ```\n\n6. **Check marketplace configuration**: In `.claude/settings.json`:\n   ```json\n   {\n     \"extraKnownMarketplaces\": {\n       \"constellos\": {\n         \"source\": {\n           \"source\": \"directory\",\n           \"path\": \"./.claude-plugin\"\n         }\n       }\n     },\n     \"enabledPlugins\": {\n       \"my-plugin@constellos\": true\n     }\n   }\n   ```\n\n7. **Use claude-code-guide for research**: When troubleshooting, always use the claude-code-guide agent for accurate documentation:\n   - Hook event types and lifecycle\n   - Plugin installation and configuration\n   - Debugging techniques\n\n### Plugin Cache Out of Sync\n\n**Symptom:** Hooks behaving differently than expected (old hooks firing, new hooks missing, removed hooks still running)\n\n**Cause:** Plugin cache at `~/.claude/plugins/cache/` contains old versions from before recent changes\n\n**Solution:**\n\n1. **Automatic (recommended):** Use `claude-worktree.sh` which auto-refreshes plugins on every new worktree\n   ```bash\n   bash claude-worktree.sh\n   ```\n\n2. **Manual:** Reinstall plugins to refresh cache:\n   ```bash\n   # Uninstall all constellos plugins\n   claude plugin uninstall --scope project github-context@constellos\n   claude plugin uninstall --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin uninstall --scope project project-context@constellos\n\n   # Reinstall from current source\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n3. **Nuclear option:** Delete entire cache and reinstall:\n   ```bash\n   rm -rf ~/.claude/plugins/cache/constellos\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n**Verification:**\n```bash\n# Check if await-pr-checks hook exists (added in PR #71)\nls ~/.claude/plugins/cache/constellos/github-context/hooks/await-pr-checks.ts\n\n# Verify NO Stop hooks in nextjs-supabase-ai-sdk-dev (removed in PR #71)\ncat ~/.claude/plugins/cache/constellos/nextjs-supabase-ai-sdk-dev/hooks/hooks.json | grep -i \"stop\"\n\n# Compare cached vs source to see differences\ndiff ~/.claude/plugins/cache/constellos/github-context/hooks/hooks.json \\\n     ./plugins/github-context/hooks/hooks.json\n```\n\n### When to Restart Sessions vs Reinstall Plugins\n\nUnderstanding when changes require a session restart vs plugin reinstall helps maintain an efficient development workflow.\n\n**Requires NEW session** (exit and restart Claude Code):\n- Changes to `.claude/settings.json`:\n  - Modifying `enabledPlugins`\n  - Adding/removing `extraKnownMarketplaces`\n  - Changing marketplace paths or configuration\n- Adding new plugins to marketplace\n- Removing plugins from marketplace\n- Changes to `.claude-plugin/marketplace.json`\n\n**Requires plugin REINSTALL** (no session restart needed):\n- Changes to `hooks/hooks.json` (hook configuration)\n- Changes to `.claude-plugin/plugin.json` (plugin metadata)\n- Changes to hook implementation files (`.ts` files)\n- Changes to shared utilities in `shared/` folder\n- Bug fixes or improvements to existing hooks\n\n**Reinstall command:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**Or use the quick reinstall pattern:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos 2>/dev/null || true && \\\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**No restart or reinstall needed:**\n- Documentation changes (README.md, CLAUDE.md)\n- Comment updates in code\n- Test file changes\n- Non-hook TypeScript files\n\n**Why this matters:**\n- Plugin files are copied to `~/.claude/plugins/cache/` during installation\n- Claude Code loads plugin configuration only at session start\n- Reinstalling updates the cache without requiring a full session restart\n- This allows rapid iteration during plugin development\n\n**Development workflow:**\n1. Make changes to hook implementation\n2. Reinstall the plugin to update cache\n3. Test the changes in current session\n4. Repeat until working correctly\n\n**Only restart session when:**\n- You've made changes to `.claude/settings.json`\n- You've added/removed plugins from the marketplace\n- Reinstalling doesn't seem to apply your changes\n\n## Key Architecture Decisions\n\n### Self-Executable Hooks\n\nEach hook is a standalone TypeScript file that:\n- Uses the `runHook` wrapper for stdin/stdout handling\n- Can be executed directly with `npx tsx`\n- Exports a named `handler` function for testing\n- No separate runner script needed\n\n### Shared Utilities Pattern\n\nAll plugins import from `shared/` rather than duplicating code:\n- Consistent typing across all hooks\n- Shared I/O, debug, and transcript utilities\n- Easy updates to all plugins\n\n### Type Safety\n\nFull TypeScript typing for all hook events in `shared/types/types.ts`:\n- Input types for each hook event\n- Output types with proper constraints\n- Handler function type helpers\n\n### Automatic Hook Logging and Error Handling\n\n**All hooks automatically log to `.claude/logs/hook-events.json`** via the `runHook` wrapper in `shared/hooks/utils/io.ts`. Hook developers don't need to write ANY logging code.\n\n**How it works:**\n1. `runHook(handler)` wraps your hook handler function\n2. Reads input from stdin and creates a debug logger\n3. **Automatically logs input** before executing handler (if debug enabled)\n4. Executes your handler function\n5. **Automatically logs output** after handler completes (if debug enabled)\n6. **Automatically logs errors** if handler throws (if debug enabled)\n7. **ALWAYS returns blocking error response** if handler throws (regardless of debug mode)\n8. Writes output to stdout for Claude Code\n\n**What gets logged:**\n- **Input logs**: Complete hook input including tool names, parameters, session context\n- **Output logs**: Hook return values, additional context, permission decisions\n- **Error logs**: Exception details, stack traces, error messages\n\n**Error Handling Behavior:**\n- **ALL hook errors block execution** - No silent failures\n- **Module resolution errors** (missing imports) block immediately\n- **Runtime errors** (uncaught exceptions) block immediately\n- **Type errors** and other exceptions block immediately\n- Debug flag controls **logging verbosity only**, NOT blocking behavior\n\n**When logging is enabled:**\n- Debug mode is controlled by `input.debug === true` passed from Claude Code\n- Logging is always active when Claude Code runs hooks\n- No environment variables or configuration needed\n\n**Log file format:**\n- Location: `.claude/logs/hook-events.json`\n- Format: JSONL (one JSON object per line)\n- Structure: `{ timestamp, event, type, data }`\n\n**Pattern all hooks follow:**\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Business logic only - NO manual logging needed!\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export for testing\nexport { handler };\n\n// This provides automatic logging AND error handling!\nrunHook(handler);\n```\n\n**Key principle:** Hook handlers should contain ONLY business logic. The `runHook` wrapper handles all logging, error handling, and stdin/stdout communication automatically. All errors are converted to blocking responses to ensure broken hooks cannot fail silently.\n\n### TSDoc Documentation Standards\n\nAll TypeScript files in this project follow TSDoc 2025 best practices:\n\n**Required elements:**\n- **@module** tag at the top of each file describing its purpose\n- **Multi-line format** for all public exports\n- **@param** tags for all parameters with descriptions\n- **@returns** tags describing return values\n- **@throws** tags documenting error conditions\n- **@example** blocks showing realistic usage\n\n**Pattern:**\n```typescript\n/**\n * Brief description of what the function does\n *\n * More detailed explanation of behavior, use cases, and important notes.\n *\n * @param paramName - Description of parameter purpose\n * @returns Description of return value and what it represents\n * @throws Error description - when and why it throws\n *\n * @example\n * ```typescript\n * import { functionName } from './module.js';\n * const result = await functionName('example-input');\n * ```\n */\n```\n\n**References:**\n- TSDoc standard: https://tsdoc.org/\n- TypeScript documentation: https://www.typescriptlang.org/docs/\n\nAll hooks and utilities in this project have comprehensive TSDoc documentation for:\n- Clear understanding of purpose and behavior\n- Type-safe usage with IDE support\n- Maintainability and onboarding\n- Automated documentation generation\n\n## Documentation Best Practices\n\nWhen developing agents, skills, commands, and rules for this project, follow these documentation standards:\n\n### Link to Official Documentation\n\n**Always link to official documentation and best practices** when creating or modifying:\n- Agents\n- Skills\n- Commands\n- Rules\n\n### Prefer Markdown Versions of Documentation\n\nWhen linking to documentation, **prefer `.md` file URLs** over HTML pages whenever available:\n\n**Examples of markdown-friendly documentation:**\n\n- **Claude Code**: https://github.com/anthropics/claude-code/tree/main/docs\n- **Next.js**: https://github.com/vercel/next.js/tree/canary/docs\n- **Vercel**: https://vercel.com/docs (provides markdown-friendly content)\n- **Supabase**: https://github.com/supabase/supabase/tree/master/apps/docs\n\n**Why markdown versions?**\n- More AI-friendly to read and parse\n- Better for offline access\n- Easier to diff and track changes\n- Direct access to source content\n\n### Research Before Implementation\n\nBefore implementing or modifying agents, skills, commands, or rules:\n\n1. **Search for official documentation** - Find the authoritative source\n2. **Search for best practices** - Look for recommended patterns and approaches\n3. **Link explicitly in markdown files** - Include references to official docs in:\n   - Agent `## Agent-scoped project context` sections\n   - Skill `## Skill-scoped context` sections\n   - Rule files under appropriate headings\n   - Command documentation\n\n**Example (Agent):**\n\n```markdown\n## Agent-scoped project context\n\n- Uses Next.js App Router (https://raw.githubusercontent.com/vercel/next.js/canary/docs/app/building-your-application/routing.md)\n- Follows Vercel deployment best practices (https://vercel.com/docs/deployments)\n- TypeScript strict mode enabled (https://www.typescriptlang.org/tsconfig#strict)\n```\n\n**Example (Skill):**\n\n```markdown\n## Skill-scoped context\n\n- Supabase database migrations (https://raw.githubusercontent.com/supabase/supabase/master/apps/docs/content/guides/database/migrations.mdx)\n- Migration best practices: always test locally before production\n- Use meaningful migration names with timestamps\n```\n\n**Example (Rule):**\n\n```markdown\n## Rules\n\n1. Follow TypeScript strict mode guidelines (https://www.typescriptlang.org/tsconfig#strict)\n2. Use Next.js App Router patterns (https://github.com/vercel/next.js/tree/canary/docs/app)\n3. Follow React Server Components best practices (https://github.com/reactwg/server-components/discussions)\n```\n\n### Informing vs. Linking\n\n- **Link to official docs** - These are the authoritative references for tools and frameworks\n- **Use best practices to inform** - Best practices guide how you structure agents, skills, commands, and rules\n- **Keep docs fresh** - Update links when major version changes occur\n\n## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment\n","structuredPatch":[{"oldStart":1031,"oldLines":11,"newStart":1031,"newLines":8,"lines":[" "," ## Documentation"," ","-Comprehensive Claude Code documentation in `.claude/skills/`:","-","-- `claude-plugins/SKILL.md` - Plugin development guide","-- `claude-hooks/SKILL.md` - Hook types and patterns","-- `claude-skills/SKILL.md` - Agent Skills","-- `claude-commands/SKILL.md` - Slash commands","-- `claude-agents/SKILL.md` - Subagent configuration","-- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","+For Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:","+- Plugin structure and development","+- Hook types and patterns","+- Agent, skill, and command creation","+- MCP integration"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:38.004Z","event":"create-plan-symlink","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:38.007Z","event":"create-plan-symlink","type":"output","data":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","absolutePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md"}}
{"timestamp":"2026-01-01T03:56:38.012Z","event":"create-plan-symlink","type":"output","data":{"action":"skip","reason":"Not a plan file"}}
{"timestamp":"2026-01-01T03:56:38.014Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse"}}}
{"timestamp":"2026-01-01T03:56:38.041Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","old_string":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","new_string":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","oldString":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","newString":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration","originalFile":"---\ntitle: Claude Code Plugins Marketplace\ndescription: A marketplace of Claude Code plugins with shared TypeScript utilities and typed hooks for development workflows\nfolder:\n  subfolders:\n    allowed: [.claude, .claude-plugin, .github, docs, plugins, shared]\n    required: [.claude-plugin, plugins, shared]\n  files:\n    allowed: [CLAUDE.md, LICENSE, package.json, package-lock.json, tsconfig.json, vitest.config.ts, eslint.config.mjs, .gitignore, .attw.json, README.md]\n    required: [CLAUDE.md, package.json]\n---\n\n# Claude Code Plugins\n\n## What This Is\n\nA marketplace of Claude Code plugins with shared TypeScript utilities. This is NOT an npm package - it's a collection of plugins that extend Claude Code with typed hooks for development workflows.\n\n## Architecture\n\n```\n.\nâ”œâ”€â”€ .claude-plugin/\nâ”‚   â””â”€â”€ marketplace.json        # Marketplace definition\nâ”‚\nâ”œâ”€â”€ shared/                     # Shared utilities imported by all plugins\nâ”‚   â”œâ”€â”€ types/\nâ”‚   â”‚   â””â”€â”€ types.ts           # Hook type definitions\nâ”‚   â”œâ”€â”€ hooks/\nâ”‚   â”‚   â”œâ”€â”€ utils/             # Hook utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ io.ts          # stdin/stdout + runHook wrapper\nâ”‚   â”‚   â”‚   â”œâ”€â”€ debug.ts       # Debug logging\nâ”‚   â”‚   â”‚   â”œâ”€â”€ transcripts.ts # Transcript parsing\nâ”‚   â”‚   â”‚   â”œâ”€â”€ subagent-state.ts # Subagent context management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ task-state.ts  # Task state management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ package-manager.ts # Package manager detection\nâ”‚   â”‚   â”‚   â”œâ”€â”€ toml.ts        # TOML parser\nâ”‚   â”‚   â”‚   â”œâ”€â”€ was-tool-event-main-agent.ts # Agent detection\nâ”‚   â”‚   â”‚   â””â”€â”€ index.ts       # Exports all utilities\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-start.ts  # SubagentStart hook\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-stop.ts   # SubagentStop hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-call.ts       # PreToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-result.ts     # PostToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ enforce-structured-markdown.ts  # PreToolUse hook for markdown validation\nâ”‚   â”‚   â”œâ”€â”€ enforce-output-style-tools.ts   # PreToolUse hook for tool enforcement\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-write.ts  # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-mkdir.ts  # PreToolUse[Bash] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-rules-file.ts          # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â””â”€â”€ run-rule-checks.ts              # PostToolUse hook for rule checks\nâ”‚   â””â”€â”€ rules/                  # Claude rules documentation (*.md files)\nâ”‚       â””â”€â”€ CLAUDE.md          # Rules folder documentation\nâ”‚\nâ””â”€â”€ plugins/                    # Individual marketplace plugins\n    â”œâ”€â”€ github-context/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-github.ts           # SessionStart: install GitHub CLI\n    â”‚       â”œâ”€â”€ add-github-context.ts       # SessionStart: branch context & issues\n    â”‚       â”œâ”€â”€ sync-plan-to-issue.ts       # PostToolUse[Write|Edit]: plan sync\n    â”‚       â”œâ”€â”€ enhance-commit-context.ts   # PostToolUse[Bash]: commit enhancement\n    â”‚       â”œâ”€â”€ commit-task.ts              # SubagentStop: auto-commit agent work\n    â”‚       â””â”€â”€ commit-session-check-pr-status.ts  # Stop: session commit & PR checks\n    â”‚\n    â”œâ”€â”€ nextjs-supabase-ai-sdk-dev/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-vercel.ts           # SessionStart: install Vercel CLI\n    â”‚       â”œâ”€â”€ install-supabase.ts         # SessionStart: install Supabase CLI\n    â”‚       â”œâ”€â”€ check-file-eslint.ts        # PostToolUse[Write|Edit]: ESLint on file\n    â”‚       â”œâ”€â”€ check-file-types.ts         # PostToolUse[Write|Edit]: TypeScript on file\n    â”‚       â”œâ”€â”€ check-file-tsdoc.ts         # PostToolUse[Write|Edit]: TSDoc validation\n    â”‚       â”œâ”€â”€ check-file-vitest-results.ts # PostToolUse[Write|Edit]: Vitest on test files\n    â”‚       â”œâ”€â”€ encourage-ui-review.ts      # PostToolUse[Task]: encourage ui-reviewer\n    â”‚       â”œâ”€â”€ check-global-eslint.ts      # Stop: ESLint on all (blocking)\n    â”‚       â”œâ”€â”€ check-global-types.ts       # Stop: TypeScript on all (blocking)\n    â”‚       â””â”€â”€ check-global-vitest-results.ts # Stop: Vitest on all (blocking)\n    â”‚\n    â””â”€â”€ project-context/\n        â”œâ”€â”€ .claude-plugin/plugin.json\n        â””â”€â”€ hooks/\n            â”œâ”€â”€ hooks.json\n            â”œâ”€â”€ encourage-context-review.ts  # UserPromptSubmit: context updates\n            â”œâ”€â”€ add-folder-context.ts        # PostToolUse[Read]: CLAUDE.md discovery\n            â”œâ”€â”€ create-plan-symlink.ts       # PostToolUse[Write|Edit]: PLAN.md symlink\n            â”œâ”€â”€ try-markdown-page.ts         # PreToolUse[WebFetch]: prefer .md URLs\n            â””â”€â”€ shared/                      # Uses shared validation hooks\n                â”œâ”€â”€ log-task-call.ts         # PreToolUse[Task]: save task context\n                â”œâ”€â”€ log-task-result.ts       # PostToolUse[Task]: log task results\n                â”œâ”€â”€ validate-folder-structure-write.ts   # PreToolUse[Write|Edit]\n                â”œâ”€â”€ validate-folder-structure-mkdir.ts   # PreToolUse[Bash]\n                â”œâ”€â”€ validate-rules-file.ts               # PreToolUse[Write|Edit]\n                â””â”€â”€ enforce-plan-scoping.ts              # PostToolUse[Write|Edit|Read]\n```\n\n## Self-Executable Hooks with tsx\n\nAll hooks are self-executable TypeScript files that can be run directly with `npx tsx`. Each hook:\n1. Imports the `runHook` wrapper from `shared/hooks/utils/io.ts`\n2. Defines a `handler` function with typed input/output\n3. Calls `runHook(handler)` at the end of the file\n\n### Hook Pattern\n\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Hook implementation\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export handler for testing\nexport { handler };\n\n// Make this file self-executable with tsx\nrunHook(handler);\n```\n\n### hooks.json Configuration\n\n**IMPORTANT**: The official Claude Code repository and its plugins should serve as the canonical example:\n- Repository: https://github.com/anthropics/claude-code\n- Marketplace: https://raw.githubusercontent.com/anthropics/claude-code/main/.claude-plugin/marketplace.json\n- Example plugins: https://github.com/anthropics/claude-code/tree/main/plugins\n\nHooks must be wrapped in a `\"hooks\"` object:\n\n```json\n{\n  \"description\": \"My plugin description\",\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nVariables provided by Claude Code:\n- `${CLAUDE_PROJECT_DIR}` - Root of the Claude Code project\n- `${CLAUDE_PLUGIN_ROOT}` - Root of the specific plugin being executed\n\n## Shared Folder (`shared/`)\n\n### Types (`shared/types/types.ts`)\n\nFull TypeScript typing for all Claude Code hook events:\n\n```typescript\nimport type {\n  SessionStartInput,\n  SessionStartHookOutput,\n  PostToolUseInput,\n  PostToolUseHookOutput,\n  // ... all hook types\n} from '../../../shared/types/types.js';\n```\n\n### Hook Utilities (`shared/hooks/utils/`)\n\n- **io.ts** - stdin/stdout JSON handling and `runHook` wrapper\n- **debug.ts** - Debug logging with JSONL output to `.claude/logs/hook-events.json`\n- **transcripts.ts** - Parse Claude transcript JSONL files\n- **subagent-state.ts** - Save/load/analyze subagent context and edits\n- **task-state.ts** - Task state management for PreToolUse[Task] â†’ SubagentStop flow\n- **package-manager.ts** - Detect npm/yarn/pnpm/bun from lockfiles\n- **toml.ts** - Simple TOML parser for config files\n- **was-tool-event-main-agent.ts** - Detect if tool event is from main agent or subagent\n- **index.ts** - Re-exports all utilities\n\n### Shared Hooks (`shared/hooks/`)\n\n**Logging and State Management:**\n- **log-subagent-start.ts** - SubagentStart hook that saves agent context\n- **log-subagent-stop.ts** - SubagentStop hook that logs agent file operations\n- **log-task-call.ts** - PreToolUse[Task] hook that saves task call metadata\n- **log-task-result.ts** - PostToolUse[Task] hook that logs task results\n\n**Validation and Enforcement:**\n- **enforce-structured-markdown.ts** - PreToolUse[Write|Edit] hook for comprehensive markdown validation (agents, skills, rules, CLAUDE.md)\n- **enforce-output-style-tools.ts** - PreToolUse hook for output style tool enforcement\n- **validate-folder-structure-write.ts** - PreToolUse[Write|Edit] hook for .claude directory structure validation\n- **validate-folder-structure-mkdir.ts** - PreToolUse[Bash] hook for mkdir command validation\n- **validate-rules-file.ts** - PreToolUse[Write|Edit] hook for rule file structure validation\n\n**Custom Checks:**\n- **run-rule-checks.ts** - PostToolUse[Write|Edit] hook for running custom checks from rule frontmatter\n\n## Available Plugins\n\n### github-context\n\nGitHub integration with branch context, commit enhancement, plan synchronization, and CI orchestration.\n\n**Purpose:**\nProvides comprehensive GitHub integration including CLI installation, branch/issue context discovery, automatic commit enhancement with task metadata, plan-to-issue synchronization, and PR status monitoring.\n\n**Hooks:**\n- **SessionStart** (`install-github.ts`) - Installs GitHub CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`add-github-context.ts`) - Displays linked GitHub issue for current branch, branch sync status, and outstanding issues (non-blocking)\n- **PostToolUse[Write|Edit]** (`sync-plan-to-issue.ts`) - Automatically creates or updates GitHub issues from plan files (non-blocking)\n- **PostToolUse[Bash]** (`enhance-commit-context.ts`) - Enhances git commits with task context and issue references for both main agent and subagents (non-blocking)\n- **SubagentStop** (`commit-task.ts`) - Auto-commits subagent work with task context and git trailers (non-blocking)\n- **Stop** (`commit-session-check-pr-status.ts`) - Auto-commits session changes, checks PR status, and reports CI/preview URLs with progressive blocking\n\n**Key Features:**\n- **Branch Context Discovery:** Shows full GitHub issue content (title, body, comments) linked to current branch\n- **Sync Status:** Displays branch status relative to remote tracking branch and origin/main\n- **Outstanding Issues:** Lists open issues not linked to any branch, available for work\n- **Auto-commit:** Automatically commits subagent work with rich task context\n- **Plan Synchronization:** Creates/updates GitHub issues from plan files automatically\n- **Commit Enhancement:** Enriches commits with task and issue metadata\n- **PR Status Monitoring:** Checks PR status at session end with CI and preview URL reporting\n\n**Use Cases:**\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n- Multi-agent workflows with automatic commit documentation\n\n### nextjs-supabase-ai-sdk-dev\n\nDevelopment quality enforcement for Next.js, Supabase, and AI SDK projects with comprehensive linting, type checking, testing, and CLI installation.\n\n**Purpose:**\nEnsures code quality through automated checks at both file and project levels. Installs Vercel and Supabase CLIs on remote environments, runs per-file quality checks on edits, and performs comprehensive project-wide validation at session end.\n\n**Hooks:**\n- **SessionStart** (`install-vercel.ts`) - Installs Vercel CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`install-supabase.ts`) - Installs Supabase CLI on remote environments, warns if missing locally (non-blocking)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls and saves context for SubagentStop hooks (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after agent completion (non-blocking)\n- **PostToolUse[Task]** (`encourage-ui-review.ts`) - Encourages ui-reviewer agent after ui-developer completes (non-blocking)\n- **PostToolUse[Write|Edit]** (`check-file-eslint.ts`) - Runs ESLint on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-types.ts`) - Runs TypeScript type checking on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-tsdoc.ts`) - Validates TSDoc documentation on TypeScript files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit test files]** (`check-file-vitest-results.ts`) - Runs Vitest on test files after edits (non-blocking, informational)\n- **Stop** (`check-global-eslint.ts`) - Runs ESLint on entire project at session end (blocking)\n- **Stop** (`check-global-types.ts`) - Runs TypeScript type checking on entire project at session end (blocking)\n- **Stop** (`check-global-vitest-results.ts`) - Runs full Vitest test suite at session end (blocking)\n\n**Key Features:**\n- **CLI Installation:** Automatic installation of Vercel and Supabase CLIs on remote environments\n- **Per-File Checks:** Immediate feedback on ESLint, TypeScript, and TSDoc issues after each file edit\n- **Test Execution:** Automatic test running when test files are modified\n- **Project-Wide Validation:** Comprehensive checks at session end ensure no issues slip through\n- **Blocking Stop Hooks:** Prevents ending session with linting errors, type errors, or failing tests\n- **Task Tracking:** Logs all Task tool calls for context in SubagentStop hooks\n- **UI Review Encouragement:** Prompts for visual review after UI development work\n\n**Use Cases:**\n- Next.js application development\n- TypeScript projects requiring strict type safety\n- Projects with comprehensive test suites\n- Teams enforcing code quality standards\n- CI/CD workflows requiring pre-push validation\n\n### project-context\n\nEnhanced context discovery, folder structure validation, and project guidance for Claude Code workflows.\n\n**Purpose:**\nAutomatically discovers and links CLAUDE.md documentation, validates project structure for .claude directories, enforces plan scoping, and encourages context updates based on user prompts. Provides intelligent URL redirection to prefer markdown documentation.\n\n**Hooks:**\n- **UserPromptSubmit** (`encourage-context-review.ts`) - Encourages updating plans, agents, skills, and CLAUDE.md files based on user prompts (non-blocking, informational)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls before execution and saves context (non-blocking)\n- **PreToolUse[Write|Edit]** (shared `validate-folder-structure-write.ts`) - Validates folder structure when creating .claude files (blocking on structure violations)\n- **PreToolUse[Write|Edit]** (shared `validate-rules-file.ts`) - Validates rule file structure and Required Skills frontmatter (blocking on validation errors)\n- **PreToolUse[Bash]** (shared `validate-folder-structure-mkdir.ts`) - Validates mkdir commands for .claude directories (blocking on invalid paths)\n- **PreToolUse[WebFetch]** (`try-markdown-page.ts`) - Redirects WebFetch to markdown versions of documentation when available (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after completion (non-blocking)\n- **PostToolUse[Write|Edit]** (`create-plan-symlink.ts`) - Creates PLAN.md symlink when plan files are written (non-blocking)\n- **PostToolUse[Write|Edit]** (shared `enforce-plan-scoping.ts`) - Enforces plan-based path scoping for write/edit operations (can block on scope violations)\n- **PostToolUse[Read]** (`add-folder-context.ts`) - Discovers and adds CLAUDE.md context when reading files (non-blocking)\n- **PostToolUse[Read]** (shared `enforce-plan-scoping.ts`) - Warns when reads are outside plan scope (non-blocking, guidance only)\n\n**Key Features:**\n- **Automatic Context Discovery:** Finds and links CLAUDE.md files when reading project files\n- **Folder Structure Validation:** Ensures .claude directories follow proper organization standards\n- **Plan Scoping:** Enforces staying within plan boundaries for file operations\n- **Rules Validation:** Ensures rule files have proper structure and Required Skills metadata\n- **Context Encouragement:** Prompts to update documentation based on user activity\n- **Markdown Preference:** Automatically redirects to .md versions of documentation URLs\n- **Plan Symlinks:** Maintains PLAN.md link to active plan file\n- **Task Tracking:** Comprehensive logging of agent invocations and results\n\n**Use Cases:**\n- Large codebases requiring organized documentation\n- Projects with .claude directory structures (agents, skills, rules, hooks)\n- Plan-driven development workflows\n- Documentation-heavy projects\n- Teams enforcing project structure standards\n- Research-oriented development (prefers markdown docs)\n\n## Vercel Preview Configuration\n\nThis project is configured to deploy all Turborepo apps on every commit and PR:\n\n- **Web App** (`apps/web`) - Main application\n- **Admin App** (`apps/admin`) - Administration dashboard\n- **Docs App** (`apps/docs`) - Documentation site\n\n**Preview URL Detection:**\n- Vercel bot posts preview URLs as PR comments\n- UI review workflow polls for these URLs (10 minute timeout)\n- Each app gets its own preview URL: `https://[app-name]-[hash].vercel.app`\n\n**E2E Testing:**\n- Playwright tests run against preview URLs in CI\n- Tests are isolated to `@app` and `@web` tags only\n- Screenshots captured during test execution at key moments\n- Claude API reviews screenshots per app and per test\n\n## Worktree Operation Restrictions\n\n**IMPORTANT**: When working in git worktrees, follow these best practices:\n\n### Recommended Settings (Local Development)\n\nAdd to your local `.claude/settings.json` (NOT committed to repo):\n\n```json\n{\n  \"workingDirectoryRestrictions\": {\n    \"enabled\": true,\n    \"allowedPaths\": [\n      \"/home/user/projects/my-repo/.worktrees/claude-*\"\n    ]\n  }\n}\n```\n\n### Why Worktree Safety Matters\n\n- **Isolation**: Each worktree is an independent branch checkout\n- **Context**: Main repo and worktree can have different files\n- **Safety**: Operations outside worktree can affect main repo or other worktrees\n- **Best Practice**: Review all file operations to ensure they target the worktree\n\n### Worktree Context\n\nThe `github-context-sync` plugin automatically:\n- Shows linked GitHub issue for current branch (full content with comments)\n- Displays branch sync status (remote tracking branch and origin/main)\n- Lists outstanding unlinked issues available for work\n- Encourages UI review after ui-developer agent completes\n\n### Manual Verification\n\nAlways verify you're in the correct worktree:\n\n```bash\npwd                    # Check current directory\ngit rev-parse --show-toplevel  # Show worktree root\ngit branch --show-current      # Show current branch\n```\n\n### Automatic Plugin Cache Management\n\nThe `claude-worktree.sh` script automatically manages plugin cache to ensure every worktree uses current plugin code:\n\n1. **Detects enabled plugins** from `.claude/settings.json`\n2. **Cleans up invalid installations** - Removes cached plugins whose source no longer exists\n3. **Refreshes plugin cache** - Uninstalls and reinstalls all plugins from worktree source\n4. **Ensures fresh hooks** - Every worktree session uses current plugin code\n\n**Why this matters:**\n- Plugins are cached globally at `~/.claude/plugins/cache/`\n- Cache is not automatically invalidated when source changes\n- Old cached hooks can cause unexpected behavior (missing new hooks, running removed hooks)\n- Automatic refresh ensures worktree uses fresh plugin code\n\n**Dependencies:**\n- Requires `jq` for parsing JSON: `brew install jq` (macOS) or `apt install jq` (Linux)\n- Without `jq`, manual plugin reinstallation required\n\n**Manual cache refresh:**\n```bash\n# List plugins\nclaude plugin list\n\n# Uninstall and reinstall\nclaude plugin uninstall --scope project plugin-name@constellos\nclaude plugin install --scope project plugin-name@constellos\n```\n\n## UI Development Workflow\n\nThis project includes a comprehensive UI development system with progressive skills and automated review:\n\n### UI Development Skills (Progressive)\n\n1. **ui-wireframing** - Mobile-first ASCII wireframes in `WIREFRAME.md` files\n2. **ui-design** - Contract-first static UI with compound components\n3. **ui-interaction** - Client-side events, local state, validation\n4. **ui-integration** - Server actions, Supabase queries, backend integration\n5. **ai-sdk-ui** - AI-powered features with Vercel AI SDK\n\n### UI Developer Agent\n\nThe `ui-developer` agent (in `nextjs-supabase-ai-sdk-dev` plugin) provides:\n- All 5 UI skills preloaded\n- MCP integration (ai-elements, shadcn, next-devtools)\n- Systematic workflow: wireframe â†’ design â†’ interaction â†’ integration â†’ AI\n- Mobile-first, contract-first, Server Component defaults\n\n**Local Development:**\n- Uses next-devtools MCP for live preview and debugging\n- No Playwright installation needed locally\n- Real-time UI feedback during development\n\n### UI Review System\n\n**Manual Review:**\n- Invoke `ui-reviewer` agent with screenshot paths\n- Provides systematic quality review\n- Identifies critical, major, and minor issues\n\n**Automated CI Review:**\n- GitHub Actions workflow (`ui-review.yml`) runs on commits/PRs\n- Playwright e2e tests for `@app` and `@web` tags\n- Screenshots captured during test execution\n- Claude API reviews each test's screenshots with vision\n- Per-test reviews aggregated into final report\n- Blocks merge if critical issues found\n\n**Review Criteria:**\n- Visual consistency across breakpoints\n- Responsive behavior (mobile, tablet, desktop)\n- Accessibility (color contrast, semantic HTML)\n- Component composition patterns\n- User experience quality\n\n### Technology Stack\n\n- **UI Components**: Shadcn (default), AI Elements, Radix, HTML\n- **Styling**: Tailwind CSS with mobile-first approach\n- **State Management**: Server Components (default), client components when needed\n- **Validation**: Zod schemas (client + server)\n- **Backend**: Supabase with defense-in-depth (RLS + explicit auth checks)\n- **AI Integration**: Vercel AI SDK with streaming UI\n\n## Creating New Plugins\n\n1. Create plugin directory:\n   ```bash\n   mkdir -p plugins/my-plugin/.claude-plugin\n   mkdir -p plugins/my-plugin/hooks\n   ```\n\n2. Create `plugin.json`:\n   ```json\n   {\n     \"name\": \"my-plugin\",\n     \"version\": \"0.1.0\",\n     \"description\": \"My custom plugin\",\n     \"author\": { \"name\": \"your-name\" }\n   }\n   ```\n\n3. Create `hooks/hooks.json`:\n   ```json\n   {\n     \"description\": \"My plugin hooks\",\n     \"hooks\": {\n       \"SessionStart\": [\n         {\n           \"hooks\": [\n             {\n               \"type\": \"command\",\n               \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n             }\n           ]\n         }\n       ]\n     }\n   }\n   ```\n\n4. Create hook file `hooks/my-hook.ts` with proper TSDoc:\n   ```typescript\n   /**\n    * Brief description of what this hook does\n    *\n    * Detailed explanation of the hook's purpose, when it triggers,\n    * and what it accomplishes.\n    *\n    * @module my-hook\n    */\n\n   import type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\n   import { runHook } from '../../../shared/hooks/utils/io.js';\n\n   /**\n    * SessionStart hook handler\n    *\n    * Executes at session start to perform [specific action].\n    *\n    * @param input - SessionStart hook input from Claude Code\n    * @returns Hook output with additional context\n    *\n    * @example\n    * ```typescript\n    * // This hook is automatically called by Claude Code\n    * // when a new session starts\n    * ```\n    */\n   async function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n     return {\n       hookSpecificOutput: {\n         hookEventName: 'SessionStart',\n         additionalContext: 'My hook executed!',\n       },\n     };\n   }\n\n   export { handler };\n   runHook(handler);\n   ```\n\n5. Add to marketplace.json:\n   ```json\n   {\n     \"plugins\": [\n       {\n         \"name\": \"my-plugin\",\n         \"source\": \"./plugins/my-plugin\"\n       }\n     ]\n   }\n   ```\n\n6. Create `README.md` documenting your plugin:\n   ```markdown\n   # My Plugin\n\n   Brief description of what the plugin does.\n\n   ## Overview\n\n   Detailed explanation of the plugin's purpose and capabilities.\n\n   ## Hooks\n\n   ### SessionStart - Hook Name\n\n   **File:** `hooks/my-hook.ts`\n   **Event:** SessionStart\n   **What it does:** Detailed description of hook behavior\n   **Non-blocking:** Yes/No\n\n   ## Installation\n\n   \\```bash\n   claude plugin install my-plugin@constellos\n   \\```\n\n   ## Configuration\n\n   Description of any configuration options.\n\n   ## Debug Logging\n\n   \\```bash\n   DEBUG=my-hook claude\n   \\```\n   ```\n\n## Local Development\n\n### Using Plugins in This Repo\n\nConfiguration in `.claude/settings.json`:\n\n```json\n{\n  \"enabledPlugins\": {\n    \"github-vercel-supabase-ci@constellos\": true,\n    \"github-review-sync@constellos\": true,\n    \"nextjs-supabase-ai-sdk-dev@constellos\": true,\n    \"code-context@constellos\": true,\n    \"markdown-structure-rules@constellos\": true\n  }\n}\n```\n\nNote: The marketplace is automatically registered when you run `claude plugin marketplace add ./` from the project root.\n\n### Installing Plugins\n\nFirst, add the marketplace:\n```bash\nclaude plugin marketplace add ./\n```\n\nThen install the plugins:\n```bash\nclaude plugin install github-vercel-supabase-ci@constellos\nclaude plugin install github-review-sync@constellos\nclaude plugin install nextjs-supabase-ai-sdk-dev@constellos\nclaude plugin install code-context@constellos\nclaude plugin install markdown-structure-rules@constellos\n```\n\n### Testing Changes\n\n1. Edit plugin files in `plugins/` or shared utilities in `shared/`\n2. Exit Claude Code session\n3. Start new session\n4. Changes are automatically loaded\n\n## Testing\n\nRun tests and checks:\n\n```bash\nnpm run typecheck     # TypeScript type checking\nnpm run lint          # ESLint\nnpm run test          # Vitest\nnpm run test:watch    # Vitest watch mode\n```\n\nEnable debug logging for hooks:\n```bash\nDEBUG=* claude              # All debug output\nDEBUG=plugin-name claude    # Specific plugin\n```\n\n## Claude Code Documentation Notes\n\nThe official Claude Code documentation may be out of date or incomplete. When implementing hooks:\n\n- **Test actual behavior** rather than relying solely on docs\n- **Check GitHub issues** for known bugs (e.g., issue #10412 about Stop hooks via plugins)\n- **The `reason` field in Stop hooks is shown to Claude** (tells it what to fix)\n- **The `systemMessage` field is shown to the user** (status info, not visible to Claude)\n- **Use explicit `decision: \"approve\"`** when allowing stop (not just empty `{}`)\n- **Use explicit `decision: \"block\"` with actionable `reason`** when blocking\n\n### Stop Hook Output Best Practices\n\n```typescript\n// When blocking - provide actionable instructions to Claude\nreturn {\n  decision: 'block',\n  reason: 'ESLint errors detected. You MUST fix these before stopping:\\n\\n[errors here]\\n\\nFix each error, then run linter to verify.',\n  systemMessage: 'Claude is blocked from stopping due to ESLint errors.',\n};\n\n// When approving - be explicit\nreturn { decision: 'approve' };\n```\n\n## Troubleshooting\n\n### Hooks Not Firing\n\nIf hooks aren't executing:\n\n1. **Check plugin cache**: Plugins are cached in `~/.claude/plugins/cache/`. Verify the cached `hooks.json` has the correct format with the `\"hooks\"` wrapper.\n\n2. **Verify hooks.json format**: Use the claude-code-guide agent to confirm the correct format:\n   ```bash\n   # In Claude Code session\n   /help hooks.json format\n   ```\n\n   Or research with the claude-code-guide agent:\n   - What is the correct format for hooks.json?\n   - Should hooks be wrapped in a \"hooks\" object?\n\n3. **Reinstall plugins**: If you changed the hooks.json format, reinstall to refresh cache:\n   ```bash\n   claude plugin uninstall --scope project my-plugin@constellos\n   claude plugin install --scope project my-plugin@constellos\n   ```\n\n4. **Restart Claude Code**: Hooks only load when Claude Code starts. After any plugin changes:\n   - Exit current session\n   - Start new session\n   - Verify hooks fire by checking `.claude/logs/hook-events.json`\n\n5. **Validate plugins**: Check for configuration issues:\n   ```bash\n   claude plugin validate plugins/my-plugin\n   claude plugin marketplace list\n   ```\n\n6. **Check marketplace configuration**: In `.claude/settings.json`:\n   ```json\n   {\n     \"extraKnownMarketplaces\": {\n       \"constellos\": {\n         \"source\": {\n           \"source\": \"directory\",\n           \"path\": \"./.claude-plugin\"\n         }\n       }\n     },\n     \"enabledPlugins\": {\n       \"my-plugin@constellos\": true\n     }\n   }\n   ```\n\n7. **Use claude-code-guide for research**: When troubleshooting, always use the claude-code-guide agent for accurate documentation:\n   - Hook event types and lifecycle\n   - Plugin installation and configuration\n   - Debugging techniques\n\n### Plugin Cache Out of Sync\n\n**Symptom:** Hooks behaving differently than expected (old hooks firing, new hooks missing, removed hooks still running)\n\n**Cause:** Plugin cache at `~/.claude/plugins/cache/` contains old versions from before recent changes\n\n**Solution:**\n\n1. **Automatic (recommended):** Use `claude-worktree.sh` which auto-refreshes plugins on every new worktree\n   ```bash\n   bash claude-worktree.sh\n   ```\n\n2. **Manual:** Reinstall plugins to refresh cache:\n   ```bash\n   # Uninstall all constellos plugins\n   claude plugin uninstall --scope project github-context@constellos\n   claude plugin uninstall --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin uninstall --scope project project-context@constellos\n\n   # Reinstall from current source\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n3. **Nuclear option:** Delete entire cache and reinstall:\n   ```bash\n   rm -rf ~/.claude/plugins/cache/constellos\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n**Verification:**\n```bash\n# Check if await-pr-checks hook exists (added in PR #71)\nls ~/.claude/plugins/cache/constellos/github-context/hooks/await-pr-checks.ts\n\n# Verify NO Stop hooks in nextjs-supabase-ai-sdk-dev (removed in PR #71)\ncat ~/.claude/plugins/cache/constellos/nextjs-supabase-ai-sdk-dev/hooks/hooks.json | grep -i \"stop\"\n\n# Compare cached vs source to see differences\ndiff ~/.claude/plugins/cache/constellos/github-context/hooks/hooks.json \\\n     ./plugins/github-context/hooks/hooks.json\n```\n\n### When to Restart Sessions vs Reinstall Plugins\n\nUnderstanding when changes require a session restart vs plugin reinstall helps maintain an efficient development workflow.\n\n**Requires NEW session** (exit and restart Claude Code):\n- Changes to `.claude/settings.json`:\n  - Modifying `enabledPlugins`\n  - Adding/removing `extraKnownMarketplaces`\n  - Changing marketplace paths or configuration\n- Adding new plugins to marketplace\n- Removing plugins from marketplace\n- Changes to `.claude-plugin/marketplace.json`\n\n**Requires plugin REINSTALL** (no session restart needed):\n- Changes to `hooks/hooks.json` (hook configuration)\n- Changes to `.claude-plugin/plugin.json` (plugin metadata)\n- Changes to hook implementation files (`.ts` files)\n- Changes to shared utilities in `shared/` folder\n- Bug fixes or improvements to existing hooks\n\n**Reinstall command:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**Or use the quick reinstall pattern:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos 2>/dev/null || true && \\\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**No restart or reinstall needed:**\n- Documentation changes (README.md, CLAUDE.md)\n- Comment updates in code\n- Test file changes\n- Non-hook TypeScript files\n\n**Why this matters:**\n- Plugin files are copied to `~/.claude/plugins/cache/` during installation\n- Claude Code loads plugin configuration only at session start\n- Reinstalling updates the cache without requiring a full session restart\n- This allows rapid iteration during plugin development\n\n**Development workflow:**\n1. Make changes to hook implementation\n2. Reinstall the plugin to update cache\n3. Test the changes in current session\n4. Repeat until working correctly\n\n**Only restart session when:**\n- You've made changes to `.claude/settings.json`\n- You've added/removed plugins from the marketplace\n- Reinstalling doesn't seem to apply your changes\n\n## Key Architecture Decisions\n\n### Self-Executable Hooks\n\nEach hook is a standalone TypeScript file that:\n- Uses the `runHook` wrapper for stdin/stdout handling\n- Can be executed directly with `npx tsx`\n- Exports a named `handler` function for testing\n- No separate runner script needed\n\n### Shared Utilities Pattern\n\nAll plugins import from `shared/` rather than duplicating code:\n- Consistent typing across all hooks\n- Shared I/O, debug, and transcript utilities\n- Easy updates to all plugins\n\n### Type Safety\n\nFull TypeScript typing for all hook events in `shared/types/types.ts`:\n- Input types for each hook event\n- Output types with proper constraints\n- Handler function type helpers\n\n### Automatic Hook Logging and Error Handling\n\n**All hooks automatically log to `.claude/logs/hook-events.json`** via the `runHook` wrapper in `shared/hooks/utils/io.ts`. Hook developers don't need to write ANY logging code.\n\n**How it works:**\n1. `runHook(handler)` wraps your hook handler function\n2. Reads input from stdin and creates a debug logger\n3. **Automatically logs input** before executing handler (if debug enabled)\n4. Executes your handler function\n5. **Automatically logs output** after handler completes (if debug enabled)\n6. **Automatically logs errors** if handler throws (if debug enabled)\n7. **ALWAYS returns blocking error response** if handler throws (regardless of debug mode)\n8. Writes output to stdout for Claude Code\n\n**What gets logged:**\n- **Input logs**: Complete hook input including tool names, parameters, session context\n- **Output logs**: Hook return values, additional context, permission decisions\n- **Error logs**: Exception details, stack traces, error messages\n\n**Error Handling Behavior:**\n- **ALL hook errors block execution** - No silent failures\n- **Module resolution errors** (missing imports) block immediately\n- **Runtime errors** (uncaught exceptions) block immediately\n- **Type errors** and other exceptions block immediately\n- Debug flag controls **logging verbosity only**, NOT blocking behavior\n\n**When logging is enabled:**\n- Debug mode is controlled by `input.debug === true` passed from Claude Code\n- Logging is always active when Claude Code runs hooks\n- No environment variables or configuration needed\n\n**Log file format:**\n- Location: `.claude/logs/hook-events.json`\n- Format: JSONL (one JSON object per line)\n- Structure: `{ timestamp, event, type, data }`\n\n**Pattern all hooks follow:**\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Business logic only - NO manual logging needed!\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export for testing\nexport { handler };\n\n// This provides automatic logging AND error handling!\nrunHook(handler);\n```\n\n**Key principle:** Hook handlers should contain ONLY business logic. The `runHook` wrapper handles all logging, error handling, and stdin/stdout communication automatically. All errors are converted to blocking responses to ensure broken hooks cannot fail silently.\n\n### TSDoc Documentation Standards\n\nAll TypeScript files in this project follow TSDoc 2025 best practices:\n\n**Required elements:**\n- **@module** tag at the top of each file describing its purpose\n- **Multi-line format** for all public exports\n- **@param** tags for all parameters with descriptions\n- **@returns** tags describing return values\n- **@throws** tags documenting error conditions\n- **@example** blocks showing realistic usage\n\n**Pattern:**\n```typescript\n/**\n * Brief description of what the function does\n *\n * More detailed explanation of behavior, use cases, and important notes.\n *\n * @param paramName - Description of parameter purpose\n * @returns Description of return value and what it represents\n * @throws Error description - when and why it throws\n *\n * @example\n * ```typescript\n * import { functionName } from './module.js';\n * const result = await functionName('example-input');\n * ```\n */\n```\n\n**References:**\n- TSDoc standard: https://tsdoc.org/\n- TypeScript documentation: https://www.typescriptlang.org/docs/\n\nAll hooks and utilities in this project have comprehensive TSDoc documentation for:\n- Clear understanding of purpose and behavior\n- Type-safe usage with IDE support\n- Maintainability and onboarding\n- Automated documentation generation\n\n## Documentation Best Practices\n\nWhen developing agents, skills, commands, and rules for this project, follow these documentation standards:\n\n### Link to Official Documentation\n\n**Always link to official documentation and best practices** when creating or modifying:\n- Agents\n- Skills\n- Commands\n- Rules\n\n### Prefer Markdown Versions of Documentation\n\nWhen linking to documentation, **prefer `.md` file URLs** over HTML pages whenever available:\n\n**Examples of markdown-friendly documentation:**\n\n- **Claude Code**: https://github.com/anthropics/claude-code/tree/main/docs\n- **Next.js**: https://github.com/vercel/next.js/tree/canary/docs\n- **Vercel**: https://vercel.com/docs (provides markdown-friendly content)\n- **Supabase**: https://github.com/supabase/supabase/tree/master/apps/docs\n\n**Why markdown versions?**\n- More AI-friendly to read and parse\n- Better for offline access\n- Easier to diff and track changes\n- Direct access to source content\n\n### Research Before Implementation\n\nBefore implementing or modifying agents, skills, commands, or rules:\n\n1. **Search for official documentation** - Find the authoritative source\n2. **Search for best practices** - Look for recommended patterns and approaches\n3. **Link explicitly in markdown files** - Include references to official docs in:\n   - Agent `## Agent-scoped project context` sections\n   - Skill `## Skill-scoped context` sections\n   - Rule files under appropriate headings\n   - Command documentation\n\n**Example (Agent):**\n\n```markdown\n## Agent-scoped project context\n\n- Uses Next.js App Router (https://raw.githubusercontent.com/vercel/next.js/canary/docs/app/building-your-application/routing.md)\n- Follows Vercel deployment best practices (https://vercel.com/docs/deployments)\n- TypeScript strict mode enabled (https://www.typescriptlang.org/tsconfig#strict)\n```\n\n**Example (Skill):**\n\n```markdown\n## Skill-scoped context\n\n- Supabase database migrations (https://raw.githubusercontent.com/supabase/supabase/master/apps/docs/content/guides/database/migrations.mdx)\n- Migration best practices: always test locally before production\n- Use meaningful migration names with timestamps\n```\n\n**Example (Rule):**\n\n```markdown\n## Rules\n\n1. Follow TypeScript strict mode guidelines (https://www.typescriptlang.org/tsconfig#strict)\n2. Use Next.js App Router patterns (https://github.com/vercel/next.js/tree/canary/docs/app)\n3. Follow React Server Components best practices (https://github.com/reactwg/server-components/discussions)\n```\n\n### Informing vs. Linking\n\n- **Link to official docs** - These are the authoritative references for tools and frameworks\n- **Use best practices to inform** - Best practices guide how you structure agents, skills, commands, and rules\n- **Keep docs fresh** - Update links when major version changes occur\n\n## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment\n","structuredPatch":[{"oldStart":1031,"oldLines":11,"newStart":1031,"newLines":8,"lines":[" "," ## Documentation"," ","-Comprehensive Claude Code documentation in `.claude/skills/`:","-","-- `claude-plugins/SKILL.md` - Plugin development guide","-- `claude-hooks/SKILL.md` - Hook types and patterns","-- `claude-skills/SKILL.md` - Agent Skills","-- `claude-commands/SKILL.md` - Slash commands","-- `claude-agents/SKILL.md` - Subagent configuration","-- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","+For Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:","+- Plugin structure and development","+- Hook types and patterns","+- Agent, skill, and command creation","+- MCP integration"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:38.045Z","event":"typecheck-file","type":"input","data":{"tool_name":"Edit","tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:38.050Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Edit","tool_input":{"file_path":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","old_string":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","new_string":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration"},"tool_response":{"filePath":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/CLAUDE.md","oldString":"## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","newString":"## Documentation\n\nFor Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:\n- Plugin structure and development\n- Hook types and patterns\n- Agent, skill, and command creation\n- MCP integration","originalFile":"---\ntitle: Claude Code Plugins Marketplace\ndescription: A marketplace of Claude Code plugins with shared TypeScript utilities and typed hooks for development workflows\nfolder:\n  subfolders:\n    allowed: [.claude, .claude-plugin, .github, docs, plugins, shared]\n    required: [.claude-plugin, plugins, shared]\n  files:\n    allowed: [CLAUDE.md, LICENSE, package.json, package-lock.json, tsconfig.json, vitest.config.ts, eslint.config.mjs, .gitignore, .attw.json, README.md]\n    required: [CLAUDE.md, package.json]\n---\n\n# Claude Code Plugins\n\n## What This Is\n\nA marketplace of Claude Code plugins with shared TypeScript utilities. This is NOT an npm package - it's a collection of plugins that extend Claude Code with typed hooks for development workflows.\n\n## Architecture\n\n```\n.\nâ”œâ”€â”€ .claude-plugin/\nâ”‚   â””â”€â”€ marketplace.json        # Marketplace definition\nâ”‚\nâ”œâ”€â”€ shared/                     # Shared utilities imported by all plugins\nâ”‚   â”œâ”€â”€ types/\nâ”‚   â”‚   â””â”€â”€ types.ts           # Hook type definitions\nâ”‚   â”œâ”€â”€ hooks/\nâ”‚   â”‚   â”œâ”€â”€ utils/             # Hook utilities\nâ”‚   â”‚   â”‚   â”œâ”€â”€ io.ts          # stdin/stdout + runHook wrapper\nâ”‚   â”‚   â”‚   â”œâ”€â”€ debug.ts       # Debug logging\nâ”‚   â”‚   â”‚   â”œâ”€â”€ transcripts.ts # Transcript parsing\nâ”‚   â”‚   â”‚   â”œâ”€â”€ subagent-state.ts # Subagent context management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ task-state.ts  # Task state management\nâ”‚   â”‚   â”‚   â”œâ”€â”€ package-manager.ts # Package manager detection\nâ”‚   â”‚   â”‚   â”œâ”€â”€ toml.ts        # TOML parser\nâ”‚   â”‚   â”‚   â”œâ”€â”€ was-tool-event-main-agent.ts # Agent detection\nâ”‚   â”‚   â”‚   â””â”€â”€ index.ts       # Exports all utilities\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-start.ts  # SubagentStart hook\nâ”‚   â”‚   â”œâ”€â”€ log-subagent-stop.ts   # SubagentStop hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-call.ts       # PreToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ log-task-result.ts     # PostToolUse[Task] hook\nâ”‚   â”‚   â”œâ”€â”€ enforce-structured-markdown.ts  # PreToolUse hook for markdown validation\nâ”‚   â”‚   â”œâ”€â”€ enforce-output-style-tools.ts   # PreToolUse hook for tool enforcement\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-write.ts  # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-folder-structure-mkdir.ts  # PreToolUse[Bash] hook\nâ”‚   â”‚   â”œâ”€â”€ validate-rules-file.ts          # PreToolUse[Write|Edit] hook\nâ”‚   â”‚   â””â”€â”€ run-rule-checks.ts              # PostToolUse hook for rule checks\nâ”‚   â””â”€â”€ rules/                  # Claude rules documentation (*.md files)\nâ”‚       â””â”€â”€ CLAUDE.md          # Rules folder documentation\nâ”‚\nâ””â”€â”€ plugins/                    # Individual marketplace plugins\n    â”œâ”€â”€ github-context/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-github.ts           # SessionStart: install GitHub CLI\n    â”‚       â”œâ”€â”€ add-github-context.ts       # SessionStart: branch context & issues\n    â”‚       â”œâ”€â”€ sync-plan-to-issue.ts       # PostToolUse[Write|Edit]: plan sync\n    â”‚       â”œâ”€â”€ enhance-commit-context.ts   # PostToolUse[Bash]: commit enhancement\n    â”‚       â”œâ”€â”€ commit-task.ts              # SubagentStop: auto-commit agent work\n    â”‚       â””â”€â”€ commit-session-check-pr-status.ts  # Stop: session commit & PR checks\n    â”‚\n    â”œâ”€â”€ nextjs-supabase-ai-sdk-dev/\n    â”‚   â”œâ”€â”€ .claude-plugin/plugin.json\n    â”‚   â””â”€â”€ hooks/\n    â”‚       â”œâ”€â”€ hooks.json\n    â”‚       â”œâ”€â”€ install-vercel.ts           # SessionStart: install Vercel CLI\n    â”‚       â”œâ”€â”€ install-supabase.ts         # SessionStart: install Supabase CLI\n    â”‚       â”œâ”€â”€ check-file-eslint.ts        # PostToolUse[Write|Edit]: ESLint on file\n    â”‚       â”œâ”€â”€ check-file-types.ts         # PostToolUse[Write|Edit]: TypeScript on file\n    â”‚       â”œâ”€â”€ check-file-tsdoc.ts         # PostToolUse[Write|Edit]: TSDoc validation\n    â”‚       â”œâ”€â”€ check-file-vitest-results.ts # PostToolUse[Write|Edit]: Vitest on test files\n    â”‚       â”œâ”€â”€ encourage-ui-review.ts      # PostToolUse[Task]: encourage ui-reviewer\n    â”‚       â”œâ”€â”€ check-global-eslint.ts      # Stop: ESLint on all (blocking)\n    â”‚       â”œâ”€â”€ check-global-types.ts       # Stop: TypeScript on all (blocking)\n    â”‚       â””â”€â”€ check-global-vitest-results.ts # Stop: Vitest on all (blocking)\n    â”‚\n    â””â”€â”€ project-context/\n        â”œâ”€â”€ .claude-plugin/plugin.json\n        â””â”€â”€ hooks/\n            â”œâ”€â”€ hooks.json\n            â”œâ”€â”€ encourage-context-review.ts  # UserPromptSubmit: context updates\n            â”œâ”€â”€ add-folder-context.ts        # PostToolUse[Read]: CLAUDE.md discovery\n            â”œâ”€â”€ create-plan-symlink.ts       # PostToolUse[Write|Edit]: PLAN.md symlink\n            â”œâ”€â”€ try-markdown-page.ts         # PreToolUse[WebFetch]: prefer .md URLs\n            â””â”€â”€ shared/                      # Uses shared validation hooks\n                â”œâ”€â”€ log-task-call.ts         # PreToolUse[Task]: save task context\n                â”œâ”€â”€ log-task-result.ts       # PostToolUse[Task]: log task results\n                â”œâ”€â”€ validate-folder-structure-write.ts   # PreToolUse[Write|Edit]\n                â”œâ”€â”€ validate-folder-structure-mkdir.ts   # PreToolUse[Bash]\n                â”œâ”€â”€ validate-rules-file.ts               # PreToolUse[Write|Edit]\n                â””â”€â”€ enforce-plan-scoping.ts              # PostToolUse[Write|Edit|Read]\n```\n\n## Self-Executable Hooks with tsx\n\nAll hooks are self-executable TypeScript files that can be run directly with `npx tsx`. Each hook:\n1. Imports the `runHook` wrapper from `shared/hooks/utils/io.ts`\n2. Defines a `handler` function with typed input/output\n3. Calls `runHook(handler)` at the end of the file\n\n### Hook Pattern\n\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Hook implementation\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export handler for testing\nexport { handler };\n\n// Make this file self-executable with tsx\nrunHook(handler);\n```\n\n### hooks.json Configuration\n\n**IMPORTANT**: The official Claude Code repository and its plugins should serve as the canonical example:\n- Repository: https://github.com/anthropics/claude-code\n- Marketplace: https://raw.githubusercontent.com/anthropics/claude-code/main/.claude-plugin/marketplace.json\n- Example plugins: https://github.com/anthropics/claude-code/tree/main/plugins\n\nHooks must be wrapped in a `\"hooks\"` object:\n\n```json\n{\n  \"description\": \"My plugin description\",\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nVariables provided by Claude Code:\n- `${CLAUDE_PROJECT_DIR}` - Root of the Claude Code project\n- `${CLAUDE_PLUGIN_ROOT}` - Root of the specific plugin being executed\n\n## Shared Folder (`shared/`)\n\n### Types (`shared/types/types.ts`)\n\nFull TypeScript typing for all Claude Code hook events:\n\n```typescript\nimport type {\n  SessionStartInput,\n  SessionStartHookOutput,\n  PostToolUseInput,\n  PostToolUseHookOutput,\n  // ... all hook types\n} from '../../../shared/types/types.js';\n```\n\n### Hook Utilities (`shared/hooks/utils/`)\n\n- **io.ts** - stdin/stdout JSON handling and `runHook` wrapper\n- **debug.ts** - Debug logging with JSONL output to `.claude/logs/hook-events.json`\n- **transcripts.ts** - Parse Claude transcript JSONL files\n- **subagent-state.ts** - Save/load/analyze subagent context and edits\n- **task-state.ts** - Task state management for PreToolUse[Task] â†’ SubagentStop flow\n- **package-manager.ts** - Detect npm/yarn/pnpm/bun from lockfiles\n- **toml.ts** - Simple TOML parser for config files\n- **was-tool-event-main-agent.ts** - Detect if tool event is from main agent or subagent\n- **index.ts** - Re-exports all utilities\n\n### Shared Hooks (`shared/hooks/`)\n\n**Logging and State Management:**\n- **log-subagent-start.ts** - SubagentStart hook that saves agent context\n- **log-subagent-stop.ts** - SubagentStop hook that logs agent file operations\n- **log-task-call.ts** - PreToolUse[Task] hook that saves task call metadata\n- **log-task-result.ts** - PostToolUse[Task] hook that logs task results\n\n**Validation and Enforcement:**\n- **enforce-structured-markdown.ts** - PreToolUse[Write|Edit] hook for comprehensive markdown validation (agents, skills, rules, CLAUDE.md)\n- **enforce-output-style-tools.ts** - PreToolUse hook for output style tool enforcement\n- **validate-folder-structure-write.ts** - PreToolUse[Write|Edit] hook for .claude directory structure validation\n- **validate-folder-structure-mkdir.ts** - PreToolUse[Bash] hook for mkdir command validation\n- **validate-rules-file.ts** - PreToolUse[Write|Edit] hook for rule file structure validation\n\n**Custom Checks:**\n- **run-rule-checks.ts** - PostToolUse[Write|Edit] hook for running custom checks from rule frontmatter\n\n## Available Plugins\n\n### github-context\n\nGitHub integration with branch context, commit enhancement, plan synchronization, and CI orchestration.\n\n**Purpose:**\nProvides comprehensive GitHub integration including CLI installation, branch/issue context discovery, automatic commit enhancement with task metadata, plan-to-issue synchronization, and PR status monitoring.\n\n**Hooks:**\n- **SessionStart** (`install-github.ts`) - Installs GitHub CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`add-github-context.ts`) - Displays linked GitHub issue for current branch, branch sync status, and outstanding issues (non-blocking)\n- **PostToolUse[Write|Edit]** (`sync-plan-to-issue.ts`) - Automatically creates or updates GitHub issues from plan files (non-blocking)\n- **PostToolUse[Bash]** (`enhance-commit-context.ts`) - Enhances git commits with task context and issue references for both main agent and subagents (non-blocking)\n- **SubagentStop** (`commit-task.ts`) - Auto-commits subagent work with task context and git trailers (non-blocking)\n- **Stop** (`commit-session-check-pr-status.ts`) - Auto-commits session changes, checks PR status, and reports CI/preview URLs with progressive blocking\n\n**Key Features:**\n- **Branch Context Discovery:** Shows full GitHub issue content (title, body, comments) linked to current branch\n- **Sync Status:** Displays branch status relative to remote tracking branch and origin/main\n- **Outstanding Issues:** Lists open issues not linked to any branch, available for work\n- **Auto-commit:** Automatically commits subagent work with rich task context\n- **Plan Synchronization:** Creates/updates GitHub issues from plan files automatically\n- **Commit Enhancement:** Enriches commits with task and issue metadata\n- **PR Status Monitoring:** Checks PR status at session end with CI and preview URL reporting\n\n**Use Cases:**\n- GitHub-integrated development workflows\n- Issue-driven development with branch linking\n- Automated task documentation through commits\n- PR readiness checks before ending sessions\n- Multi-agent workflows with automatic commit documentation\n\n### nextjs-supabase-ai-sdk-dev\n\nDevelopment quality enforcement for Next.js, Supabase, and AI SDK projects with comprehensive linting, type checking, testing, and CLI installation.\n\n**Purpose:**\nEnsures code quality through automated checks at both file and project levels. Installs Vercel and Supabase CLIs on remote environments, runs per-file quality checks on edits, and performs comprehensive project-wide validation at session end.\n\n**Hooks:**\n- **SessionStart** (`install-vercel.ts`) - Installs Vercel CLI on remote environments, warns if missing locally (non-blocking)\n- **SessionStart** (`install-supabase.ts`) - Installs Supabase CLI on remote environments, warns if missing locally (non-blocking)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls and saves context for SubagentStop hooks (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after agent completion (non-blocking)\n- **PostToolUse[Task]** (`encourage-ui-review.ts`) - Encourages ui-reviewer agent after ui-developer completes (non-blocking)\n- **PostToolUse[Write|Edit]** (`check-file-eslint.ts`) - Runs ESLint on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-types.ts`) - Runs TypeScript type checking on individual files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit]** (`check-file-tsdoc.ts`) - Validates TSDoc documentation on TypeScript files after edits (non-blocking, informational)\n- **PostToolUse[Write|Edit test files]** (`check-file-vitest-results.ts`) - Runs Vitest on test files after edits (non-blocking, informational)\n- **Stop** (`check-global-eslint.ts`) - Runs ESLint on entire project at session end (blocking)\n- **Stop** (`check-global-types.ts`) - Runs TypeScript type checking on entire project at session end (blocking)\n- **Stop** (`check-global-vitest-results.ts`) - Runs full Vitest test suite at session end (blocking)\n\n**Key Features:**\n- **CLI Installation:** Automatic installation of Vercel and Supabase CLIs on remote environments\n- **Per-File Checks:** Immediate feedback on ESLint, TypeScript, and TSDoc issues after each file edit\n- **Test Execution:** Automatic test running when test files are modified\n- **Project-Wide Validation:** Comprehensive checks at session end ensure no issues slip through\n- **Blocking Stop Hooks:** Prevents ending session with linting errors, type errors, or failing tests\n- **Task Tracking:** Logs all Task tool calls for context in SubagentStop hooks\n- **UI Review Encouragement:** Prompts for visual review after UI development work\n\n**Use Cases:**\n- Next.js application development\n- TypeScript projects requiring strict type safety\n- Projects with comprehensive test suites\n- Teams enforcing code quality standards\n- CI/CD workflows requiring pre-push validation\n\n### project-context\n\nEnhanced context discovery, folder structure validation, and project guidance for Claude Code workflows.\n\n**Purpose:**\nAutomatically discovers and links CLAUDE.md documentation, validates project structure for .claude directories, enforces plan scoping, and encourages context updates based on user prompts. Provides intelligent URL redirection to prefer markdown documentation.\n\n**Hooks:**\n- **UserPromptSubmit** (`encourage-context-review.ts`) - Encourages updating plans, agents, skills, and CLAUDE.md files based on user prompts (non-blocking, informational)\n- **PreToolUse[Task]** (shared `log-task-call.ts`) - Logs Task tool calls before execution and saves context (non-blocking)\n- **PreToolUse[Write|Edit]** (shared `validate-folder-structure-write.ts`) - Validates folder structure when creating .claude files (blocking on structure violations)\n- **PreToolUse[Write|Edit]** (shared `validate-rules-file.ts`) - Validates rule file structure and Required Skills frontmatter (blocking on validation errors)\n- **PreToolUse[Bash]** (shared `validate-folder-structure-mkdir.ts`) - Validates mkdir commands for .claude directories (blocking on invalid paths)\n- **PreToolUse[WebFetch]** (`try-markdown-page.ts`) - Redirects WebFetch to markdown versions of documentation when available (non-blocking)\n- **PostToolUse[Task]** (shared `log-task-result.ts`) - Logs Task tool results after completion (non-blocking)\n- **PostToolUse[Write|Edit]** (`create-plan-symlink.ts`) - Creates PLAN.md symlink when plan files are written (non-blocking)\n- **PostToolUse[Write|Edit]** (shared `enforce-plan-scoping.ts`) - Enforces plan-based path scoping for write/edit operations (can block on scope violations)\n- **PostToolUse[Read]** (`add-folder-context.ts`) - Discovers and adds CLAUDE.md context when reading files (non-blocking)\n- **PostToolUse[Read]** (shared `enforce-plan-scoping.ts`) - Warns when reads are outside plan scope (non-blocking, guidance only)\n\n**Key Features:**\n- **Automatic Context Discovery:** Finds and links CLAUDE.md files when reading project files\n- **Folder Structure Validation:** Ensures .claude directories follow proper organization standards\n- **Plan Scoping:** Enforces staying within plan boundaries for file operations\n- **Rules Validation:** Ensures rule files have proper structure and Required Skills metadata\n- **Context Encouragement:** Prompts to update documentation based on user activity\n- **Markdown Preference:** Automatically redirects to .md versions of documentation URLs\n- **Plan Symlinks:** Maintains PLAN.md link to active plan file\n- **Task Tracking:** Comprehensive logging of agent invocations and results\n\n**Use Cases:**\n- Large codebases requiring organized documentation\n- Projects with .claude directory structures (agents, skills, rules, hooks)\n- Plan-driven development workflows\n- Documentation-heavy projects\n- Teams enforcing project structure standards\n- Research-oriented development (prefers markdown docs)\n\n## Vercel Preview Configuration\n\nThis project is configured to deploy all Turborepo apps on every commit and PR:\n\n- **Web App** (`apps/web`) - Main application\n- **Admin App** (`apps/admin`) - Administration dashboard\n- **Docs App** (`apps/docs`) - Documentation site\n\n**Preview URL Detection:**\n- Vercel bot posts preview URLs as PR comments\n- UI review workflow polls for these URLs (10 minute timeout)\n- Each app gets its own preview URL: `https://[app-name]-[hash].vercel.app`\n\n**E2E Testing:**\n- Playwright tests run against preview URLs in CI\n- Tests are isolated to `@app` and `@web` tags only\n- Screenshots captured during test execution at key moments\n- Claude API reviews screenshots per app and per test\n\n## Worktree Operation Restrictions\n\n**IMPORTANT**: When working in git worktrees, follow these best practices:\n\n### Recommended Settings (Local Development)\n\nAdd to your local `.claude/settings.json` (NOT committed to repo):\n\n```json\n{\n  \"workingDirectoryRestrictions\": {\n    \"enabled\": true,\n    \"allowedPaths\": [\n      \"/home/user/projects/my-repo/.worktrees/claude-*\"\n    ]\n  }\n}\n```\n\n### Why Worktree Safety Matters\n\n- **Isolation**: Each worktree is an independent branch checkout\n- **Context**: Main repo and worktree can have different files\n- **Safety**: Operations outside worktree can affect main repo or other worktrees\n- **Best Practice**: Review all file operations to ensure they target the worktree\n\n### Worktree Context\n\nThe `github-context-sync` plugin automatically:\n- Shows linked GitHub issue for current branch (full content with comments)\n- Displays branch sync status (remote tracking branch and origin/main)\n- Lists outstanding unlinked issues available for work\n- Encourages UI review after ui-developer agent completes\n\n### Manual Verification\n\nAlways verify you're in the correct worktree:\n\n```bash\npwd                    # Check current directory\ngit rev-parse --show-toplevel  # Show worktree root\ngit branch --show-current      # Show current branch\n```\n\n### Automatic Plugin Cache Management\n\nThe `claude-worktree.sh` script automatically manages plugin cache to ensure every worktree uses current plugin code:\n\n1. **Detects enabled plugins** from `.claude/settings.json`\n2. **Cleans up invalid installations** - Removes cached plugins whose source no longer exists\n3. **Refreshes plugin cache** - Uninstalls and reinstalls all plugins from worktree source\n4. **Ensures fresh hooks** - Every worktree session uses current plugin code\n\n**Why this matters:**\n- Plugins are cached globally at `~/.claude/plugins/cache/`\n- Cache is not automatically invalidated when source changes\n- Old cached hooks can cause unexpected behavior (missing new hooks, running removed hooks)\n- Automatic refresh ensures worktree uses fresh plugin code\n\n**Dependencies:**\n- Requires `jq` for parsing JSON: `brew install jq` (macOS) or `apt install jq` (Linux)\n- Without `jq`, manual plugin reinstallation required\n\n**Manual cache refresh:**\n```bash\n# List plugins\nclaude plugin list\n\n# Uninstall and reinstall\nclaude plugin uninstall --scope project plugin-name@constellos\nclaude plugin install --scope project plugin-name@constellos\n```\n\n## UI Development Workflow\n\nThis project includes a comprehensive UI development system with progressive skills and automated review:\n\n### UI Development Skills (Progressive)\n\n1. **ui-wireframing** - Mobile-first ASCII wireframes in `WIREFRAME.md` files\n2. **ui-design** - Contract-first static UI with compound components\n3. **ui-interaction** - Client-side events, local state, validation\n4. **ui-integration** - Server actions, Supabase queries, backend integration\n5. **ai-sdk-ui** - AI-powered features with Vercel AI SDK\n\n### UI Developer Agent\n\nThe `ui-developer` agent (in `nextjs-supabase-ai-sdk-dev` plugin) provides:\n- All 5 UI skills preloaded\n- MCP integration (ai-elements, shadcn, next-devtools)\n- Systematic workflow: wireframe â†’ design â†’ interaction â†’ integration â†’ AI\n- Mobile-first, contract-first, Server Component defaults\n\n**Local Development:**\n- Uses next-devtools MCP for live preview and debugging\n- No Playwright installation needed locally\n- Real-time UI feedback during development\n\n### UI Review System\n\n**Manual Review:**\n- Invoke `ui-reviewer` agent with screenshot paths\n- Provides systematic quality review\n- Identifies critical, major, and minor issues\n\n**Automated CI Review:**\n- GitHub Actions workflow (`ui-review.yml`) runs on commits/PRs\n- Playwright e2e tests for `@app` and `@web` tags\n- Screenshots captured during test execution\n- Claude API reviews each test's screenshots with vision\n- Per-test reviews aggregated into final report\n- Blocks merge if critical issues found\n\n**Review Criteria:**\n- Visual consistency across breakpoints\n- Responsive behavior (mobile, tablet, desktop)\n- Accessibility (color contrast, semantic HTML)\n- Component composition patterns\n- User experience quality\n\n### Technology Stack\n\n- **UI Components**: Shadcn (default), AI Elements, Radix, HTML\n- **Styling**: Tailwind CSS with mobile-first approach\n- **State Management**: Server Components (default), client components when needed\n- **Validation**: Zod schemas (client + server)\n- **Backend**: Supabase with defense-in-depth (RLS + explicit auth checks)\n- **AI Integration**: Vercel AI SDK with streaming UI\n\n## Creating New Plugins\n\n1. Create plugin directory:\n   ```bash\n   mkdir -p plugins/my-plugin/.claude-plugin\n   mkdir -p plugins/my-plugin/hooks\n   ```\n\n2. Create `plugin.json`:\n   ```json\n   {\n     \"name\": \"my-plugin\",\n     \"version\": \"0.1.0\",\n     \"description\": \"My custom plugin\",\n     \"author\": { \"name\": \"your-name\" }\n   }\n   ```\n\n3. Create `hooks/hooks.json`:\n   ```json\n   {\n     \"description\": \"My plugin hooks\",\n     \"hooks\": {\n       \"SessionStart\": [\n         {\n           \"hooks\": [\n             {\n               \"type\": \"command\",\n               \"command\": \"npx tsx ${CLAUDE_PLUGIN_ROOT}/hooks/my-hook.ts\"\n             }\n           ]\n         }\n       ]\n     }\n   }\n   ```\n\n4. Create hook file `hooks/my-hook.ts` with proper TSDoc:\n   ```typescript\n   /**\n    * Brief description of what this hook does\n    *\n    * Detailed explanation of the hook's purpose, when it triggers,\n    * and what it accomplishes.\n    *\n    * @module my-hook\n    */\n\n   import type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\n   import { runHook } from '../../../shared/hooks/utils/io.js';\n\n   /**\n    * SessionStart hook handler\n    *\n    * Executes at session start to perform [specific action].\n    *\n    * @param input - SessionStart hook input from Claude Code\n    * @returns Hook output with additional context\n    *\n    * @example\n    * ```typescript\n    * // This hook is automatically called by Claude Code\n    * // when a new session starts\n    * ```\n    */\n   async function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n     return {\n       hookSpecificOutput: {\n         hookEventName: 'SessionStart',\n         additionalContext: 'My hook executed!',\n       },\n     };\n   }\n\n   export { handler };\n   runHook(handler);\n   ```\n\n5. Add to marketplace.json:\n   ```json\n   {\n     \"plugins\": [\n       {\n         \"name\": \"my-plugin\",\n         \"source\": \"./plugins/my-plugin\"\n       }\n     ]\n   }\n   ```\n\n6. Create `README.md` documenting your plugin:\n   ```markdown\n   # My Plugin\n\n   Brief description of what the plugin does.\n\n   ## Overview\n\n   Detailed explanation of the plugin's purpose and capabilities.\n\n   ## Hooks\n\n   ### SessionStart - Hook Name\n\n   **File:** `hooks/my-hook.ts`\n   **Event:** SessionStart\n   **What it does:** Detailed description of hook behavior\n   **Non-blocking:** Yes/No\n\n   ## Installation\n\n   \\```bash\n   claude plugin install my-plugin@constellos\n   \\```\n\n   ## Configuration\n\n   Description of any configuration options.\n\n   ## Debug Logging\n\n   \\```bash\n   DEBUG=my-hook claude\n   \\```\n   ```\n\n## Local Development\n\n### Using Plugins in This Repo\n\nConfiguration in `.claude/settings.json`:\n\n```json\n{\n  \"enabledPlugins\": {\n    \"github-vercel-supabase-ci@constellos\": true,\n    \"github-review-sync@constellos\": true,\n    \"nextjs-supabase-ai-sdk-dev@constellos\": true,\n    \"code-context@constellos\": true,\n    \"markdown-structure-rules@constellos\": true\n  }\n}\n```\n\nNote: The marketplace is automatically registered when you run `claude plugin marketplace add ./` from the project root.\n\n### Installing Plugins\n\nFirst, add the marketplace:\n```bash\nclaude plugin marketplace add ./\n```\n\nThen install the plugins:\n```bash\nclaude plugin install github-vercel-supabase-ci@constellos\nclaude plugin install github-review-sync@constellos\nclaude plugin install nextjs-supabase-ai-sdk-dev@constellos\nclaude plugin install code-context@constellos\nclaude plugin install markdown-structure-rules@constellos\n```\n\n### Testing Changes\n\n1. Edit plugin files in `plugins/` or shared utilities in `shared/`\n2. Exit Claude Code session\n3. Start new session\n4. Changes are automatically loaded\n\n## Testing\n\nRun tests and checks:\n\n```bash\nnpm run typecheck     # TypeScript type checking\nnpm run lint          # ESLint\nnpm run test          # Vitest\nnpm run test:watch    # Vitest watch mode\n```\n\nEnable debug logging for hooks:\n```bash\nDEBUG=* claude              # All debug output\nDEBUG=plugin-name claude    # Specific plugin\n```\n\n## Claude Code Documentation Notes\n\nThe official Claude Code documentation may be out of date or incomplete. When implementing hooks:\n\n- **Test actual behavior** rather than relying solely on docs\n- **Check GitHub issues** for known bugs (e.g., issue #10412 about Stop hooks via plugins)\n- **The `reason` field in Stop hooks is shown to Claude** (tells it what to fix)\n- **The `systemMessage` field is shown to the user** (status info, not visible to Claude)\n- **Use explicit `decision: \"approve\"`** when allowing stop (not just empty `{}`)\n- **Use explicit `decision: \"block\"` with actionable `reason`** when blocking\n\n### Stop Hook Output Best Practices\n\n```typescript\n// When blocking - provide actionable instructions to Claude\nreturn {\n  decision: 'block',\n  reason: 'ESLint errors detected. You MUST fix these before stopping:\\n\\n[errors here]\\n\\nFix each error, then run linter to verify.',\n  systemMessage: 'Claude is blocked from stopping due to ESLint errors.',\n};\n\n// When approving - be explicit\nreturn { decision: 'approve' };\n```\n\n## Troubleshooting\n\n### Hooks Not Firing\n\nIf hooks aren't executing:\n\n1. **Check plugin cache**: Plugins are cached in `~/.claude/plugins/cache/`. Verify the cached `hooks.json` has the correct format with the `\"hooks\"` wrapper.\n\n2. **Verify hooks.json format**: Use the claude-code-guide agent to confirm the correct format:\n   ```bash\n   # In Claude Code session\n   /help hooks.json format\n   ```\n\n   Or research with the claude-code-guide agent:\n   - What is the correct format for hooks.json?\n   - Should hooks be wrapped in a \"hooks\" object?\n\n3. **Reinstall plugins**: If you changed the hooks.json format, reinstall to refresh cache:\n   ```bash\n   claude plugin uninstall --scope project my-plugin@constellos\n   claude plugin install --scope project my-plugin@constellos\n   ```\n\n4. **Restart Claude Code**: Hooks only load when Claude Code starts. After any plugin changes:\n   - Exit current session\n   - Start new session\n   - Verify hooks fire by checking `.claude/logs/hook-events.json`\n\n5. **Validate plugins**: Check for configuration issues:\n   ```bash\n   claude plugin validate plugins/my-plugin\n   claude plugin marketplace list\n   ```\n\n6. **Check marketplace configuration**: In `.claude/settings.json`:\n   ```json\n   {\n     \"extraKnownMarketplaces\": {\n       \"constellos\": {\n         \"source\": {\n           \"source\": \"directory\",\n           \"path\": \"./.claude-plugin\"\n         }\n       }\n     },\n     \"enabledPlugins\": {\n       \"my-plugin@constellos\": true\n     }\n   }\n   ```\n\n7. **Use claude-code-guide for research**: When troubleshooting, always use the claude-code-guide agent for accurate documentation:\n   - Hook event types and lifecycle\n   - Plugin installation and configuration\n   - Debugging techniques\n\n### Plugin Cache Out of Sync\n\n**Symptom:** Hooks behaving differently than expected (old hooks firing, new hooks missing, removed hooks still running)\n\n**Cause:** Plugin cache at `~/.claude/plugins/cache/` contains old versions from before recent changes\n\n**Solution:**\n\n1. **Automatic (recommended):** Use `claude-worktree.sh` which auto-refreshes plugins on every new worktree\n   ```bash\n   bash claude-worktree.sh\n   ```\n\n2. **Manual:** Reinstall plugins to refresh cache:\n   ```bash\n   # Uninstall all constellos plugins\n   claude plugin uninstall --scope project github-context@constellos\n   claude plugin uninstall --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin uninstall --scope project project-context@constellos\n\n   # Reinstall from current source\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n3. **Nuclear option:** Delete entire cache and reinstall:\n   ```bash\n   rm -rf ~/.claude/plugins/cache/constellos\n   claude plugin install --scope project github-context@constellos\n   claude plugin install --scope project nextjs-supabase-ai-sdk-dev@constellos\n   claude plugin install --scope project project-context@constellos\n   ```\n\n**Verification:**\n```bash\n# Check if await-pr-checks hook exists (added in PR #71)\nls ~/.claude/plugins/cache/constellos/github-context/hooks/await-pr-checks.ts\n\n# Verify NO Stop hooks in nextjs-supabase-ai-sdk-dev (removed in PR #71)\ncat ~/.claude/plugins/cache/constellos/nextjs-supabase-ai-sdk-dev/hooks/hooks.json | grep -i \"stop\"\n\n# Compare cached vs source to see differences\ndiff ~/.claude/plugins/cache/constellos/github-context/hooks/hooks.json \\\n     ./plugins/github-context/hooks/hooks.json\n```\n\n### When to Restart Sessions vs Reinstall Plugins\n\nUnderstanding when changes require a session restart vs plugin reinstall helps maintain an efficient development workflow.\n\n**Requires NEW session** (exit and restart Claude Code):\n- Changes to `.claude/settings.json`:\n  - Modifying `enabledPlugins`\n  - Adding/removing `extraKnownMarketplaces`\n  - Changing marketplace paths or configuration\n- Adding new plugins to marketplace\n- Removing plugins from marketplace\n- Changes to `.claude-plugin/marketplace.json`\n\n**Requires plugin REINSTALL** (no session restart needed):\n- Changes to `hooks/hooks.json` (hook configuration)\n- Changes to `.claude-plugin/plugin.json` (plugin metadata)\n- Changes to hook implementation files (`.ts` files)\n- Changes to shared utilities in `shared/` folder\n- Bug fixes or improvements to existing hooks\n\n**Reinstall command:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**Or use the quick reinstall pattern:**\n```bash\nclaude plugin uninstall --scope project my-plugin@constellos 2>/dev/null || true && \\\nclaude plugin install --scope project my-plugin@constellos\n```\n\n**No restart or reinstall needed:**\n- Documentation changes (README.md, CLAUDE.md)\n- Comment updates in code\n- Test file changes\n- Non-hook TypeScript files\n\n**Why this matters:**\n- Plugin files are copied to `~/.claude/plugins/cache/` during installation\n- Claude Code loads plugin configuration only at session start\n- Reinstalling updates the cache without requiring a full session restart\n- This allows rapid iteration during plugin development\n\n**Development workflow:**\n1. Make changes to hook implementation\n2. Reinstall the plugin to update cache\n3. Test the changes in current session\n4. Repeat until working correctly\n\n**Only restart session when:**\n- You've made changes to `.claude/settings.json`\n- You've added/removed plugins from the marketplace\n- Reinstalling doesn't seem to apply your changes\n\n## Key Architecture Decisions\n\n### Self-Executable Hooks\n\nEach hook is a standalone TypeScript file that:\n- Uses the `runHook` wrapper for stdin/stdout handling\n- Can be executed directly with `npx tsx`\n- Exports a named `handler` function for testing\n- No separate runner script needed\n\n### Shared Utilities Pattern\n\nAll plugins import from `shared/` rather than duplicating code:\n- Consistent typing across all hooks\n- Shared I/O, debug, and transcript utilities\n- Easy updates to all plugins\n\n### Type Safety\n\nFull TypeScript typing for all hook events in `shared/types/types.ts`:\n- Input types for each hook event\n- Output types with proper constraints\n- Handler function type helpers\n\n### Automatic Hook Logging and Error Handling\n\n**All hooks automatically log to `.claude/logs/hook-events.json`** via the `runHook` wrapper in `shared/hooks/utils/io.ts`. Hook developers don't need to write ANY logging code.\n\n**How it works:**\n1. `runHook(handler)` wraps your hook handler function\n2. Reads input from stdin and creates a debug logger\n3. **Automatically logs input** before executing handler (if debug enabled)\n4. Executes your handler function\n5. **Automatically logs output** after handler completes (if debug enabled)\n6. **Automatically logs errors** if handler throws (if debug enabled)\n7. **ALWAYS returns blocking error response** if handler throws (regardless of debug mode)\n8. Writes output to stdout for Claude Code\n\n**What gets logged:**\n- **Input logs**: Complete hook input including tool names, parameters, session context\n- **Output logs**: Hook return values, additional context, permission decisions\n- **Error logs**: Exception details, stack traces, error messages\n\n**Error Handling Behavior:**\n- **ALL hook errors block execution** - No silent failures\n- **Module resolution errors** (missing imports) block immediately\n- **Runtime errors** (uncaught exceptions) block immediately\n- **Type errors** and other exceptions block immediately\n- Debug flag controls **logging verbosity only**, NOT blocking behavior\n\n**When logging is enabled:**\n- Debug mode is controlled by `input.debug === true` passed from Claude Code\n- Logging is always active when Claude Code runs hooks\n- No environment variables or configuration needed\n\n**Log file format:**\n- Location: `.claude/logs/hook-events.json`\n- Format: JSONL (one JSON object per line)\n- Structure: `{ timestamp, event, type, data }`\n\n**Pattern all hooks follow:**\n```typescript\nimport type { SessionStartInput, SessionStartHookOutput } from '../../../shared/types/types.js';\nimport { runHook } from '../../../shared/hooks/utils/io.js';\n\nasync function handler(input: SessionStartInput): Promise<SessionStartHookOutput> {\n  // Business logic only - NO manual logging needed!\n  return {\n    hookSpecificOutput: {\n      hookEventName: 'SessionStart',\n      additionalContext: 'Hook executed successfully',\n    },\n  };\n}\n\n// Export for testing\nexport { handler };\n\n// This provides automatic logging AND error handling!\nrunHook(handler);\n```\n\n**Key principle:** Hook handlers should contain ONLY business logic. The `runHook` wrapper handles all logging, error handling, and stdin/stdout communication automatically. All errors are converted to blocking responses to ensure broken hooks cannot fail silently.\n\n### TSDoc Documentation Standards\n\nAll TypeScript files in this project follow TSDoc 2025 best practices:\n\n**Required elements:**\n- **@module** tag at the top of each file describing its purpose\n- **Multi-line format** for all public exports\n- **@param** tags for all parameters with descriptions\n- **@returns** tags describing return values\n- **@throws** tags documenting error conditions\n- **@example** blocks showing realistic usage\n\n**Pattern:**\n```typescript\n/**\n * Brief description of what the function does\n *\n * More detailed explanation of behavior, use cases, and important notes.\n *\n * @param paramName - Description of parameter purpose\n * @returns Description of return value and what it represents\n * @throws Error description - when and why it throws\n *\n * @example\n * ```typescript\n * import { functionName } from './module.js';\n * const result = await functionName('example-input');\n * ```\n */\n```\n\n**References:**\n- TSDoc standard: https://tsdoc.org/\n- TypeScript documentation: https://www.typescriptlang.org/docs/\n\nAll hooks and utilities in this project have comprehensive TSDoc documentation for:\n- Clear understanding of purpose and behavior\n- Type-safe usage with IDE support\n- Maintainability and onboarding\n- Automated documentation generation\n\n## Documentation Best Practices\n\nWhen developing agents, skills, commands, and rules for this project, follow these documentation standards:\n\n### Link to Official Documentation\n\n**Always link to official documentation and best practices** when creating or modifying:\n- Agents\n- Skills\n- Commands\n- Rules\n\n### Prefer Markdown Versions of Documentation\n\nWhen linking to documentation, **prefer `.md` file URLs** over HTML pages whenever available:\n\n**Examples of markdown-friendly documentation:**\n\n- **Claude Code**: https://github.com/anthropics/claude-code/tree/main/docs\n- **Next.js**: https://github.com/vercel/next.js/tree/canary/docs\n- **Vercel**: https://vercel.com/docs (provides markdown-friendly content)\n- **Supabase**: https://github.com/supabase/supabase/tree/master/apps/docs\n\n**Why markdown versions?**\n- More AI-friendly to read and parse\n- Better for offline access\n- Easier to diff and track changes\n- Direct access to source content\n\n### Research Before Implementation\n\nBefore implementing or modifying agents, skills, commands, or rules:\n\n1. **Search for official documentation** - Find the authoritative source\n2. **Search for best practices** - Look for recommended patterns and approaches\n3. **Link explicitly in markdown files** - Include references to official docs in:\n   - Agent `## Agent-scoped project context` sections\n   - Skill `## Skill-scoped context` sections\n   - Rule files under appropriate headings\n   - Command documentation\n\n**Example (Agent):**\n\n```markdown\n## Agent-scoped project context\n\n- Uses Next.js App Router (https://raw.githubusercontent.com/vercel/next.js/canary/docs/app/building-your-application/routing.md)\n- Follows Vercel deployment best practices (https://vercel.com/docs/deployments)\n- TypeScript strict mode enabled (https://www.typescriptlang.org/tsconfig#strict)\n```\n\n**Example (Skill):**\n\n```markdown\n## Skill-scoped context\n\n- Supabase database migrations (https://raw.githubusercontent.com/supabase/supabase/master/apps/docs/content/guides/database/migrations.mdx)\n- Migration best practices: always test locally before production\n- Use meaningful migration names with timestamps\n```\n\n**Example (Rule):**\n\n```markdown\n## Rules\n\n1. Follow TypeScript strict mode guidelines (https://www.typescriptlang.org/tsconfig#strict)\n2. Use Next.js App Router patterns (https://github.com/vercel/next.js/tree/canary/docs/app)\n3. Follow React Server Components best practices (https://github.com/reactwg/server-components/discussions)\n```\n\n### Informing vs. Linking\n\n- **Link to official docs** - These are the authoritative references for tools and frameworks\n- **Use best practices to inform** - Best practices guide how you structure agents, skills, commands, and rules\n- **Keep docs fresh** - Update links when major version changes occur\n\n## Documentation\n\nComprehensive Claude Code documentation in `.claude/skills/`:\n\n- `claude-plugins/SKILL.md` - Plugin development guide\n- `claude-hooks/SKILL.md` - Hook types and patterns\n- `claude-skills/SKILL.md` - Agent Skills\n- `claude-commands/SKILL.md` - Slash commands\n- `claude-agents/SKILL.md` - Subagent configuration\n- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment\n","structuredPatch":[{"oldStart":1031,"oldLines":11,"newStart":1031,"newLines":8,"lines":[" "," ## Documentation"," ","-Comprehensive Claude Code documentation in `.claude/skills/`:","-","-- `claude-plugins/SKILL.md` - Plugin development guide","-- `claude-hooks/SKILL.md` - Hook types and patterns","-- `claude-skills/SKILL.md` - Agent Skills","-- `claude-commands/SKILL.md` - Slash commands","-- `claude-agents/SKILL.md` - Subagent configuration","-- `turborepo-vercel/SKILL.md` - Turborepo monorepos with Vercel deployment","+For Claude Code plugin development documentation, use the `plugin-dev` plugin which provides comprehensive skills for:","+- Plugin structure and development","+- Hook types and patterns","+- Agent, skill, and command creation","+- MCP integration"]}],"userModified":false,"replaceAll":false},"tool_use_id":"toolu_014umtj62oFWXqa82JTVpr2V"}}
{"timestamp":"2026-01-01T03:56:38.058Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:56:38.207Z","event":"lint-file","type":"output","data":{"success":false,"lint_errors":"$ eslint plugins/ shared/\n/usr/bin/bash: line 1: eslint: command not found\nerror: script \"lint\" exited with code 127\n"}}
{"timestamp":"2026-01-01T03:56:38.215Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse","additionalContext":"ESLint found errors:\n\n$ eslint plugins/ shared/\n/usr/bin/bash: line 1: eslint: command not found\nerror: script \"lint\" exited with code 127\n\n\nPlease fix these linting issues."}}}
{"timestamp":"2026-01-01T03:56:39.337Z","event":"typecheck-file","type":"output","data":{"success":false,"type_errors":"error TS2688: Cannot find type definition file for 'node'.\n  The file is in the program because:\n    Entry point of type library 'node' specified in compilerOptions\n"}}
{"timestamp":"2026-01-01T03:56:39.339Z","event":"PostToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PostToolUse","additionalContext":"TypeScript type checking found errors:\n\nerror TS2688: Cannot find type definition file for 'node'.\n  The file is in the program because:\n    Entry point of type library 'node' specified in compilerOptions\n\n\nPlease fix these type errors."}}}
{"timestamp":"2026-01-01T03:56:55.928Z","event":"PreToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PreToolUse","tool_name":"Bash","tool_input":{"command":"ls /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/plugins/","description":"Verify remaining plugins"},"tool_use_id":"toolu_01N1mFqdG6MbaKQgeg7nJBcX"}}
{"timestamp":"2026-01-01T03:56:55.930Z","event":"PreToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PreToolUse","permissionDecision":"allow"}}}
{"timestamp":"2026-01-01T03:56:56.065Z","event":"PreToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PreToolUse","tool_name":"Bash","tool_input":{"command":"ls /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/","description":"Verify remaining rules"},"tool_use_id":"toolu_01GSVT2D2rvZpQiiXEWuhKrx"}}
{"timestamp":"2026-01-01T03:56:56.066Z","event":"PreToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PreToolUse","permissionDecision":"allow"}}}
{"timestamp":"2026-01-01T03:56:57.815Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Bash","tool_input":{"command":"ls /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/plugins/","description":"Verify remaining plugins"},"tool_response":{"stdout":"cloudflare-mcp-server-dev\ngithub-context\nnextjs-supabase-ai-sdk-dev\nproject-context","stderr":"","interrupted":false,"isImage":false},"tool_use_id":"toolu_01N1mFqdG6MbaKQgeg7nJBcX"}}
{"timestamp":"2026-01-01T03:56:57.823Z","event":"await-pr-checks","type":"input","data":{"tool_name":"Bash","tool_use_id":"toolu_01N1mFqdG6MbaKQgeg7nJBcX"}}
{"timestamp":"2026-01-01T03:56:57.827Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:56:57.971Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Bash","tool_input":{"command":"ls /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/plugins/","description":"Verify remaining plugins"},"tool_response":{"stdout":"cloudflare-mcp-server-dev\ngithub-context\nnextjs-supabase-ai-sdk-dev\nproject-context","stderr":"","interrupted":false,"isImage":false},"tool_use_id":"toolu_01N1mFqdG6MbaKQgeg7nJBcX"}}
{"timestamp":"2026-01-01T03:56:57.978Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:56:57.998Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Bash","tool_input":{"command":"ls /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/","description":"Verify remaining rules"},"tool_response":{"stdout":"plugin-claude-md.md\nplugin-readme.md\nrule-file.md\ntest-rule.md","stderr":"","interrupted":false,"isImage":false},"tool_use_id":"toolu_01GSVT2D2rvZpQiiXEWuhKrx"}}
{"timestamp":"2026-01-01T03:56:57.999Z","event":"await-pr-checks","type":"input","data":{"tool_name":"Bash","tool_use_id":"toolu_01GSVT2D2rvZpQiiXEWuhKrx"}}
{"timestamp":"2026-01-01T03:56:58.001Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:56:58.125Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Bash","tool_input":{"command":"ls /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules/","description":"Verify remaining rules"},"tool_response":{"stdout":"plugin-claude-md.md\nplugin-readme.md\nrule-file.md\ntest-rule.md","stderr":"","interrupted":false,"isImage":false},"tool_use_id":"toolu_01GSVT2D2rvZpQiiXEWuhKrx"}}
{"timestamp":"2026-01-01T03:56:58.126Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:57:03.198Z","event":"PreToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PreToolUse","tool_name":"Bash","tool_input":{"command":"ls /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/ 2>/dev/null || echo \"directory check\"","description":"Verify .claude structure"},"tool_use_id":"toolu_011XmuHbNJwDGDKdpSjKU94s"}}
{"timestamp":"2026-01-01T03:57:03.199Z","event":"PreToolUse","type":"output","data":{"hookSpecificOutput":{"hookEventName":"PreToolUse","permissionDecision":"allow"}}}
{"timestamp":"2026-01-01T03:57:04.299Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Bash","tool_input":{"command":"ls /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/ 2>/dev/null || echo \"directory check\"","description":"Verify .claude structure"},"tool_response":{"stdout":"hooks\nlogs\nrules\nsettings.json","stderr":"","interrupted":false,"isImage":false},"tool_use_id":"toolu_011XmuHbNJwDGDKdpSjKU94s"}}
{"timestamp":"2026-01-01T03:57:04.300Z","event":"await-pr-checks","type":"input","data":{"tool_name":"Bash","tool_use_id":"toolu_011XmuHbNJwDGDKdpSjKU94s"}}
{"timestamp":"2026-01-01T03:57:04.300Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:57:04.362Z","event":"PostToolUse","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Bash","tool_input":{"command":"ls /home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/ 2>/dev/null || echo \"directory check\"","description":"Verify .claude structure"},"tool_response":{"stdout":"hooks\nlogs\nrules\nsettings.json","stderr":"","interrupted":false,"isImage":false},"tool_use_id":"toolu_011XmuHbNJwDGDKdpSjKU94s"}}
{"timestamp":"2026-01-01T03:57:04.363Z","event":"PostToolUse","type":"output","data":{}}
{"timestamp":"2026-01-01T03:57:13.738Z","event":"Stop","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc","transcript_path":"/home/ben/.claude/projects/-home-ben--claude-worktrees-claude-code-plugins-claude-gallant-ibis-4tn0uxl8/e72690f9-f05d-4a0b-9f46-c34bf55e61fc.jsonl","cwd":"/home/ben/.claude-worktrees/claude-code-plugins/claude-gallant-ibis-4tn0uxl8/.claude/rules","permission_mode":"acceptEdits","hook_event_name":"Stop","stop_hook_active":false}}
{"timestamp":"2026-01-01T03:57:13.739Z","event":"commit-session-check-pr-status","type":"input","data":{"session_id":"e72690f9-f05d-4a0b-9f46-c34bf55e61fc"}}
